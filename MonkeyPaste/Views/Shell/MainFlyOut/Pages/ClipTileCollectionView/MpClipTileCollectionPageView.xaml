<ContentPage x:Class="MonkeyPaste.MpClipCollectionPageView"
             xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:MonkeyPaste"
             xmlns:skia="clr-namespace:SkiaSharp;assembly=SkiaSharp"
             WidthRequest="1000"
             HeightRequest="1000"
             BackgroundColor="Purple"
             Title="Monkey Paste"
             x:Name="ClipCollectionView"
             x:DataType="local:MpClipTileCollectionPageViewModel">
    <Shell.SearchHandler>
        <local:MpClipTileViewModelSearchHandler x:Name="ClipViewModelSearchHandler" 
                                                Placeholder="Enter search term"
                                                SearchBoxVisibility="Collapsible"
                                                ItemsSource="{Binding ClipViewModels}"
                                                ShowsResults="False"
                                                DisplayMemberName="Clip.ItemPlainText">
            <local:MpClipTileViewModelSearchHandler.ItemTemplate>
                <DataTemplate x:DataType="local:MpClipTileViewModel">
                    <Grid Padding="10"
                          ColumnDefinitions="0.15*,0.85*">
                        <Image Margin="0,10,0,0"
                               Aspect="AspectFit"
                               HeightRequest="60"
                               Source="{Binding Clip.App.Icon.IconImage, Converter={StaticResource ImageConverter}}"
                               VerticalOptions="Start"
                               WidthRequest="60">
                        </Image>
                        <Label FontSize="14"
                               FontAttributes="Italic"
                               Text="{Binding Clip.ItemText}"
                               TextColor="Black" />
                    </Grid>
                </DataTemplate>
            </local:MpClipTileViewModelSearchHandler.ItemTemplate>
        </local:MpClipTileViewModelSearchHandler>
    </Shell.SearchHandler>
    <ContentPage.Content>
        <StackLayout>
            <!--<local:MpSearchBarView BindingContext="{Binding SearchBarViewModel}" />-->
            <CollectionView x:Name="ClipViewModels"
                            EmptyView="{Binding}"
                            ItemsSource="{Binding ClipViewModels}"
                            RemainingItemsThreshold="5"
                            RemainingItemsThresholdReachedCommand="{Binding LoadMoreClipsCommand}"
                            SelectedItem="{Binding SelectedClipViewModel, Mode=TwoWay}"
                            SelectionMode="Single">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical"
                                       SnapPointsAlignment="Start"
                                       SnapPointsType="Mandatory" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="local:MpClipTileViewModel">
                        <local:MpClipView BindingContext="{Binding .}" />
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyViewTemplate>
                    <DataTemplate x:DataType="local:MpClipTileCollectionPageViewModel">
                        <Grid>
                            <ActivityIndicator IsVisible="{Binding IsBusy}" />
                            <Label HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center"
                                   IsVisible="{Binding IsNotBusy}"
                                   Text="No photos to import could be found"
                                   VerticalOptions="Center" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.EmptyViewTemplate>
            </CollectionView>
        </StackLayout>
    </ContentPage.Content>
</ContentPage>