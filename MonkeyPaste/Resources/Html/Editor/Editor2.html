<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Yo this is a title</title>
    <link href="https://cdn.quilljs.com/2.0.0-dev.4/quill.snow.css"
          rel="stylesheet" />
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/github.min.css" />
    <link type="text/css" href="https://unpkg.com/quill-better-table@1.2.7/dist/quill-better-table.css" rel="stylesheet" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script>
    <script charset="UTF-8"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/xml.min.js"></script>
    <script src="https://cdn.quilljs.com/2.0.0-dev.4/quill.min.js"></script>


    <script src="https://cdn.quilljs.com/2.0.0-dev.3/quill.js"></script>
    <script src="https://unpkg.com/quill-better-table@1.2.8/dist/quill-better-table.min.js"></script>
    <link type="text/css" href="https://cdn.quilljs.com/2.0.0-dev.3/quill.snow.css" rel="stylesheet">
    <link type="text/css" href="https://unpkg.com/quill-better-table@1.2.7/dist/quill-better-table.css" rel="stylesheet" />

    <script src="https://unpkg.com/quill-better-table@1.2.8/dist/quill-better-table.min.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script src="https://cdn.jsdelivr.net/gh/T-vK/DynamicQuillTools@master/DynamicQuillTools.js"></script>

    <style>
        body {
            margin: 0px;
            padding: 0px;
            font-family: Arial;
            background-color:transparent;
        }

        .btn {
            border: none;
            background-color: green;
            padding: 14px 28px;
            font-size: 16px;
            cursor: pointer;
            display: inline-block;
        }

            /* On mouse-over */
            .btn:hover {
                background: #eee;
            }

        .success {
            color: green;
        }

        #editor {
            width: 100%;
            height: auto;
        }

        .ql-toolbar {
            width: 100%;
        }

        .ql-templatebutton:after {
            /*/content: "ยง";*/
            height: 15px;
            width: 15px;
            background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAaVBMVEX/////wQf/vwD/24f/3Iz///3/vQD/ykL/yTj/yT3/0WH/0F7/0Fv/y0T/y0f/yTr/35T/wxT/8tP/6Lj/5az/7sj/9uX/46P/1G7/677/57P/2oL/xSj/8M//1nj//fb//O//4Zz/zVBsBjAmAAAEzklEQVR4nO2di3qiMBBGIUpa1168tFZ70933f8hl0KqVWCuZyfzhm/MAfJ7vhAmwCy0KwzAMwzAMwzAMwzAMwzAMWKq3QSzDyXymrXGe6ta7eLwvl8/aKmGqW1fy4Pz0SdsmAJ9g4zhaaAudwirYOIJl5Bas8QNtqWMEBLEURQRrRZiFKiRYK4KMGzHB0j1ouzXICdYR59p2haxg6d619YQF64gfPRcs3ae24KOsYOmmyoLCBUvtDSOBYOk176TEl2hjqHhdw1WwvuetOXcsN9ET5Cno/PJ1tvh4Gp9xdEM1QZ6C/m29O+Dmj4cyZCroV0fHfAkpahlyFfw+KEOKSoZcBU9//bh9WB1Dtn3w9MCbdkQVQ7Ztov3j71pH1jBk2+h9++n2UyuigiHfpZrftA7+AWDIeKnm162jL/QNOS+2Aw1n6oasF9uB83Cubch7uxS4qF4qz9JqxHq71L5/Xyvvh+z3g/40YjthUkOBG96TM7F9FiY1ZF6i25/vjhVXuvcWUv/4sl+o60/d+0OJglvF6XC2WS+eP53uPb7gUzV34TlNGkOxgpdJY5jiuaiqoWLBNIZJHvxqGuoKJjBUXaIpDDWHTBJD7YLihuoFxQ3VCwob6i9RacMbAEFJwwpCUNIQQ1DOEKSgoCHCkGkQMoQpKGUIsU3skDHEKShjiFRQxhCpoIQh0JBp4DcEE2Q3RCvIbwg1ZBp4DfEKMhtibRM7WA3vAQU5DRGXaMlqCFmQ0RC0IKMhqiCXYQW6REs2Q9iCXIa4BZkMgQvyGCIX5DCE3SZ2xBtiF4w3RC8YbwgvGGkIvNHviTPELxhpmEHBOMMcCkYZPmQh2H77q2cFS/dQ9bugu+laMIshE/Ntk1wEOxccB//POBzdC75lInjfVfC574LFNIuTMOIDSn+zSNh9yBRV3wsWrzkkjCgYeh8cj6iPmOWwSKMKBl4lhsPdd73YbsA/DeMKFsUEfZW6m6iCRTEAN4y4ksnDMLog+iqNLxh+XRqG2CHTgLxbcBSE3vFZChbBTzFhELnRH0A9EbkK1mirhGHYJvYEv/umDc+Q+eId70zkLFggbhi8BWsmYIqMQ+aLJZQie0EC6aG3GwkIFkX4W6EaMA8ZPEWBc/ALjIUqVpBAqChYkLhTV3QjwYKEdkXhgoRuRfGChGZF0SFzQG+iCm30bbQqJiqop5hgyBzQWKgJCxLpKyYtSKTeNJJsE99JWzF5QSJlRYWCRLqKiYfMgVQT1d0qCaaqqLRE0ym6R0XBFAtVWVC+ouoS3SK7aSgOmQOSFQEKEnIVIQoSUhVBChIyExWmICFREaggwa+ovg+ewr1Q4QS5K4It0S2cmwbUkDnAVxGyIMFVEbQgwVMRcMgc4JiowAWJ+IrQBYlYRfCCRNxCzUAwriL8Et3SfdPIoiDRtWImBYluFbMpSHSpmFFB4vqJmlVB4tqKmRUkrlPMriBxzULNUvCaihku0S2/3TQyLUj8rmK2BYnfVMy4IHG5YuaClydq9oKXKvZA8GfFXgj+tFB7Inj+hSLf+btqcEyCf7nXL7V/FyOz91ZGX660fxUvL+VxR+fdpDcrdM9q7Lx3jv7gtPv32j8/oprNJ8PB5HXWTz3DMAzDMAzDMAzDMAzDMHrEf9VjaGNa1FYRAAAAAElFTkSuQmCC");
        }


        /* maps font sizes to font drop down*/
        .ql-snow
        .ql-picker.ql-size
        .ql-picker-label[data-value]::before,
        .ql-snow .ql-picker.ql-size
        .ql-picker-item[data-value]::before {
            content: attr(data-value) !important;
        }

        /* Table Styles*/
        .ql-snow .ql-Table-Input .ql-picker-options {
            padding: 3px 5px;
            width: 152px;
        }

        .ql-editor {
            height: auto;
            padding: 2px 10px;
        }

        .ql-container.ql-snow {
            border: 0px solid #ccc;
        }

        .ql-snow .ql-Table-Input .ql-picker-item {
            border: 1px solid transparent;
            float: left;
            height: 16px;
            margin: 2px;
            padding: 0px;
            width: 16px;
            background: lightsteelblue;
        }

            .ql-snow .ql-Table-Input .ql-picker-item:hover, .ql-snow .ql-Table-Input .ql-picker-item.ql-picker-item-highlight {
                border-color: transparent;
                background: steelblue;
            }

        .ql-snow .ql-Table-Input.ql-picker {
            width: 28px;
        }

            .ql-snow .ql-Table-Input.ql-picker .ql-picker-label {
                padding: 2px 4px;
            }

        /* Template Button */
        .template_btn {
            display: inline-block;
            padding: 1px;
            text-decoration: none;
            color: #67c5ff;
            border-radius: 3px;
            transition: .4s;
            margin: 0 1px;
            cursor:pointer;
            caret-color:transparent;
        }

            .template_btn:hover {
                padding: 3px;
                transition: .2s;
                cursor: pointer;
            }

        .template_context_item {
            display: inline-block;
            vertical-align: middle;
            margin: 0 0 10px 0;
            height: 20px;
            width: 20px;
            background-color: transparent;
            background-size: contain;
        }

        .template_rename_icon {
            background-image: url('data:image/png;base64,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');
        }

        .template_delete_icon {
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFYAAABiCAYAAADKvSRMAAAElklEQVR4nO3dX0hbZxjH8V9sl3pxPFbWsmKi07XDExm0HdQorFZateq86NbRdR1bwxBxsLIMCqUwliNj7Ha9aIf706ndVjrnVhgttl2tZWzJ8UKXUaMwjYGoSzpXc8KhN9pkF3UQqh4zl + fEZM/n0sjzvn45mH9wXhPSIBicdnV2d8OtKPD5xkjWKC + XUGW34523T1wWBMFLsoiOjUYvqKqq66uLl + ShYS9CobswmUwk68zMhDA07MWXX190appWY3Rcw8P + cOWq/Nn5TszNzZGuo6oqfvV6MRkIbN5k3jQAoIB0wUfkGLmYW1FcZ891kEdNpKoqznV8sllRlJ2GLQqDw3o8g3IoHDZySQDA7Oxf + OnnXwaMXNOwsG5FcX3T02vUcktc6uk19Ko1AQ + fUN7/4ENc/7Ef0WiUZKHGhoNy37XrJLOTVVGxJ6Iogx9RzX/pxUOQ33v3siAIXhMA9Hz7XfyL7gsYH5/A/Pw81bpZ78niYpx4683I4RcOFWwAgPDsPXliwo9YLJbuvWU0VVURvvtn7phvpD0HAILBqXTvKWuMjPgAGPyq4P9gYWEBAIclw2GJcFgiHJYIh00xs9kMYDGsIAhp3Uw2sUllABbDnj51Ek + VliInhy/g/8ImleENx + sAFj + PbW5qdPQP3C4Jh0LQ7t9P6 + YymWSTsK96byTd+2CMMcbWRPe755IdksuojWSiwPhY+0qP6YYtfdoWT/12ssfk76Mr9uN3BEQ4LBEOS4TDEuGwRDgsEQ5LhMMS4bBEOCwRsrBmsxl1tfvR1tqCeDwu19XuX9NXP + ttTrLIJjc3NaKutlZua21xBsbH2usPHHA0HKzL + DnJIvsQ5uOzZ5wN9fVnEn82NDwcP3zkWEbPSZSWD2Ee/SMAYMf27Y5Mn5MsQ5+8RFHsysY5y + FXBUQ4LBEOS4TDEuGwRDgsEQ5LhMMS4bBEOCwRDkuEwxLhsEQ4LBEOS4TDEuGwRDgsEQ5LhMMS4bBEOCwRDkuEwxLhsEQ4LBEOS4TDEuGwRDgsEQ5LhMMS4bBEOCwRDkuEwxLhsEQ4LBEOS4TDEjE0rKqqKblB2nqbsxyysH19/UsOzJnw + + VMn5MssrBXr10ZuHHjpkvTtJ0A0Nv7vet854WMn5OsDXoPFjy + VV7rYL9/MvdB7EGN1/vb0UBwJhcmk3yz/9a/Ps9mvc1JFLk3y/c2pMD3NkwD3bB8l/mV/XPewUp0yxUXFaV0M9nEUlio+7hu2Gd370rpZrLJ7l36xy/qhq20V6R0M9lktTa6Ya1FFgcfl7KUTSpDkbXQqfc7umGr7Pau06dO4rGNhh+4vG7l5eWhrbUFlZWVS27ek2jVp/3mpkaH4/hrHBcPox47egT7qvfqXq1AEmd/i6LYdWd0FKIodnZ8 + jk0TUvNLjOMTSpD8/NNqKl + zpmfn697tQJJHqr + jM3WFY1G4fEMlmzb9oQ8NT2Nqalp/BEKZe2Rq2azGVu3bIHVaoHVYkEMcfnVV16OJBMVWOUt7XLcinLc4xkscSsKfHd8WXuakigIkMolVNntqLLviaz2P5UZ5G8Ww8H3apwV2wAAAABJRU5ErkJggg==');
        }

        .template_color_icon {
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGIAAABiCAYAAACrpQYOAAAMg0lEQVR4nO2dfVBTVxrGH1lM0JEkVrQ1XCngzmgQxM4KkaqICErV1gqCiB9krdOure2w7Wynrq73tk63u53dit1tp7tbC9FSrRBArVYQMVirAloQCRcV8CuAClNzo0IdGNg/IDR8hHzej6i/vwLcnPPkPrznPefNOckICBiGYcja2svQ6/XQNzVBp6NhNBoBADW1tX2PTUgkEgRNndr3eNo0BQi5HAQhz1cqlRc4fwF2MIJvAebcvNlIlpWV4UxpKc6WleHFJUuoltZWGI33YDQa0dLaiocPHwIA7txpQUdHR7/ne3p64umnJwAAxGIxxvv4QCKRYJSX2HDg0OH0oKCpiFAqMSs8HBERyvwxY8YIxhzejdDRNFlUVIyCY8cwKzyc0jc2Qd/YiBs3buLBgwcu7UsqlSLA3x8EIYfPuHGG0vLy9FdSU7FoUSzvpvBiBMMwZFFRMXap1XguNJSqb7iKy1fqcPfuXU51SKVShIfNhK98oqGxsTk9Pik + Py46mhdDODWCYRgyc/fX6OrqoujaSzh3/ifOb74lJk6ciJCQaQadTpf+9lub8uPj4zk1hBMjzA0oLSvHTxWVg8Z3oTB69CiEh4UZrtRd4dQQ1o3QaPLIG3q94A0YiMmQ23dup5NbNrM+62LNCB1Nk9u3fwSJVEJpS066jQEDkUqliJw72yAaOTKd2raVtaTOihEZajVZV9dAFZ8owa3bt9nognOe9fPDC3ELDaEhz0XFxbk + obvUCIZhyNc2voludFNl5edc2bQg8PT0RPT8KIPvM75R27a951IzXGaEjqbJwsIian+25pGJAkv4P + tnGDV6VPp/P/93PkEQLjHEJUZka/LIGpqmsr7Z57a5wF6kUiniX37JEJ + YEBU8ZYrTZng420C2Jo88VlTEuQkzQqcjJTkJ3d3dVHd3N5WSnISnxo7lrH + GYbAna69sX9Ze7dGjxaHOtudURGz/8CPy8pU66tSPp53VYTMikQgr4l + GSORFJSYsMwQFBe0EgGqaTs3M2OMvFo + k9u3PQVdXFyd6THljUcz8KGfWHA4bsWPnv8ii4yeoGpp2tAmHUK1bg8SE5WkmAwZSTdOpOdmaTPWeLE51TQ8JNqSuWeWwGQ4NTdmaPPLkD6c4N2FG6PRhTQCAYIVCvSIxQSWVSriUhqqL1TL1144PU3Ybka3JIw8e + o6qvFDlSH9OkZK8EsOZYCJYoVC/tekNLiT1o + pitexIwWFt9aVLdpthlxE6miYPHvqO05xgzrSgqWm2XhuuDFOxKMUi3x8tlO3L2qvV6/V2mWGzEQzDkDmaPN5MAGBTNJgIVijUbGqxRGdnJ77N1sg0eQe09jzPZiMOHT5CZX2zz25hrsSekNfRNMmmluHo7OxEhnqP7IMP/mazXpuM2JWhJj/7/D+8L9aqL1Rpbb22oqKSYk + JdRiGQfHJEzYnb6tG6GiaLDxWRAmhbLHrq0yZLVGho2kyc/fXXEgaluvXb8iOFBzW3r9/36pmq0aUlPwgmAJeXX0D9mXtHXZWoqNpMkeTR9XXN3ApzSLfHy2UFRwr0lq7btgFXbYmj/xkx05BRIMJT09PLHvpRQO6u9JVr/w+31Tn0dE0mZGhhlgsprI1ebwPo + b4 + U3Cx3/dPmO4N5d + Y + kPDMOQX2XupioqKx3qfEbodETPn4eqi9UUAO3qVSujGhub0P7LLw61Z6Krqws0XevV1tYedef2neSm2y1esqd8okYA1E8VF6JKfjjlkvKGK/UzjBFeXl7JJ0u0f7d0jcWI0Jac7H514ya7/7OEVguyF7b0jx49CtvJrTMslUA8h/olwzDkm2nvOBTeKclJfWUI8i + b+35vmtdX0/S1kSNHcl4LshW29Le1taPk1GktgCFLxEMm64rKC9TZ0jK7OgKEXQuyBbb1Fx0vluXm5g450RhkRG9ucDAahF0Lsgbb + s2iYhCDjKhvaHAoGgD3qAUNBxf6i44Xy4Za5A0yIic33 + GpnzvUgoaDC/1tbe2orhlcIehnhI6myaMFxxxpH4D71IIswZX+3PwDsoGr7X5G1NfVU87sRXWnWtBQcKW/ufkW6NpL/frqZ0RhUbGjbQNwv1rQQLjUn3fgoMz85z4jbt5sJE + fOetU4+5YCzKHS/1Hvi + A + fDUt7I + c7a0O2WtyqnGAfesBZnDpf4DufsN00NCxgJmtabgkFCqtKzc6ca5qgWxBZf6fxsY6HXwQP77gFlErFy9trusTBjl7seFmAXR + N8Xn40AenMEwzCkTsft1pgnAOXnzvc99gCAlpZWytUHB59gHYZhUFpaGgr0GqFvbORX0WPMXYbRAiYj9E + M4IvGxiYZ0GtEfYPw5vSPC/X1VwE8GZp4x3Tve4emJl7FPM6YPtLCAwBu3LjBq5jHGeO9ewB6jWhrb + dVzOOMKQicPrr1BOdoa + sJAqeN4Pss26PCkNtpbGHg/p8Pt7 + /EwBWpSRfe/iwQ/D7l4SCr1yOq1foHiM8PDzsvmHuvn9JKCgUU3Cq5HjP0OQ3aZJdT3b3/UtCIkihANCbIyZMGG/Xk919/5JQEIlEmBc5B0CvEeN9fOxqwN33LwkFZXgYJgcGpgG9RhCEr10NuPv + JSHg7e2N9ap1kEqlO4FeIyQS+8Zxd9 + /xDcikQgpyUl4bkZo38jiAQCTAwPsasjd9y/xiUgkQmxMNF5aujjNFA1ArxG + kwiVh4ftazt337/EF6ZIiJwbOWjG6QH0jOP2TGHdff8S14hEIijDw/CHVzcgMWF5WtKK5YNybN8ujnf+9F53bv4Bmxt39/1LbOMrl0MsFmPy5AAoej4mm1qvWmcwH47M6TMiOye3+93NW + zu8Fk/P8yc + TtDjiY3HQBWr1pJlZWfR119vYMvgXt8fMYhSKHAeB8f5OTmUa5oMzx8JiQSCRbFxmJhTLRFA0z8utOvtDR1zbr1mY9TbSgwIADzIufg9NkyKjFhOaYpphhmzZpl89TclfQ7zLgsPrG76mI1Hzo4RSQSYWHMArQ//IUit2w2TJo0iZebb06/qdKihTF86eAM08xlyZK4tC + / + Px9IZgADDBicsBku6ax7obJhMSE5WlxCxcKwgAT/SNiUYw6eFoQX1pYZ + niF6xWjfli0L//mpRVfOhgHV+5HLGx0YI0ARjCiIhZ4arRo0bxoYVVEuJfhtCGI3MGGUEQhFqVupYPLazh4zMOEcowm0v3fDBkZp4z5/lHKiqU4WHga31gK0MaEaFUPlJRMW/uXL4lWMXiXHXOnOdVY8aM4VILawQppvItwSoWjYhQKtVvp72FR2FdIZF4Czo/AFY2mMUumK + aHzWPKy2sMXbsWC3fGqwxrBEEQahnKZUqsVjMlR5WaGpu1vKtwRpWx50N61PVG15Rsa + ERa5evSazfhW/2JQA4uIWqSZOfIZtLaxRUSmYb8K0iE1GBCsU6pTkRLfdtXfwu8Ow5bNX + cTmKdGm119Xb/3ze3DHfNHcfAsVlRe0fOsYDrvmpgtjFqje2PiaW05pv83WCDpP2HVHJRKJevmyF1VrV69yOzNOaLV2bYzjGrvPRxAEoa7u + SaVzD1Ze93m/ENbWzuu9HxYlSBP0Th0UCVYoXBLM6qqLgp2eHL4xJA7miHk8 + QOGwH0N2Pf/py + M8NCxWi8x7cEizhlBPCrGXK5PPOT9E8FbYaQp95OGwH0mGE0GrE/J8f/7s8G6meBfGv7QAhf+86BcIlLjAB6prYA8Md33r3W2dmZeeRogeDyhpDfl3D5YmDHPz9WL128WPXGxtcgpLdbRSIRfMaPE + z7Eqx9w7vRaExdp9rgP + Hp8ZRWexIdnZ1sdWUTc + fMxu6ML1l7vc7CurCcnNzUW3fuZJ768TTKz53nZbjy9vbGpzv + gah5kYI1wmU5whIrVsSrjUYjOjo6/EOnh1DfZueAYYxsd9uPpYtf6HdeTYiwbgTwayLX6/XXrl + /6R8Q8CxVUXmBkwiJjYlGZOTsNGvnE/iGEyNMEAShBgCj0XhtV4bav/piNZ6fHUGdOVuG + /fvu7Qv02HymAUxgttwPBScGmHCFCEAQG3beq3tQbt/SMg0qr6hAXp9Iy5dvuJUpCimTkFszAL4 + hJDnlcTIoJJXkajMbXg2HH/M6WlKDxaiKSkFVRLSytaWlvR0tLat2JvvnWrn0ne3t6QeHtDIvEGQfhicmAgbre0UOSWzVaPSwkJwRgxEL1en6qjaf + amlroaBpGY0 + Cr6muwf22tr7rCLkcckIOgiAQoVTadF7tCU + wyP8B18AkhSaCnzUAAAAASUVORK5CYII=');
        }

        .template_color_palette_item {
            height: 15px;
            width: 15px;
            border-radius: 5px;
            border: solid 3px transparent;
        }

            .template_color_palette_item:hover {
                transition: .2s;
                border: solid 3px dimgray;
            }



        .selectedTemplate {
        }

        /* Template Context Menu*/
        .cls-context-menu-link {
            display: inline-block;
            padding: 20px;
            background: #ECECEC;
        }

        .cls-context-menu {
            position: absolute;
            display: none;
        }

            .cls-context-menu ul  {
                display:inline-block;
                list-style: none;
                margin: 0;
                padding: 0;
                background: white;
            }

        .cls-context-menu {
            border: solid 1px #CCC;
        }

            .cls-context-menu li {
                border-bottom: solid 1px #CCC;
                box-sizing: border-box;
                width: auto;
                display: block;
                padding: 5px 10px;
                text-decoration: none;
                color: blue;
            }
                .cls-context-menu li:last-child {
                    border: none;
                }

                .cls-context-menu li a:hover {
                    background: blue;
                    color: #FFF;
                }

            .cls-context-menu a {
                display: block;
                padding: 5px 10px;
                text-decoration: none;
                color: blue;
            }

                

        /* Paste Template Toolbar */
        .paste-template-toolbar {
            display: none;
            width: 100%;
            background-color: lightyellow;
            border: solid 1px yellow;
            padding: 5px 10px;
        }

        .paste-template-toolbar-btn {
            display: inline-block;
            padding: 2px 5px;
            text-decoration: none;
            font-size:14px;
            border: 1px solid #CCC;
            color: white;
            border: solid 2px #67c5ff;
            border-radius: 7px;
            transition: .4s;
            margin: 0 5px;
            background-color: dodgerblue;
            cursor: pointer;
        }

        .paste-template-toolbar-btn:hover {
            color:dimgray;
            transition: .4s; 
            cursor: pointer;
        }

        /* Custom Selector style*/
        .Select-menu-outer {
            top: auto;
            bottom: 100%
        }

        .custom-select {
            display: inline-block;
            position: relative;
            font-family: Arial;
        }

            .custom-select select {
                display: none;
            }

        .select-selected {
            background-color: DodgerBlue;
        }

        .select-selected-item {
            background-color: lightblue;
        }

        .select-selected:before {
            position: absolute;
            content: "";
            top: 7px;
            left: 5px;
            width: 0;
            height: 0;
            border: 6px solid transparent;
            border-color: #fff transparent transparent transparent;
        }

        .select-selected.select-arrow-active:before {
            border-color: transparent transparent #fff transparent;
            top: 10px;
        }

        .select-items div,
        .select-selected {
            color: #ffffff;
            padding: 12px 5px;
            border: 1px solid transparent;
            border-color: transparent transparent rgba(0, 0, 0, 0.1) transparent;
            cursor: pointer;
            user-select: none;
        }

        .select-items {
            position: absolute;
            background-color: DodgerBlue;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 99;
        }

        .select-hide {
            display: none;
        }

        .select-items div:hover,
        .same-as-selected {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .select-items .square-box {
            height: 18px;
            width: 18px;
            float: left;
            margin: 0 20px 0 20px;
        }

        .select-selected .square-box {
            height: 18px;
            width: 18px;
            position: absolute;
            margin: 0 20px 0 20px;
        }
    </style>
</head>
<body>
    <div id='editor'>
    </div>

    <div id="templateColorPaletteMenu" class="cls-context-menu"></div>

    <div id="templateToolbarMenu" class="cls-context-menu">
        <ul id="templateToolbarMenuList">
        </ul>
    </div>

    <div id="templateContextMenu" class="cls-context-menu">
        <ul id="templateContextMenuList">
        </ul>
    </div>

    <div id="pasteTemplateToolbar" class="paste-template-toolbar">
        <div id="custom-select" class="custom-select" style="min-width:160px;">
            <select id="pasteTemplateToolbarMenuSelector">
            </select>
        </div>
        <div id="clearAllTemplateTextButton" tabindex="0" class="paste-template-toolbar-btn">
            <span>CLEAR ALL</span>
        </div>
        <div style="display:inline-block">
            <input id="templateTextArea" tabindex="1" onchange="templateTextAreaChange()" onkeyup="templateTextAreaChange()" onsearch="templateTextAreaChange()" type="search" cols="30" />
        </div>
        <div id="previousTemplateButton" tabindex="2" class="paste-template-toolbar-btn">
            <span>โ</span>
        </div>
        <div id="nextTemplateButton" tabindex="3" class="paste-template-toolbar-btn">
            <span>โบ</span>
        </div>
        <div id="pasteTemplateButton" tabindex="4" class="paste-template-toolbar-btn">
            <span>FINISH</span>
        </div>
    </div>

    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=Promise"
            crossorigin="anonymous"></script>
    <script src="https://benwinding.github.io/quill-html-edit-button/dist/quill.htmlEditButton.min.js"></script>

    <script type='text/javascript'>

        var curQuillDiv = $("#editor");
        var quill;

        const TEMPLATE_VALID_CHARS = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890#-_ ";
        var clickCount = 0;
        var selectedTemplateId = 0;
        var wasLastClickOnTemplate = false;
        var isCompleted = false;
        var isLoaded = false;

        var consolelog = '';

        var enterKeyBindings = null;

        var isShowingTemplateContextMenu = false;
        var isShowingTemplateColorPaletteMenu = false;
        var isShowingTemplateToolbarMenu = false;
        var isShowingPasteTemplateToolbar = false;
        var isShowingToolbar = true;


        ////////////////////////////////////////////////////////////////////////////////
        /*  These var's can be parsed and replaced with values from app */
        var envName = '';
        var isPastingTemplate = false;
        var fontFamilys = null;
        var fontSizes = null;
        var defaultFontIdx = null;
        var indentSize = 5;
        var htmlContent = '';//"[{\"templateId\":\"-1\",\"templateName\":\"Template #1\",\"templateColor\":\"#402A32\",\"docIdx\":[\"0\",\"3\",\"8\",\"35\"],\"templateText\":\"Template #1\"},{\"templateId\":\"-2\",\"templateName\":\"Template #2\",\"templateColor\":\"#D78484\",\"docIdx\":[\"2\",\"9\",\"32\"],\"templateText\":\"Template #2\"},{\"templateId\":\"-3\",\"templateName\":\"Template #3\",\"templateColor\":\"#165FA4\",\"docIdx\":\"4\",\"templateText\":\"Template #3\"},{\"templateId\":\"-4\",\"templateName\":\"Template #4\",\"templateColor\":\"#912505\",\"docIdx\":\"38\",\"templateText\":\"Template #4\"}]";
        ////////////////////////////////////////////////////////////////////////////////

        function init(html, fontFamilys, fontSizes, defaultFontIdx, indentSize, isFillingTemplates) {
            if(fontFamilys == null) {
                fontFamilys = ['Arial', 'Courier', 'Garamond', 'Tahoma', 'Times New Roman', 'Verdana'];
            }
            if(fontSizes == null) {
                fontSizes = ['8px', '9px', '10px', '12px', '14px', '16px', '20px', '24px', '32px', '42px', '54px', '68px', '84px', '98px'];
            }
            if(defaultFontIdx == null) {
                defaultFontIdx = 0;
            }
            loadQuill(fontFamilys, fontSizes, defaultFontIdx);

            if(envName == '') {

            } else {
                hideToolbar();
            }

            if(isFillingTemplates) {
                showPasteTemplateToolbar();
            }

            isLoaded = true;

            console.log('Quill init called');
        }

        function registerTables() {
            var tableOptions = [];
            var maxRows = 7;
            var maxCols = 7;

            for(let r = 1; r <= maxRows; r++) {
                for(let c = 1; c <= maxCols; c++) {
                    tableOptions.push('newtable_' + r + '_' + c);
                }
            }
            return tableOptions;
        }

        function registerToolbar(fontFamilys, fontSizes, defaultFontIdx) {
            var fonts = registerFonts(fontFamilys);

            var toolbarOptions = [
                //[{ 'size': ['small', false, 'large', 'huge'] }],  // custom dropdown
                [{ 'size': fontSizes }],               // font sizes
                [{ 'font': fonts.whitelist }],
                ['bold', 'italic', 'underline'/*, 'strike'*/],        // toggled buttons
                //['blockquote', 'code-block'],

                // [{ 'header': 1 }, { 'header': 2 }],               // custom button values
                [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                // [{ 'script': 'sub' }, { 'script': 'super' }],      // superscript/subscript
                [{ 'indent': '-1' }, { 'indent': '+1' }],          // outdent/indent
                //[{ 'direction': 'rtl' }],                         // text direction

                // [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                ['link'],// 'image', 'video', 'formula'],
                [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme
                [{ 'align': [] }],
                // ['clean'],                                         // remove formatting button
                // ['templatebutton'],
                [{ 'Table-Input': registerTables() }]
            ];

            return toolbarOptions;
        }

        function registerFonts(fontFamilys, fontSizes, defaultFontIdx) {
            // Specify Quill fonts
            var fontNames = fontFamilys.map(font => getFontName(font));
            var fonts = Quill.import('attributors/class/font');
            fonts.whitelist = fontNames;
            Quill.register(fonts, true);

            //font sizes
            var size = Quill.import('attributors/style/size');
            size.whitelist = fontSizes;
            Quill.register(size, true);

            return fonts;
        }

        function registerFontStyles(fontFamilys) {
            // Add fonts to CSS style
            var fontStyles = "";
            fontFamilys.forEach(function (font) {
                var fontName = getFontName(font);
                fontStyles += ".ql-snow .ql-picker.ql-font .ql-picker-label[data-value=" + fontName + "]::before, .ql-snow .ql-picker.ql-font .ql-picker-item[data-value=" + fontName + "]::before {" +
                    "content: '" + font + "';" +
                    "font-family: '" + font + "', sans-serif;" +
                    "}" +
                    ".ql-font-" + fontName + "{" +
                    " font-family: '" + font + "', sans-serif;" +
                    "}";
            });

            return fontStyles;
        }

        function registerTemplateSpan() {
            const Parchment = Quill.imports.parchment;
            const Delta = Quill.imports.delta;

            class TemplateSpanBlot extends Parchment.EmbedBlot {
                static create(value) {
                    const node = super.create(value);
                    let iId = getUniqueTemplateInstanceId(value.templateId);
                    var textColor = isBright(value.templateColor) ? 'black' : 'white';
                    node.contentEditable = 'false';
                    node.innerText = value.templateName;
                    node.setAttribute('templateName', value.templateName);
                    node.setAttribute('templateColor', value.templateColor);
                    node.setAttribute('templateId', value.templateId);
                    node.setAttribute('templateText', value.templateText);
                    node.setAttribute('instanceId', iId);
                    node.setAttribute('docIdx', value.docIdx);
                    node.setAttribute('isFocus', false);

                    node.setAttribute("spellcheck", "false");
                    node.setAttribute('class', 'template_btn');
                    node.setAttribute('style', 'background-color: ' + value.templateColor + ';color:' + textColor + ';');

                    node.addEventListener('click', function (e) {
                        //console.log(e);
                        focusTemplate(node);
                    });

                    //node.addEventListener('keydown', logKeyDown);
                    //this._addRemovalButton(node);
                    return node;
                }

                static value(domNode) {
                    return {
                        docIdx: domNode.getAttribute('docIdx'),
                        templateId: domNode.getAttribute('templateId'),
                        instanceId: domNode.getAttribute('instanceId'),
                        isFocus: domNode.getAttribute('isFocus'),
                        templateName: domNode.getAttribute('templateName'),
                        templateColor: domNode.getAttribute('templateColor'),
                        templateText: domNode.getAttribute('templateText'),
                    }
                }

                static _addRemovalButton(node) {
                    const button = document.createElement('button');
                    button.innerText = 'x';
                    button.onclick = () => node.remove();
                    button.contentEditable = 'false';
                    node.appendChild(button);

                    // Extra span forces the cursor to the end of the label, otherwise it appears inside the removal button
                    const span = document.createElement('span');
                    span.innerText = ' ';
                    node.appendChild(span);
                }
            }
            TemplateSpanBlot.blotName = 'templatespan';
            TemplateSpanBlot.tagName = 'SPAN';
            TemplateSpanBlot.className = 'ql-templatespan';

            Quill.register(TemplateSpanBlot);
        }

        function loadQuill(fontFamilys, fontSizes, defaultFontIdx, indentSize) {
            if(isLoaded) {
                return;
            }

            Quill.register("modules/htmlEditButton", htmlEditButton);
            Quill.register({ 'modules/better-table': quillBetterTable }, true);

            registerTemplateSpan();

            // Append the CSS stylesheet to the page
            var node = document.createElement('style');
            node.innerHTML = registerFontStyles(fontFamilys);
            document.body.appendChild(node);

            quill = new Quill(curQuillDiv[0], {
                placeholder: '',
                theme: 'snow',
                modules: {
                    toolbar: registerToolbar(fontFamilys, fontSizes, defaultFontIdx),
                    htmlEditButton: {
                        syntax: true,
                    },
                    table: false,
                    'better-table': {
                        operationMenu: {
                            items: {
                                unmergeCells: {
                                    text: 'Unmerge cells'
                                }
                            },
                            color: {
                                colors: ['green', 'red', 'yellow', 'blue', 'white'],
                                text: 'Background Colors:'
                            }
                        }
                    },
                    keyboard: {
                        bindings: quillBetterTable.keyboardBindings
                    }
                }
            });

            var curTableIconSpan = curQuillDiv.parent().find('span.ql-Table-Input.ql-picker')[0].childNodes[0];
            curTableIconSpan.innerHTML = "<svg style=\"right: 4px;\" viewbox=\"0 0 18 18\"> <rect class=ql-stroke height=12 width=12 x=3 y=3></rect> <rect class=ql-fill height=2 width=3 x=5 y=5></rect> <rect class=ql-fill height=2 width=4 x=9 y=5></rect> <g class=\"ql-fill ql-transparent\"> <rect height=2 width=3 x=5 y=8></rect> <rect height=2 width=4 x=9 y=8></rect> <rect height=2 width=3 x=5 y=11></rect> <rect height=2 width=4 x=9 y=11></rect> </g> </svg>";
            var curTableCellIconSpans = $(curTableIconSpan.parentNode.childNodes[1]).children();
            curTableCellIconSpans.click((function () {
                var curQuillBetterTable = quill.getModule('better-table');
                var curQuillToolbar = quill.getModule('toolbar');
                return function () {
                    var curRowIndex = Number(this.dataset.value.substring(9).split('_')[0]);
                    var curColIndex = Number(this.dataset.value.substring(9).split('_')[1]);
                    curQuillBetterTable.insertTable(curRowIndex, curColIndex);
                    // The following two lines have been added, thinking that it would fix the issue of keeping the icon in blue color.  However Quill keeps adding the classes back, so this fix doesn't work.
                    $(this).parent().parent().find(".ql-selected").removeClass("ql-selected"); $(this).parent().parent().find(".ql-active").removeClass("ql-active");
                };
            })());
            curTableCellIconSpans.hover(function () {
                var curRowIndex = Number(this.dataset.value.substring(9).split('_')[0]);
                var curColIndex = Number(this.dataset.value.substring(9).split('_')[1]);
                $(this).parent().children().each((function () {
                    var curRowIndex1 = curRowIndex;
                    var curColIndex1 = curColIndex;
                    return function () {
                        var curRowIndex2 = Number(this.dataset.value.substring(9).split('_')[0]);
                        var curColIndex2 = Number(this.dataset.value.substring(9).split('_')[1]);
                        if(curRowIndex2 <= curRowIndex1 && curColIndex2 <= curColIndex1) {
                            $(this).addClass("ql-picker-item-highlight");
                        }
                    };
                })());
            }, function () {
                $(this).parent().children().removeClass("ql-picker-item-highlight");
            });

            // Add a custom Button to the Quill Editor's toolbar:
            const templateToolbarButton = new QuillToolbarButton({
                icon: '<img id="templateToolbarButton" style="height:20px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAaVBMVEX/////wQf/vwD/24f/3Iz///3/vQD/ykL/yTj/yT3/0WH/0F7/0Fv/y0T/y0f/yTr/35T/wxT/8tP/6Lj/5az/7sj/9uX/46P/1G7/677/57P/2oL/xSj/8M//1nj//fb//O//4Zz/zVBsBjAmAAAEzklEQVR4nO2di3qiMBBGIUpa1168tFZ70933f8hl0KqVWCuZyfzhm/MAfJ7vhAmwCy0KwzAMwzAMwzAMwzAMwzAMWKq3QSzDyXymrXGe6ta7eLwvl8/aKmGqW1fy4Pz0SdsmAJ9g4zhaaAudwirYOIJl5Bas8QNtqWMEBLEURQRrRZiFKiRYK4KMGzHB0j1ouzXICdYR59p2haxg6d619YQF64gfPRcs3ae24KOsYOmmyoLCBUvtDSOBYOk176TEl2hjqHhdw1WwvuetOXcsN9ET5Cno/PJ1tvh4Gp9xdEM1QZ6C/m29O+Dmj4cyZCroV0fHfAkpahlyFfw+KEOKSoZcBU9//bh9WB1Dtn3w9MCbdkQVQ7Ztov3j71pH1jBk2+h9++n2UyuigiHfpZrftA7+AWDIeKnm162jL/QNOS+2Aw1n6oasF9uB83Cubch7uxS4qF4qz9JqxHq71L5/Xyvvh+z3g/40YjthUkOBG96TM7F9FiY1ZF6i25/vjhVXuvcWUv/4sl+o60/d+0OJglvF6XC2WS+eP53uPb7gUzV34TlNGkOxgpdJY5jiuaiqoWLBNIZJHvxqGuoKJjBUXaIpDDWHTBJD7YLihuoFxQ3VCwob6i9RacMbAEFJwwpCUNIQQ1DOEKSgoCHCkGkQMoQpKGUIsU3skDHEKShjiFRQxhCpoIQh0JBp4DcEE2Q3RCvIbwg1ZBp4DfEKMhtibRM7WA3vAQU5DRGXaMlqCFmQ0RC0IKMhqiCXYQW6REs2Q9iCXIa4BZkMgQvyGCIX5DCE3SZ2xBtiF4w3RC8YbwgvGGkIvNHviTPELxhpmEHBOMMcCkYZPmQh2H77q2cFS/dQ9bugu+laMIshE/Ntk1wEOxccB//POBzdC75lInjfVfC574LFNIuTMOIDSn+zSNh9yBRV3wsWrzkkjCgYeh8cj6iPmOWwSKMKBl4lhsPdd73YbsA/DeMKFsUEfZW6m6iCRTEAN4y4ksnDMLog+iqNLxh+XRqG2CHTgLxbcBSE3vFZChbBTzFhELnRH0A9EbkK1mirhGHYJvYEv/umDc+Q+eId70zkLFggbhi8BWsmYIqMQ+aLJZQie0EC6aG3GwkIFkX4W6EaMA8ZPEWBc/ALjIUqVpBAqChYkLhTV3QjwYKEdkXhgoRuRfGChGZF0SFzQG+iCm30bbQqJiqop5hgyBzQWKgJCxLpKyYtSKTeNJJsE99JWzF5QSJlRYWCRLqKiYfMgVQT1d0qCaaqqLRE0ym6R0XBFAtVWVC+ouoS3SK7aSgOmQOSFQEKEnIVIQoSUhVBChIyExWmICFREaggwa+ovg+ewr1Q4QS5K4It0S2cmwbUkDnAVxGyIMFVEbQgwVMRcMgc4JiowAWJ+IrQBYlYRfCCRNxCzUAwriL8Et3SfdPIoiDRtWImBYluFbMpSHSpmFFB4vqJmlVB4tqKmRUkrlPMriBxzULNUvCaihku0S2/3TQyLUj8rmK2BYnfVMy4IHG5YuaClydq9oKXKvZA8GfFXgj+tFB7Inj+hSLf+btqcEyCf7nXL7V/FyOz91ZGX660fxUvL+VxR+fdpDcrdM9q7Lx3jv7gtPv32j8/oprNJ8PB5HXWTz3DMAzDMAzDMAzDMAzDMHrEf9VjaGNa1FYRAAAAAElFTkSuQmCC"></img>'//`<svg viewBox="0 0 18 18"> <path class="ql-stroke" d="M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3"></path></svg>`
            })

            templateToolbarButton.onClick = function (e) {
                var templateButton = document.getElementById('templateToolbarButton');
                var tl = getTemplates();
                if(tl.length > 0) {
                    showTemplateToolbarContextMenu(templateButton);
                } else {
                    createTemplate();
                }
            }
            templateToolbarButton.attach(quill)

            document.addEventListener('click', function (e) {
                //console.log(e.target);
                //if(getFocusTemplateElement() == null) {
                //    hideTemplateToolbarContextMenu();
                //    hideTemplateContextMenu();
                //}
                if(clickCount > 0) {
                    if(isShowingTemplateToolbarMenu) {
                        hideTemplateToolbarContextMenu();
                    }
                    if(isShowingTemplateContextMenu) {
                        hideTemplateContextMenu();
                    }
                    if(isShowingTemplateColorPaletteMenu) {
                        hideTemplateColorPaletteMenu();
                    }
                } else {
                    clickCount++;
                    if(!wasLastClickOnTemplate) {
                        clearTemplateSelection();
                        //hidePasteTemplateToolbar();
                    } else if(!isShowingPasteTemplateToolbar) {
                        //showPasteTemplateToolbar();
                    }
                    wasLastClickOnTemplate = false;
                }
                return;
            });

            const Parchment = Quill.import('parchment');

            let lastClickEvent = null;

            this.quill.root.addEventListener('click', (e) => {
                lastClickEvent = e;

                //let image = Parchment.find(ev.target);

                //if(image instanceof ImageBlot) {
                //    this.quill.setSelection(image.offset(this.quill.scroll), 1, 'user');
                //}

                if(isRenamingTemplate()) {
                    if(e.target.getAttribute('templateId') == null ||
                        e.target.getAttribute('contenteditable') == false) {
                        endSetTemplateName();
                    }

                    //let tl = getTemplatesFromRange(range);
                    //let isRenaming = false;
                    //tl.forEach(function (t) {
                    //    let tid = t.getAttribute('templateId');
                    //    let iid = t.getAttribute('instanceId');
                    //    let te = getTemplateElement(tid, iid);
                    //    let isEditable = te.getAttribute('contenteditable');
                    //    if(isEditable != null || isEditable == false) {
                    //        isRenaming = true;
                    //        return;
                    //    }
                    //})
                    //if(tl == null || !isRenaming) {
                    //    endSetTemplateName();
                    //}
                    //clearTemplateFocus();
                    //quill.setSelection(oldRange);
                }
            });

            quill.on('selection-change', function (range, oldRange, source) {
                //if(isRenamingTemplate()) {

                //    // Given DOM node, find corresponding Blot.
                //    // Bubbling is useful when searching for a Embed Blot with its corresponding
                //    // DOM node's descendant nodes.
                //    let s = Parchment.find(domNode: Node, bubble: boolean = false): Blot;

                //    find(lastClickEvent.target);

                //    if(s instanceof TemplateSpanBlot) {
                //        // TODO make sure s has contenteditable or its a different template
                //        return;
                //    } else {
                //        endSetTemplateName();
                //    }

                //    //clearTemplateFocus();
                //    //quill.setSelection(oldRange);
                //}      


                if(range) {
                    if(range.length == 0) {
                        console.log('User cursor is on', range.index);
                    } else {
                        var text = quill.getText(range.index, range.length);
                        console.log('User has highlighted', text);
                    }

                } else {
                    console.log('Cursor not in the editor');
                }
            });

            quill.on('text-change', function (delta, oldDelta, source) {
                var retainVal = 0;
                var textDelta = 0;
                var wasAddTemplate = false;
                delta.ops.forEach(function (op) {
                    if(op.insert != null && op.insert.templatespan != null) {
                        //handle shifting in create template
                        wasAddTemplate = true;
                        return;
                    }
                    if(op.retain != null) {
                        retainVal = op.retain;
                    }
                    if(op.insert != null && op.insert.templatespan == null) {
                        textDelta += op.insert.length;
                    }
                    if(op.delete != null) {
                        textDelta -= parseInt(op.delete);
                    }
                });
                if(!wasAddTemplate && textDelta != 0 && retainVal >= 0) {
                    shiftTemplates(retainVal, textDelta);
                    //console.log(getTemplates());
                }
            });
        }

        function shiftTemplates(fromDocIdx, byVal) {
            var tl = getTemplates();
            tl.forEach(function (t) {
                if(Array.isArray(t.docIdx)) {
                    t.docIdx.forEach(function (tDocIdx) {
                        if(tDocIdx >= fromDocIdx) {
                            setTemplateDocIdx(t, tDocIdx, parseInt(parseInt(tDocIdx) + parseInt(byVal)));
                        }
                    });
                } else {
                    if(parseInt(t.docIdx) >= fromDocIdx) {
                        setTemplateDocIdx(t, t.docIdx, parseInt(parseInt(t.docIdx) + parseInt(byVal)));
                    }
                }
            });
        }

        function getTemplatesFromRange(range) {
            if(range == null || range.index == null) {
                console.log('invalid range: ' + range);
            }
            let tl = [];
            getTemplatesByDocOrder().forEach(function (tn) {
                let docIdx = tn.docIdx;
                if(docIdx >= range.index && docIdx <= range.index + range.length) {
                    tl.push(tn);
                }
            });
            return tl;
        }

        function loadTemplates() {
            var html = getHtml();
            var idx = 0;
            var lenDiff = 0;
            while(true) {
                if(idx >= html.length) {
                    break;
                }
                var tt = findNextTemplateToken(idx + lenDiff, html);
                if(tt == null) {
                    break;
                }
                var ttIdx = tt.sIdx;
                var ttLen = tt.length;
                delete tt.sIdx;
                delete tt.length;
                idx = createTemplate(tt, idx, ttLen);
                lenDiff = getHtml().length - html.length + ttLen;
                html = getHtml();
            }
        }

        function findNextTemplateToken(fIdx, text, sToken = '{{', eToken = '}}', sep = ',') {
            text = text.substring(fIdx);
            var tsIdx = text.indexOf(sToken);
            var teIdx = text.indexOf(eToken);

            if(tsIdx < 0 || teIdx < 0) {
                return null;
            }

            var templateSpan = text.substring(tsIdx + sToken.length, teIdx);
            var templateParts = templateSpan.split(sep);

            if(templateParts.length != 3) {
                return null;
            }
            return {
                templateId: templateParts[0],
                templateName: templateParts[1],
                templateColor: templateParts[2],
                sIdx: fIdx + tsIdx,
                length: teIdx - tsIdx + eToken.length
            };
        }

        function createTemplate(templateObjOrId, idx, len) {
            var templateObj = templateObjOrId;
            if(templateObj === parseInt(templateObj, 10)) {
                templateObj = getTemplateById(templateObjOrId);
            }
            var range = quill.getSelection(true);
            if(idx != null && length != null) {
                range = { index: idx, length: len };
            }

            var tl = getTemplates();
            var isNew = templateObj == null;
            var newTemplateObj = templateObj;
            if(isNew) {
                newTemplateObj = {
                    templateId: getNewTemplateId(),
                    templateColor: getRandomColor(),
                    templateName: quill.getText(range.index, range.length).trim()
                };
            }
            newTemplateObj.docIdx = range.index;

            if(range.length == 0 && isNew) {
                newTemplateObj['templateName'] = getLowestAnonTemplateName();
            }

            quill.deleteText(range.index, range.length, Quill.sources.SILENT);
            if(Math.abs(parseInt(range.length)) > 0) {
                shiftTemplates(range.index, -range.length);
            }
            shiftTemplates(range.index, 1);
            quill.insertEmbed(range.index, "templatespan", newTemplateObj, Quill.sources.SILENT);
            var eofIdx = quill.getLength();
            if(range.index + newTemplateObj['templateName'].length >= eofIdx) {
                quill.insertText(range.index + 1, ' ', Quill.sources.SILENT);
            }
            quill.setSelection(range.index + 1, Quill.sources.API);

            selectTemplate(newTemplateObj['templateId'], true);

            console.log(getTemplates());
            return range.index;
        }

        function getLowestAnonTemplateName(anonPrefix = 'Template #') {
            var tl = getTemplates();
            var maxNum = 0;
            tl.forEach(function (t) {
                if(t.templateName.startsWith(anonPrefix)) {
                    var anonNum = parseInt(t.templateName.substring(anonPrefix.length));
                    maxNum = Math.max(maxNum, anonNum);
                }
            });
            return anonPrefix + (parseInt(maxNum) + 1);
        }

        function getNewTemplateId() {
            var tl = getTemplates();
            var minId = 0;
            tl.forEach(function (t) {
                minId = Math.min(minId, t.templateId);
            });
            return (parseInt(minId) - 1);
        }

        function clearTemplateSelection() {
            var stl = document.getElementsByClassName("template_btn");
            for(var i = 0; i < stl.length; i++) {
                var t = stl[i];
                t.style.border = "";
            }
        }

        function selectTemplate(templateId, fromDropDown, iId) {
            if(templateId == null || isRenamingTemplate()) {
                return;
            }

            var stl = document.getElementsByClassName("template_btn");
            for(var i = 0; i < stl.length; i++) {
                var t = stl[i];
                if(t.getAttribute('templateid') == templateId) {
                    if(isPastingTemplate) {
                        $('#templateTextArea').placeholder = "Enter text for " + t.innerText;
                        if(t.innerText != getTemplateById(templateId)['templateName']) {
                            $('#templateTextArea').val(t.innerText);
                        } else {
                            $('#templateTextArea').val('');
                        }
                    }
                    selectedTemplateId = templateId;
                    t.style.border = "2px solid red";
                    if(iId != null && t.getAttribute('instanceId') == iId) {
                        t.style.border = "2px solid lightseagreen";
                    }
                } else {
                    t.style.border = "";
                }
            }
            if(fromDropDown == null || !fromDropDown) {
                if(isPastingTemplate) {
                    //when user clicks a template this will adjust to drop dwon to the clicked element
                    var items = document.getElementById('custom-select').getElementsByTagName("div");
                    for(var i = 0; i < items.length; i++) {
                        if(items[i].getAttribute('optionId') != null && items[i].getAttribute('optionId') == selectedTemplateId) {
                            eventFire(items[i], 'click');
                            break;
                        }
                    }
                }
                //moved from quill embed constructor maybe causing selection issue on android
                wasLastClickOnTemplate = true;

                hideAllContextMenus();
                showTemplateContextMenu(getFocusTemplateElement());
            }
        }

        function isTemplateSelected() {
            var selectionHtml = getSelectedHtml();
            return selectionHtml.includes('template_btn');
        }

        function getTemplateElement(tId, iId) {
            var tel = [];
            var stl = document.getElementsByClassName("template_btn");
            for(var i = 0; i < stl.length; i++) {
                let t = stl[i];
                let ctid = parseInt(t.getAttribute('templateId'));
                let ciid = parseInt(t.getAttribute('instanceId'));
                if(ctid == tId) {
                    if(iId == null) {
                        tel.push(t);
                    } else if(ciid == iId) {
                        return t;
                    }
                }
            }
            return iId == null ? tel : null;
        }

        function focusTemplate(tn) {
            clearTemplateFocus();
            hideAllContextMenus();
            let tId = tn.getAttribute('templateId');
            let iId = parseInt(tn.getAttribute('instanceId'));
            let te = getTemplateElement(tId, iId);
            te.isFocus = true;
            te.setAttribute('isFocus', true);
            selectTemplate(tId, false, iId);
        }

        function clearTemplateFocus() {
            var stl = document.getElementsByClassName("template_btn");
            for(var i = 0; i < stl.length; i++) {
                var t = stl[i];
                t.isFocus = false;
            }
        }

        function getFocusTemplateElement() {
            var stl = document.getElementsByClassName("template_btn");
            for(var i = 0; i < stl.length; i++) {
                var t = stl[i];
                if(t.isFocus == true) {
                    return t;
                }
            }
            return null;
        }

        function renameTemplateClick(tId, iId) {
            startSetTemplateName(tId, iId);
        }

        function changeTemplateColorClick(tId, iId) {
            hideTemplateContextMenu();

            if(isShowingTemplateColorPaletteMenu) {
                hideTemplateColorPaletteMenu();
            }
            let te = getTemplateElement(tId, iId);
            showTemplateColorPaletteMenu(te);
        }

        function colorPaletteItemClick(tId, chex) {
            let tel = getTemplateElement(tId);

            for(var i = 0; i < tel.length; i++) {
                var te = tel[i];
                te.style.backgroundColor = chex;
                te.setAttribute('templateColor', chex);
            }
        }

        function deleteAllTemplateClick(tId) {
            var stl = document.getElementsByClassName("template_btn");
            for(var i = 0; i < stl.length; i++) {
                var t = stl[i];
                if(t.getAttribute('templateId') == tId) {
                    t.parentNode.removeChild(t);
                }
            }
        }

        function eventFire(el, etype) {
            if(el.fireEvent) {
                el.fireEvent('on' + etype);
            } else {
                var evObj = document.createEvent('Events');
                evObj.initEvent(etype, true, false);
                el.dispatchEvent(evObj);
            }
        }

        function templateTextAreaChange() {
            var curText = $('#templateTextArea').val();
            setTemplateText(selectedTemplateId, curText);
        }

        function setTemplateText(templateId, text) {
            var stl = document.getElementsByClassName("template_btn");
            for(var i = 0; i < stl.length; i++) {
                var t = stl[i];
                if(t.getAttribute('templateid') == templateId) {
                    t.innerText = text;
                    t.templateText = text;
                }
            }
        }

        function setTemplateName(tid, iid, name) {
            var stl = document.getElementsByClassName("template_btn");
            for(var i = 0; i < stl.length; i++) {
                var te = stl[i];
                let ctid = parseInt(te.getAttribute('templateid'));
                let ciid = parseInt(te.getAttribute('instanceId'));
                if(ctid == tid) {
                    te.setAttribute('templateName', name);
                    if(ciid != iid) {
                        //te.innerText = name;
                        te.innerHTML = name;
                        //console.table(te);
                    }
                }
            }
        }

        var origTemplateName = null;

        function startSetTemplateName(tId, iId) {
            enterKeyBindings = disableKey('Enter');
            document.addEventListener('keypress', logKeyPress);
            document.addEventListener('keydown', logKeyDown);

            var stl = document.getElementsByClassName("template_btn");
            for(var i = 0; i < stl.length; i++) {
                let te = stl[i];
                te.setAttribute('contentEditable', false);
                te.style.cursor = "pointer";
                te.style.caretColor = "transparent";

                let ctId = te.getAttribute('templateId');
                let ciId = te.getAttribute('instanceId');
                if(ctId != tId && ciId != iId) {
                    continue;
                }

                te.setAttribute('contentEditable', true);
                te.style.cursor = "text";
                te.style.caretColor = "black";

                origTemplateName = te.innerText;
                selectText(te);
            }
            hideTemplateContextMenu();
        }

        function endSetTemplateName(wasCancel) {
            let fte = getFocusTemplateElement();
            var stl = document.getElementsByClassName("template_btn");
            for(var i = 0; i < stl.length; i++) {
                var t = stl[i];
                t.contentEditable = false;
                t.style.cursor = "pointer";
                t.style.caretColor = "transparent";
                if(t.getAttribute('templateId') == fte.getAttribute('templateId') && wasCancel == true) {
                    t.setAttribute('templateName', origTemplateName);
                    t.innerText = origTemplateName;
                }
            }

            reenableKey('Enter', enterKeyBindings);
            enterKeyBindings = null;

            origTemplateName = null;

            document.removeEventListener('keypress', logKeyPress);
            document.removeEventListener('keydown', logKeyDown);
        }

        function logKeyPress(e) {
            let fte = getFocusTemplateElement();
            setTemplateName(parseInt(fte.getAttribute('templateId')), parseInt(fte.getAttribute('instanceId')), fte.innerText);
        }

        function logKeyDown(e) {
            if(!isRenamingTemplate) {
                return;
            }

            if(e.code == "Escape") {
                endSetTemplateName(true);
                return;
            }
            if(e.code == "Enter") {
                e.preventDefault();
                endSetTemplateName(false);
                return;
            }

            //if(!TEMPLATE_VALID_CHARS.includes(String.fromCharCode(e.keyCode))) {
            //    e.preventDefault();
            //}
        }

        function disableKey(keyName) {
            var tempBindings = null;

            var keyboard = quill.getModule('keyboard');
            tempBindings = keyboard.bindings[keyName];
            keyboard.bindings[keyName] = null;

            return tempBindings;
        }

        function reenableKey(keyName, bindings) {
            var keyboard = quill.getModule('keyboard');
            keyboard.bindings[keyName] = bindings;
        }

        function selectText(elm) {
            if(document.body.createTextRange) {
                const range = document.body.createTextRange();
                range.moveToElementText(elm);
                range.select();
            } else if(window.getSelection) {
                const selection = window.getSelection();
                const range = document.createRange();
                range.selectNodeContents(elm);
                selection.removeAllRanges();
                selection.addRange(range);
            } else {
                console.warn("Could not select text in node: Unsupported browser.");
            }
        }

        function isRenamingTemplate() {
            var stl = document.getElementsByClassName("template_btn");
            for(var i = 0; i < stl.length; i++) {
                var t = stl[i];
                if(t.contentEditable == "true") {
                    return true;
                }
            }
            return false;
        }

        function setTemplateDocIdx(t, oldIdx, newIdx) {
            var domTemplates = document.getElementsByClassName("template_btn");
            for(var i = 0; i < domTemplates.length; i++) {
                var domTemplate = domTemplates[i];
                var template = {
                    templateId: domTemplate.getAttribute('templateId'),
                    templateName: domTemplate.getAttribute('templateName'),
                    templateColor: domTemplate.getAttribute('templateColor'),
                    docIdx: domTemplate.getAttribute('docIdx'),
                    templateText: domTemplate.innerText
                }
                if(template.templateId == t.templateId && template.docIdx == oldIdx) {
                    domTemplate.setAttribute('docIdx', newIdx);
                    return;
                }
            }
        }

        function getTemplates() {
            var domTemplates = document.getElementsByClassName("template_btn");
            var templates = [];
            for(var i = 0; i < domTemplates.length; i++) {
                var domTemplate = domTemplates[i];
                var template = {
                    templateId: domTemplate.getAttribute('templateId'),
                    templateName: domTemplate.getAttribute('templateName'),
                    templateColor: domTemplate.getAttribute('templateColor'),
                    docIdx: domTemplate.getAttribute('docIdx'),
                    isFocus: domTemplate.getAttribute('isFocus'),
                    instanceId: domTemplate.getAttribute('instanceId'),
                    templateText: domTemplate.innerText
                }
                var curTemplateIdx = -1;
                for(var j = 0; j < templates.length; j++) {
                    if(templates[j]['templateId'] == template['templateId']) {
                        curTemplateIdx = j;
                        break;
                    }
                }
                if(curTemplateIdx >= 0) {
                    if(Array.isArray(templates[curTemplateIdx].docIdx)) {
                        templates[curTemplateIdx].docIdx.push(template.docIdx);
                    } else {
                        templates[curTemplateIdx].docIdx = [templates[curTemplateIdx].docIdx, template.docIdx];
                    }
                } else {
                    templates.push(template);
                }
            }
            return templates;
        }

        function getTemplatesJson() {
            return JSON.stringify(getTemplates());
        }

        function getTemplateById(templateId) {
            var tl = getTemplates();
            for(var i = 0; i < tl.length; i++) {
                var t = tl[i];
                if(t['templateId'] == templateId) {
                    return t;
                }
            }
            return null;
        }

        function showTemplateToolbarContextMenu(tb) {
            clickCount = 0;

            var rgtClickContextMenu = document.getElementById('templateToolbarMenu');
            var rgtClickContextMenuList = document.getElementById('templateToolbarMenuList');
            rgtClickContextMenuList.innerHTML = '';

            var tl = getTemplates();
            var listItemPrefix = 'templateListItem_';
            for(var i = 0; i < tl.length; i++) {
                var t = tl[i];
                var itemId = listItemPrefix + t.templateId;
                var templateItem = '<li><a onclick="createTemplate(' + t['templateId'] + ');">' +
                    '<div style="display:inline-block;margin: 0 5px 0 0;width: 15px; height: 15px;background-color:' + t['templateColor'] + '"></div>' +
                    '<span style="font-family:arial;">' + t['templateName'] + '</span></a></li>';
                rgtClickContextMenuList.innerHTML += templateItem;
            }

            rgtClickContextMenuList.innerHTML += '<li><a href="javascript:void(0);" onclick="createTemplate();">' +
                '<span style="margin: 0 5px 0 0;color:lightseagreen;font-size:20px">+</span>' +
                '<span style="font-family:arial;">Add Template</span></a></li>';
            const rect = tb.getBoundingClientRect();
            const x = rect.left + 20;
            const y = rect.bottom;
            rgtClickContextMenu.style.left = `${x}px`;
            rgtClickContextMenu.style.top = `${y}px`;
            rgtClickContextMenu.style.display = 'block';

            isShowingTemplateToolbarMenu = true;
        }

        function hideTemplateToolbarContextMenu() {
            var rgtClickContextMenu = document.getElementById('templateToolbarMenu');
            rgtClickContextMenu.style.display = 'none';

            isShowingTemplateToolbarMenu = false;
        }

        function showTemplateContextMenu(te) {
            if(te == null) {
                return;
            }
            if(isShowingTemplateContextMenu) {
                hideTemplateContextMenu();
            }
            clickCount = 0;

            var rgtClickContextMenu = document.getElementById('templateContextMenu');
            var rgtClickContextMenuList = document.getElementById('templateContextMenuList');
            rgtClickContextMenuList.innerHTML = '';

            let tId = te.getAttribute('templateId');
            let iId = te.getAttribute('instanceId');
            var context_items = [
                { icon_class: 'template_rename_icon', label: '   Rename', func: 'renameTemplateClick' },
                { icon_class: 'template_color_icon', label: '   Change Color', func: 'changeTemplateColorClick' },
                { icon_class: 'template_delete_icon', label: '   Delete All', func: 'deleteAllTemplateClick' }];

            context_items.forEach(function (ci) {
                var context_item = '<li><a href="javascript:void(0);" onclick="' + ci.func + '(' + tId + ',' + iId + ');">' +
                    '<div class="template_context_item ' + ci.icon_class + '"></div> ' +
                    '<span style="font-family:arial;">' + ci.label + '</span></a></li>';
                rgtClickContextMenuList.innerHTML += context_item;
            });

            const rect = te.getBoundingClientRect();
            const x = rect.left + 20;
            const y = rect.bottom;
            rgtClickContextMenu.style.left = `${x}px`;
            rgtClickContextMenu.style.top = `${y}px`;
            rgtClickContextMenu.style.display = 'block';

            isShowingTemplateContextMenu = true;
        }

        function hideTemplateContextMenu() {
            var rgtClickContextMenu = document.getElementById('templateContextMenu');
            rgtClickContextMenu.style.display = 'none';

            isShowingTemplateContextMenu = false;
        }

        function showTemplateColorPaletteMenu(te) {
            if(te == null) {
                return;
            }
            if(isShowingTemplateColorPaletteMenu) {
                hideTemplateColorPaletteMenu();
            }
            clickCount = 0;

            let tId = te.getAttribute('templateId');
            var palette_item = {
                style_class: 'template_color_palette_item',
                func: 'colorPaletteItemClick'
            };


            let paletteHtml = '<table>';
            for(var r = 0; r < 10; r++) {
                paletteHtml += '<tr>';
                for(var c = 0; c < 10; c++) {
                    let c = getRandomColor().trim();
                    let item = '<td><a href="javascript:void(0);" onclick="' + palette_item.func + '(' + tId + ',\'' + c + '\');">' +
                        '<div class="' + palette_item.style_class + '" style="background-color: ' + c + '" ></div></a></td > ';
                    paletteHtml += item;
                }
                paletteHtml += '</tr>';
            }

            var rgtClickColorPaletteMenu = document.getElementById('templateColorPaletteMenu');
            rgtClickColorPaletteMenu.innerHTML = paletteHtml;


            const rect = te.getBoundingClientRect();
            const x = rect.left + 20;
            const y = rect.bottom;
            rgtClickColorPaletteMenu.style.left = `${x}px`;
            rgtClickColorPaletteMenu.style.top = `${y}px`;
            rgtClickColorPaletteMenu.style.display = 'block';

            isShowingTemplateColorPaletteMenu = true;
        }

        function hideTemplateColorPaletteMenu() {
            var rgtClickColorPaletteMenu = document.getElementById('templateColorPaletteMenu');
            rgtClickColorPaletteMenu.style.display = 'none';

            isShowingTemplateColorPaletteMenu = false;
        }

        function hideAllContextMenus() {
            hideTemplateColorPaletteMenu();
            hideTemplateContextMenu();
            hideTemplateToolbarContextMenu();
        }


        function showPasteTemplateToolbar() {
            isShowingPasteTemplateToolbar = true;
            var ptt = document.getElementById('pasteTemplateToolbar');
            ptt.style.display = 'inline-block';

            document.getElementById('custom-select').innerHTML = '<select id="pasteTemplateToolbarMenuSelector"></select >';

            var templateMenuSelector = document.getElementById('pasteTemplateToolbarMenuSelector');
            templateMenuSelector.innerHTML = '';

            var tl = getTemplates();
            for(var i = 0; i < tl.length; i++) {
                var t = tl[i];
                var templateItem = '<option class="templateOption" value="' + t['templateId'] + '" onchange="selectTemplate(' + t['templateId'] + ');">' +
                    t['templateName'] + '</option>';
                templateMenuSelector.innerHTML += templateItem;
            }


            document.getElementById('nextTemplateButton').addEventListener('click', function (e) {
                gotoNextTemplate();
            });
            document.getElementById('nextTemplateButton').addEventListener('keydown', function (e) {
                gotoNextTemplate();
            });
            document.getElementById('previousTemplateButton').addEventListener('click', function (e) {
                gotoPrevTemplate();
            });
            document.getElementById('previousTemplateButton').addEventListener('keydown', function (e) {
                gotoPrevTemplate();
            });
            document.getElementById('clearAllTemplateTextButton').addEventListener('click', function (e) {
                clearAllTemplateText();
            });
            document.getElementById('clearAllTemplateTextButton').addEventListener('keydown', function (e) {
                clearAllTemplateText();
            });
            document.getElementById('pasteTemplateButton').addEventListener('click', function (e) {
                isCompleted = true;
            });
            document.getElementById('pasteTemplateButton').addEventListener('keydown', function (e) {
                isCompleted = true;
            });

            createTemplateSelectorStyling(templateMenuSelector);


            let tbb = isShowingToolbar ? $(".ql-toolbar").outerHeight() : 0;
            moveToolbarTop(0);
            moveTemplateToolbarTop(tbb);
            moveEditorTop($("#pasteTemplateToolbar").outerHeight() + tbb);

            $('#templateTextArea').focus();
        }

        function hidePasteTemplateToolbar() {
            isShowingPasteTemplateToolbar = false;
            var ptt = document.getElementById('pasteTemplateToolbar');
            ptt.style.display = 'none';
            if(isShowingToolbar) {
                moveEditorTop($(".ql-toolbar").outerHeight());
            } else {
                moveEditorTop(0);
            }
        }

        function gotoNextTemplate() {
            var curIdx = 0;
            for(var i = 0; i < tl.length; i++) {
                if(tl[i]['templateId'] == selectedTemplateId) {
                    curIdx = i;
                    break;
                }
            }
            var nextIdx = curIdx + 1;
            if(nextIdx >= tl.length) {
                nextIdx = 0;
            }
            selectTemplate(tl[nextIdx]['templateId']);
        }

        function gotoPrevTemplate() {
            var curIdx = 0;
            for(var i = 0; i < tl.length; i++) {
                if(tl[i]['templateId'] == selectedTemplateId) {
                    curIdx = i;
                    break;
                }
            }
            var prevIdx = curIdx - 1;
            if(prevIdx < 0) {
                prevIdx = tl.length - 1;
            }
            selectTemplate(tl[prevIdx]['templateId']);
        }

        function clearAllTemplateText() {
            var tl = getTemplates();
            for(var i = 0; i < tl.length; i++) {
                setTemplateText(tl[i]['templateId'], '');
            }
        }

        function createTemplateSelectorStyling() {
            var tl = getTemplates();
            var x, i, j, selElmnt, a, b, c;
            x = document.getElementsByClassName("custom-select");
            for(i = 0; i < x.length; i++) {
                selElmnt = x[i].getElementsByTagName("select")[0];
                if(selElmnt.options.length == 0) {
                    continue;
                }
                var st = getTemplateById(selElmnt.options[selElmnt.selectedIndex].getAttribute('value'));
                a = document.createElement("DIV");
                a.setAttribute("class", "select-selected");
                a2 = document.createElement("SPAN");
                a2.setAttribute("class", "square-box");
                a2.setAttribute("style", "background-color: " + st['templateColor']);
                a.appendChild(a2);
                a.innerHTML += '<span style="margin: 0 10px 0 50px;">' + selElmnt.options[selElmnt.selectedIndex].innerHTML + '</span>';
                x[i].appendChild(a);
                b = document.createElement("DIV");
                b.setAttribute("class", "select-items select-hide");
                for(j = 0; j < selElmnt.length; j++) {
                    var t = getTemplateById(selElmnt.options[j].getAttribute('value'));
                    c = document.createElement("DIV");
                    c.setAttribute('optionId', parseInt(t['templateId']));
                    //c.innerHTML = selElmnt.options[j].innerHTML;
                    d = document.createElement("SPAN");
                    d.setAttribute("class", "square-box");
                    d.setAttribute("style", "background-color: " + t['templateColor']);
                    c.appendChild(d);
                    c.innerHTML += selElmnt.options[j].innerHTML;
                    c.addEventListener("click", onTemplateOptionClick);
                    b.appendChild(c);
                    if(j == selElmnt.selectedIndex) {
                        c.classList.add("class", "same-as-selected");
                    }
                }
                x[i].appendChild(b);
                a.addEventListener("click", function (e) {
                    e.stopPropagation();
                    closeAllSelect(this);
                    this.nextSibling.classList.toggle("select-hide");
                    this.classList.toggle("select-arrow-active");
                });

            }

            function closeAllSelect(elmnt) {
                var x, y, i, arrNo = [];
                x = document.getElementsByClassName("select-items");
                y = document.getElementsByClassName("select-selected");
                for(i = 0; i < y.length; i++) {
                    if(elmnt == y[i]) {
                        arrNo.push(i)
                    } else {
                        y[i].classList.remove("select-arrow-active");
                    }
                }
                for(i = 0; i < x.length; i++) {
                    if(arrNo.indexOf(i)) {
                        x[i].classList.add("select-hide");
                    }
                }
            }
            document.addEventListener("click", closeAllSelect);
        }

        function onTemplateOptionClick(e, target) {
            var targetDiv = e == null ? target : e.currentTarget;
            var tVal = parseInt(targetDiv.getAttribute('optionId'));
            var t = getTemplateById(tVal);
            var y, i, k, s, h;
            s = targetDiv.parentNode.parentNode.getElementsByTagName("select")[0];
            h = targetDiv.parentNode.previousSibling;
            for(i = 0; i < s.length; i++) {
                var sVal = parseInt(s.options[i].value);
                if(sVal == tVal) {
                    s.selectedIndex = i;
                    h.innerHTML = targetDiv.innerHTML.replace(t['templateName'], '<span style="margin: 0 10px 0 50px;">' + t['templateName'] + '</span>');
                    y = targetDiv.parentNode.getElementsByClassName("same-as-selected");
                    for(k = 0; k < y.length; k++) {
                        y[k].removeAttribute("class");
                    }
                    targetDiv.setAttribute("class", "same-as-selected");
                    break;
                }
            }

            selectTemplate(s.options[s.selectedIndex].value, true);
            h.click();
        }

        function getFontName(font) {
            // Generate code-friendly font names
            return font.toLowerCase().replace(/\s/g, "-");
        }

        function setText(text) {
            quill.setText(text + '\n');
        }

        function setHtml(html) {
            //var delta = quill.clipboard.convert(html);
            //quill.setContents(delta, 'silent');
            quill.root.innerHTML = html;
        }

        function getContentsAsJson() {
            return JSON.stringify(quill.getContents());
        }

        function setContents(jsonStr) {
            quill.setContents(JSON.parse(jsonStr));
        }

        function getText() {
            var text = quill.getText(0, quill.getLength() - 1);
            return text;
        }

        function getSelectedText() {
            var selection = quill.getSelection();
            return quill.getText(selection.index, selection.length);
        }
        function getHtml() {
            //document.getElementsByClassName
            //var val = document.getElementsByClassName("ql-editor")[0].innerHTML;
            clearTemplateSelection();
            clearTemplateFocus();
            var val = quill.root.innerHTML;
            return unescape(val);
        }

        function getSelectedHtml() {
            var selection = quill.getSelection();
            var selectedContent = quill.getContents(selection.index, selection.length);
            var tempContainer = document.createElement('div')
            var tempQuill = new Quill(tempContainer);
            tempQuill.setContents(selectedContent);
            let result = tempContainer.querySelector('.ql-editor').innerHTML;
            tempContainer.remove();
            return result;
        }


        function isEditorLoaded() {
            return isLoaded;
        }

        function hideToolbar() {
            isShowingToolbar = false;
            $(".ql-toolbar").css("display", "none");
            if(isShowingPasteTemplateToolbar) {
                moveTemplateToolbarTop(0);
                let pttbh = $("#pasteTemplateToolbar").outerHeight();
                moveEditorTop(pttbh);
            } else {
                moveEditorTop(0);
            }
        }

        function showToolbar() {
            isShowingToolbar = true;
            $(".ql-toolbar").css("display", "inline-block");
            let tbh = $(".ql-toolbar").outerHeight();
            if(isShowingPasteTemplateToolbar) {
                moveTemplateToolbarTop(tbh);
                let pttbh = $("#pasteTemplateToolbar").outerHeight();
                moveEditorTop(tbh + pttbh);
            } else {
                moveEditorTop(tbh);
            }
        }

        function getEditorHeight() {
            return parseInt($('.ql-editor').outerHeight());
        }

        function getToolbarHeight() {
            return parseInt($('.ql-toolbar').outerHeight());
        }

        function getTemplateToolbarHeight() {
            return $("#pasteTemplateToolbar").outerHeight();
        }

        function getTotalHeight() {
            return getToolbarHeight() + getEditorHeight() + getTemplateToolbarHeight();
        }

        function isReadOnly() {
            return $('.ql-editor').attr('contenteditable');
        }

        function enableReadOnly() {
            $('.ql-editor').attr('contenteditable', false);
            $('.ql-editor').css('caret-color', 'transparent');
            hideToolbar();
        }

        function disableReadOnly() {
            $('.ql-editor').attr('contenteditable', true);
            $('.ql-editor').css('caret-color', 'black');
            showToolbar();
        }

        function getTextWithEmbedTokens() {
            var text = getText().split('');
            var otl = getTemplatesByDocOrder()
            var outText = '';
            var offset = 0;
            otl.forEach(function (ot) {
                offset += parseInt(ot.docIdx);
                var embedStr = getTemplateEmbedStr(ot);
                //text.splice(offset, 1);
                for(var i = 0; i < embedStr.length; i++) {
                    text.splice(offset + i, 0, embedStr[i]);
                }
                offset += (embedStr.length);
            });
            return text.join('');
        }

        function getTemplatesByDocOrder() {
            var til = getTemplateInstances();
            til.sort((a, b) => (parseInt(a.docIdx) > parseInt(b.docIdx)) ? 1 : -1);
            return til;
        }

        function getUniqueTemplateInstanceId(tId) {
            let newInstanceId = 1;
            let isDup = true;
            while(isDup) {
                isDup = false;
                getTemplateInstances(tId).forEach(function (ti) {
                    if(ti.instanceId == newInstanceId) {
                        isDup = true;
                    }
                });
                if(!isDup) {
                    return newInstanceId;
                }
                newInstanceId++;
            }
            return newInstanceId;
        }

        function getTemplateInstances(tId, iId) {
            var til = [];
            getTemplates().forEach(function (t) {
                if(tId != null) {
                    if(t.templateId != tId) {
                        return;
                    }
                    if(iId != null && t.instanceId != iId) {
                        return;
                    }
                }

                if(Array.isArray(t.docIdx)) {
                    t.docIdx.forEach(function (tDocIdx) {
                        var ti = new Object();
                        var ti = Object.assign(ti, t);
                        ti.docIdx = tDocIdx;
                        til.push(ti);
                    });
                } else {
                    til.push(t);
                }
            });
            if(tId != null && iId != null && til.length == 1) {
                return til[0];
            }
            return til;
        }

        function getTemplateOffset(_t, idx) {
            var _tDocIdx = Array.isArray(_t.docIdx) ? _t.docIdx[idx] : _t.docIdx;
            var text = getText();
            var tl = getTemplates();
            var offset = 0;
            tl.forEach(function (t) {
                var embedStr = '{{' + t.templateId + '}}';
                if(Array.isArray(t.docIdx)) {
                    t.docIdx.forEach(function (tDocIdx) {
                        if(tDocIdx < _tDocIdx) {
                            offset += getTemplateEmbedStr(t).length;
                        }
                    });
                } else {
                    if(t.docIdx < _tDocIdx) {
                        offset += getTemplateEmbedStr(t).length;
                    }
                }
            });
            return offset;
        }

        function getTemplateEmbedStr(t) {
            return '{{' + t.templateId + '}}';
        }



        function getTemplatesJson() {
            var val = JSON.stringify(getTemplates());
            return val;
        }

        function decodeHtml(html) {
            var txt = document.createElement("textarea");
            txt.innerHTML = html;
            return txt.value;
        }

        function getRandomColor() {
            var letters = '0123456789ABCDEF';
            var color = '#';
            for(var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function isBright(hex, brightThreshold = 150) {
            var c = hexToRgb(hex.toLowerCase());
            var grayVal = Math.sqrt(
                c.R * c.R * .299 +
                c.G * c.G * .587 +
                c.B * c.B * .114);
            return grayVal > brightThreshold;
        }

        function hexToRgb(hex) {
            var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                R: parseInt(result[1], 16),
                G: parseInt(result[2], 16),
                B: parseInt(result[3], 16)
            } : null;
        }

        function createLink() {
            var range = quill.getSelection(true);
            if(range) {
                var text = quill.getText(range.index, range.length);
                quill.deleteText(range.index, range.length);
                var ts = '<a class="square_btn" href="https://www.google.com">' + text + '</a>';
                quill.clipboard.dangerouslyPasteHTML(range.index, ts);

                console.log('text:\n' + getText());
                console.table('\nhtml:\n' + getHtml());
            }
        }

        function moveToolbarTop(y) {
            $(".ql-toolbar").css("position", "absolute");
            $(".ql-toolbar").css("top", y);

            //var viewportBottom = window.scrollY + window.innerHeight;
            //let tbh = $(".ql-toolbar").outerHeight();
            //if (y <= 0) {
            //    //keyboard is not visible
            //    $(".ql-toolbar").css("top", y);
            //    $("#editor").css("top", y + tbh);
            //} else {
            //    $(".ql-toolbar").css("top", y - tbh);
            //    $("#editor").css("top", 0);
            //}
            //$("#editor").css("bottom", viewportBottom - tbh);
        }

        function moveTemplateToolbarTop(y) {
            $("#pasteTemplateToolbar").css("position", "absolute");
            $("#pasteTemplateToolbar").css("top", y);
        }

        function moveEditorTop(y) {
            $("#editor").css("position", "absolute");
            $("#editor").css("top", y);
        }

        function getTemplateIconStr(isEnabled) {
            if(isEnabled) {
                //black
                return 'data:image/png;base64,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';
                //yellow
                //return "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAaVBMVEX/////wQf/vwD/24f/3Iz///3/vQD/ykL/yTj/yT3/0WH/0F7/0Fv/y0T/y0f/yTr/35T/wxT/8tP/6Lj/5az/7sj/9uX/46P/1G7/677/57P/2oL/xSj/8M//1nj//fb//O//4Zz/zVBsBjAmAAAEzklEQVR4nO2di3qiMBBGIUpa1168tFZ70933f8hl0KqVWCuZyfzhm/MAfJ7vhAmwCy0KwzAMwzAMwzAMwzAMwzAMWKq3QSzDyXymrXGe6ta7eLwvl8/aKmGqW1fy4Pz0SdsmAJ9g4zhaaAudwirYOIJl5Bas8QNtqWMEBLEURQRrRZiFKiRYK4KMGzHB0j1ouzXICdYR59p2haxg6d619YQF64gfPRcs3ae24KOsYOmmyoLCBUvtDSOBYOk176TEl2hjqHhdw1WwvuetOXcsN9ET5Cno/PJ1tvh4Gp9xdEM1QZ6C/m29O+Dmj4cyZCroV0fHfAkpahlyFfw+KEOKSoZcBU9//bh9WB1Dtn3w9MCbdkQVQ7Ztov3j71pH1jBk2+h9++n2UyuigiHfpZrftA7+AWDIeKnm162jL/QNOS+2Aw1n6oasF9uB83Cubch7uxS4qF4qz9JqxHq71L5/Xyvvh+z3g/40YjthUkOBG96TM7F9FiY1ZF6i25/vjhVXuvcWUv/4sl+o60/d+0OJglvF6XC2WS+eP53uPb7gUzV34TlNGkOxgpdJY5jiuaiqoWLBNIZJHvxqGuoKJjBUXaIpDDWHTBJD7YLihuoFxQ3VCwob6i9RacMbAEFJwwpCUNIQQ1DOEKSgoCHCkGkQMoQpKGUIsU3skDHEKShjiFRQxhCpoIQh0JBp4DcEE2Q3RCvIbwg1ZBp4DfEKMhtibRM7WA3vAQU5DRGXaMlqCFmQ0RC0IKMhqiCXYQW6REs2Q9iCXIa4BZkMgQvyGCIX5DCE3SZ2xBtiF4w3RC8YbwgvGGkIvNHviTPELxhpmEHBOMMcCkYZPmQh2H77q2cFS/dQ9bugu+laMIshE/Ntk1wEOxccB//POBzdC75lInjfVfC574LFNIuTMOIDSn+zSNh9yBRV3wsWrzkkjCgYeh8cj6iPmOWwSKMKBl4lhsPdd73YbsA/DeMKFsUEfZW6m6iCRTEAN4y4ksnDMLog+iqNLxh+XRqG2CHTgLxbcBSE3vFZChbBTzFhELnRH0A9EbkK1mirhGHYJvYEv/umDc+Q+eId70zkLFggbhi8BWsmYIqMQ+aLJZQie0EC6aG3GwkIFkX4W6EaMA8ZPEWBc/ALjIUqVpBAqChYkLhTV3QjwYKEdkXhgoRuRfGChGZF0SFzQG+iCm30bbQqJiqop5hgyBzQWKgJCxLpKyYtSKTeNJJsE99JWzF5QSJlRYWCRLqKiYfMgVQT1d0qCaaqqLRE0ym6R0XBFAtVWVC+ouoS3SK7aSgOmQOSFQEKEnIVIQoSUhVBChIyExWmICFREaggwa+ovg+ewr1Q4QS5K4It0S2cmwbUkDnAVxGyIMFVEbQgwVMRcMgc4JiowAWJ+IrQBYlYRfCCRNxCzUAwriL8Et3SfdPIoiDRtWImBYluFbMpSHSpmFFB4vqJmlVB4tqKmRUkrlPMriBxzULNUvCaihku0S2/3TQyLUj8rmK2BYnfVMy4IHG5YuaClydq9oKXKvZA8GfFXgj+tFB7Inj+hSLf+btqcEyCf7nXL7V/FyOz91ZGX660fxUvL+VxR+fdpDcrdM9q7Lx3jv7gtPv32j8/oprNJ8PB5HXWTz3DMAzDMAzDMAzDMAzDMHrEf9VjaGNa1FYRAAAAAElFTkSuQmCC";
            } else {
                //gray
                return 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALsAAADDCAYAAADa4WDGAAAKTElEQVR4nO3dPWwb5x3H8d//3CGbvLeAVaQtskkWPXgzs2WLtmYzC+mO3Sq0RV+m2Fu2OCOPEkxvzUaPnUKPGchKY1EUkIEMzSZvXcx/B92ljESK9/K83d3vA3ihpOMD+IsHx7vnOQJERERERERERERERFSV+B4AXdN/ffGN7zH8n8x8jyAnv/zzc2PHMnUgqi5Jki8BnPgeR6Cm+b80Td/VORBj9yyO45ciMvA9jtCp6pWIvADwomr09wyPiUpg6MWJyAcA+qr6216v99/FYvFt6WNYGBcVwNDrUdWZiByWmeUZuwcM3ZhLETkcjUYXRX6ZsTvG0M1S1asoivpFgmfsDjF0O7IPr7vbTmkiVwPqOoZuj4jcV9Xptt/j1RgHGLp9IrL78OHD88Vi8c9Nv8OZ3TKG7o6ITO76OWd2ixi6WyLywcHBwdWma/Cc2S1h6N4MNv2AV2MsYOh+icj+ukuRnNkNY+j+LZfL/rrXf+J4HK2VJMmOqk5FpO97LF2X/R98dfN1xm5AFvpMRPZ9j4UAAGv/H3gaUxNDD9LuuhcZew0MvVl4GlMRQy9kCuB8zev7AA4dj4WxV8HQt3oB4NldC7OSJNkB8AyWtiPqv7/YkQ//8qP353X2khj6ZmWW2+aGw+Hecrmcich9k2MZ/fWjvvz8929WX+M5ewkM/W4iclImdAAYjUYXIuJkszljL4ihb/UiTdNXVf4w+7sXhsdzC2MvgKHfTVWvcH3+Xcez7DjWMPYtGPp2IjKp+0yXNE3fbVuiWxdjvwNDL8ZUpIzdE4ZeXNkPpbaPAwB4v9y9+RJjX4Oht4DI7s2XGPsNDL29GPsKhl7N0dHRg5COswljzzD06u7du9cP6TibMHYw9LpUdRDScTbpfOwMvT4R6cdx/KTOMeI4fmJ7l1enY2fo5ojIJFvJWFqSJDu2r7EDHY6doRu3q6qz4XC4V+aPhsPhnqrOsGF3kUmdjJ2h2yEi+8vlsnDwK8t7nfw/dG7zBkO3K3vI6Hkcx7NszcytlZBJkjxV1YGq9kUsbalQvfX/26nNGwy9O0Z/+tVMfvHHj1df68xpDEOnTsTO0AnoQOwMnXKtj52hU67VsWcPGWXoBKDFsfNpunRTK2Nn6LRO62Jn6LRJq2Jn6HSX1sTO0GmbVsTO0KmIxsfO0KmoRsfO0KmMxsYex/HvGDqV0cj17EmSPIWDp75SuzRuZs9Cn/geBzVPo2Jn6FRHY2Jn6FRXI2Jn6GRC8LEfHx9/CoZOBgQd+3A43HPx8BzqhmBjt/WVgdRdQcaeJMkOQyfTgot9ZYM0QyejgoqdTwIgm4KJnaGTbUHEztDJhSBiZ+jkgvfY+WwXcsVr7Nx8QS55i52hk2teYmfo5IPz2Bk6+eI0du4bJZ+c7UHlvlHyzcnMzs0XFALrsTN0CoXV2Bk6hcRa7Nl32U9sHZ+oLCuxZ99wPLVxbKKqjMfO7XQUKqOxM3QKhur5zZeMxc7QKShRdHXrJRPHPTo6esDQKXS176Bmu4ymDJ1CV2tm53Y6apLKsTN0CpWqTuTDPzy/+bpUORhDp1Cp6mQ8Hv9m3c9Kz+wMnUKlqucicrLp51VOYyYMnUKThd5P0/Tdpt8pFXscxy8BHNYeGZFBqnoVRdHgrtCBEufs3E5HIcpC749Go4ttv1sodoZOISoTOlDgNIahU6hE5KRo6MCWO6hJknwOYFB3UEQWDNI0fVXmDzaexnCXEQWsdOjAhtgZOgWsUujA5tOYSfWxENmR3R2tFDoQwFN8iYq4axlAUbdi1+/+pnUOSGTBtG7oAGd2Cpxeb68bmDjWuthnJg5MVFeR9S5lcGanUF2aDB1g7BQgVb0SkUOToQOMnQJTdr1LGbdjF5mZfhOiImyGDnBmp0DYDh1YE7v89NfPwec0kkMuQgc2z+wDAJc235gIcBc6sCH2NE3fiQi335FVLkMHgHubfjCfz78/ODi4EpFPXAyEukdVPxuPx29cvd/G2AFgsVh82+v19gF85Gg81B2D8Xj8tcs3LHI1ZgCev5NZldek17E19vz8XVVvPQKYqAIvoQNbTmNy8/n8+0ePHv0HfGYM1eMtdKBg7AAwn88vDg4Odvk0MKrIa+hAhQebxnH8DwZPJXkPHaiwXEBE+jx/pxKCCB2oEHu27JLn7lREMKEDJc7ZVy0Wi7e84URbBBU6UDF24PqGEz+w0gbBhQ5U/OaNVXEcfyMifQNjoXYIMnTAwHr2bMHYZf2hUAsEGzpgIHbeYaVM0KEDBk5jcnEcPxFu6euq4EMHanxAvWmxWLzt9XqX4GXJrmlE6IDB2AEuKeigxoQOGI4dABaLxWsG3wmNCh2w9HQBETnJntFH7dS40AGDH1BvOjo6ehBF0bmI3Lf1HuRFI0MHLD435uzs7G0URVw01i6NDR2wOLPnhsPh3nK5nHGGb7xGhw5Y+IB6E3c5tULjQwccxA5cX5LkNfjGakXogKPYgR+uwXNZcENkDzB6nKbp332PxRRnsQNcFtwUrp/U5YrT2AHedApdW0MHPD2ymjedwtTm0AEHlx43SZJkR1VnnOHDYPrLukLkLXaAwYeiC6EDnmMHGLxvXQkdCOBrZtI0fRdF0YDn8F5MuxI6EMDMnuMM75aqTkx8RXqTBBM7cB08gHMAu56H0mpdDB0I4DRmFTdv29fV0IHAYgeA0Wh0waXB1jzrauhAYKcxq4bD4Z6qTsFTGlNas6CrqmBjB3740HrJtfDVqeqVqg5OT09f+x6Lb8GdxqzKLkvylKai/PY/Q78W9Mye426nSi7fv3/fPzs7e+t7IKEIembPjUajCxHZ5Y2nYrK7oocM/ccaMbPneONpuy7d/i+rETN7LrsO3+cMv56qThj6Zo2a2XOc4W/r8s2ioho1s+dWZviJ77EEYsDQt2vkzL4qjuOXIjLwPQ4fVPVKRE66frOoKOd7UE3r6p7W/Bp6m3b/29b42IHr4Hu9HgD0PQ/Flcsoij5p615RW1oROwDM5/M3XXgQU3Zp8XGapryGXlIjP6BukqbpKxHZb/Hygk7tLDKt8R9Q12nj8gJeWqyvVTN7bmVNfCtuPjF0M1o5s+eym0/TJn8psaqejMfjr3yPow1aHXuuidfieQ3dvNZcjblLdmnyPoDHvsdShKqeR1F0yGvoZnViZs8lSfIUwMT3OO7CVYv2tPID6ib5pUkAl77Hsg5XLdrVqZk9F+KqSV5xsa9TM3suXzUJYOp7LBmuWnSgkzP7qiRJPgfwzMd7c+e/W52PHQDiOH6C61vxzu64tv3B/yFi7JnsG7mnLs7jVfV8uVxyQ7RjnTxnX+fs7Oyti/P4/NIiQ3ePM/sats7jecXFL8a+QRzHT0RkAkPPmuQaF/8Y+x1MLCTL1tYfjsfjN+ZGRlUw9gKSJPkSwEmFP70UkUNecQkDYy/o+Pj4UxGZFL08yTUu4eHVmIJOT09fZ8+bnG37Xa5xCRNn9gr0u6+fAjrAunN51Zn87LOP3Y+KiIiIiIiIiIiIiIjInv8B/nU3wrJp7vIAAAAASUVORK5CYII=';
            }
        }


        init(null, null, null, null, null);
    </script>

</body>
</html>

