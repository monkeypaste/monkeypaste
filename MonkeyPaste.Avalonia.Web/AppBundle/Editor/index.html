<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
    <title>Editor</title>

    <script defer type="text/javascript">

        //loadEditorGlobals();
        const HTML_CONVERTER_PARAMS = "converter=true";
        const APPEND_NOTIFIER_PARAMS = "append_notifier=true";
        const AUTO_TEST = "auto_test";

        var UseQuill2 = true;
        var UseBetterTable = true;

        if (window.location.search.toLowerCase().includes(HTML_CONVERTER_PARAMS.toLowerCase())) {
            // this is the case for converter which uses 1.3.6
            // because it doesn't have that whitespace exclusion bug between spans
            // it doesn't need the quill tables because it converts plain html which doesn't rely on better table
            UseBetterTable = true;
            UseQuill2 = true;
        }


        //
        if (window.location.search.toLowerCase().includes(AUTO_TEST.toLowerCase())) {
            document.write('<script defer src="src/components/tester/editor_tester.js"><\/script>');
            window.addEventListener('load', function () {
                init_test();
            });
        }
        

    </script>

    <!-- EXTERNAL STYLES BEGIN -->
    <link rel="icon" type="image/x-icon" href="images/icons/monkey.ico" />
    <!--<link href="https://cdn.quilljs.com/1.0.0/quill.snow.css" rel="stylesheet">-->
    <link href="lib/Quill/quill.snow.css" rel="stylesheet" />

    <link href="lib/jquery-context-menus/dist/context-menu.min.css" rel="stylesheet" />
    <link href="lib/Quill-Better-Table/quill-better-table.css" rel="stylesheet" type="text/css" />
    <!--<link href="lib/HighlightJs/github.min.css" rel="stylesheet" />-->
    <!--<link href="lib/HighlightJs/monokai-sublime.min.css" rel="stylesheet" />-->

    <script defer type="text/javascript">
        ////loadVariableStyles();
        //if (UseQuill2 && UseBetterTable) {
        //    //document.write('<link href="lib/Quill-Better-Table/quill-better-table.css" rel="stylesheet" type="text/css" />');
        //    document.write('<link href="node_modules/quill-better-table/dist/quill-better-table.css" rel="stylesheet" type="text/css" />');
        //    console.log('quill-better-table.css loaded');
        //    //addStyle(`${REL_EXTERNAL_ROOT_DIR}/quill-better-table/dist/quill-better-table.css`);
        //}
    </script>

    <link href="lib/katex/katex.min.css" rel="stylesheet" />

    <!--<link href="lib/font-awesome/fontawesome-free-6.1.1-web/css/all.css" rel="stylesheet" />-->
    <!-- EXTERNAL STYLES END -->
    <!-- INTERNAL STYLES BEGIN -->

    <link href="src/components/main/main-style.css" rel="stylesheet" />
    <link href="src/components/color/color-palette-style.css" rel="stylesheet" />
    <link href="src/components/font/font-toolbar-items-style.css" rel="stylesheet" />
    <link href="src/components/quill-wrapper/quill-style.css" rel="stylesheet" />
    <link href="src/components/editor/editor-style.css" rel="stylesheet" />
    <link href="src/components/dragdrop/drag-drop-style.css" rel="stylesheet" />
    <link href="src/components/tooltip/tooltip-style.css" rel="stylesheet" />

    <link href="src/components/template/template-style.css" rel="stylesheet" />
    <link href="src/components/template/toolbar/edit/edit-template-toolbar-style.css" rel="stylesheet" />
    <link href="src/components/template/toolbar/paste/paste-template-toolbar-items-style.css" rel="stylesheet" />
    <link href="src/components/template/toolbar/paste/selector/paste-toolbar-template-selector-style.css" rel="stylesheet" />

    <link href="src/components/content/content-style.css" rel="stylesheet" />
    <link href="src/components/content/content-file-list/content-file-list-style.css" rel="stylesheet" />
    <link href="src/components/content/content-image/content-image-style.css" rel="stylesheet" />
    <link href="src/components/annotations/annotations-style.css" rel="stylesheet" />
    <link href="src/components/paste-toolbar/paste-toolbar-style.css" rel="stylesheet" />

    <link href="src/components/overlay/overlay-style.css" rel="stylesheet" />

    <link href="src/components/list/list-style.css" rel="stylesheet" />

    <link href="src/components/findreplace/find-replace-style.css" rel="stylesheet" />

    <link href="src/components/append/append-style.css" rel="stylesheet" />
    <link href="src/components/append/toolbar/append-toolbar-item-style.css" rel="stylesheet" />

    <link href="src/components/table/table-style.css" rel="stylesheet" />
    <link href="src/components/table/toolbar/create-table-style.css" rel="stylesheet" />

    <link href="src/components/common/toolbar/common-toolbar-style.css" rel="stylesheet" />

    <!-- INTERNAL STYLES END -->
    <!-- EXTERNAL APIS BEGIN -->
    <!--<script defer src="lib/HighlightJs/highlight.min.js"></script>-->
    <!--<script defer src="lib/HighlightJs/xml.min.js"></script>-->
    <!--<script defer src="lib/quill-delta-to-html/dist/browser/QuillDeltaToHtmlConverter.bundle.js"></script>-->
    <!--<script defer src="lib/font-awesome/fontawesome-free-6.1.1-web/all.min.js"></script>-->
    <!--<script defer src="lib/DynamicQuillTools/DynamicQuillTools.js"></script>-->
    <!--<script defer src="node_modules/quilldev2/dist/quill.js"></script>-->
    <!--<script defer src="https://cdn.quilljs.com/2.0.0-dev.4/quill.js"></script>-->
    <!--<script defer src="node_modules/quill-better-table/dist/quill-better-table.js"></script>-->
    <!--<script defer src="node_modules/quill-delta-to-html/dist/browser/QuillDeltaToHtmlConverter.bundle.js"></script>-->

    <script defer src="lib/Quill/quill.min.js"></script>
    <!--<script defer src="lib/Quill-Better-Table/quill-better-table.min.js"></script>-->
    <script defer src="lib/Quill-Better-Table/quill-better-table/dist/quill-better-table.js"></script>
    <script defer src="lib/Quill-Delta-to-Html/QuillDeltaToHtmlConverter.bundle.js"></script>
    <script defer src="lib/jquery/jquery.min.js"></script>
    <script defer src="lib/DateFormatter/jquery.dateFormat.js"></script>
    <script defer src="lib/jquery-context-menus/src/context-menu.js"></script>
    <script defer src="lib/katex/katex.min.js"></script>
    <script defer src="lib/html2canvas/html2canvas.min.js"></script>

    <!-- EXTERNAL APIS END -->


    <!-- INTERNAL API BEGIN -->
    <script defer src="src/components/messages/messages_ntf.js"></script>
    <script defer src="src/components/util/debug.js"></script>

    <script defer type="text/javascript">
        //loadLifeCycleHandlers();
        document.addEventListener('DOMContentLoaded', (e) => {
            //init_test();
            window.name = EDITOR_WINDOW_NAME;
            onDomLoaded_ntf();
        });

        window.onbeforeunload = function (e) {
            //if (!isRunningInHost()) {
            //    return;
            //}

            //alert('Are you sure you want to leave?');
            console.log('unload rejected');
            e.preventDefault();
            e.stopPropagation
            return false;
        };

    </script>

    <script defer type="text/javascript">
        //loadVariableExternalScripts();
        //if (UseQuill2) {
        //    //document.write('<script defer src="https://cdn.quilljs.com/2.0.0-dev.4/quill.js"><\/script>');
        //    //document.write('<script defer src="lib/Quill/quill.min.js"><\/script>');
        //    document.write('<script defer src="node_modules/quilldev2/dist/quill.js"><\/script>');
        //    console.log('quill 2.0.0-dev3 loaded');
        //    //addScript(`${REL_EXTERNAL_ROOT_DIR}/quilldev2/dist/quill.js`);
        //    if (UseBetterTable) {
        //        //document.write('<script defer src="lib/Quill-Better-Table/quill-better-table.min.js"><\/script>');
        //        document.write('<script defer src="node_modules/quill-better-table/dist/quill-better-table.js"><\/script>');

        //        //addScript(`${REL_EXTERNAL_ROOT_DIR}/quill-better-table/dist/quill-better-table.js`);
        //        console.log('quill-better-table loaded')
        //    }
        //} else {
        //    //document.write('<script defer src="https://cdn.quilljs.com/1.3.7/quill.js"><\/script>');
        //    document.write('<script defer src="node_modules/quill/dist/quill.min.js"><\/script>');
        //    console.log('quill 1.3.7 loaded');
        //    //addScript(`${REL_EXTERNAL_ROOT_DIR}/quill/dist/quill.min.js`);
        //}
    </script>




    <script defer src="src/components/svg/svgloader.js"></script>
    <script defer src="src/components/append/append.js"></script>
    <script defer src="src/components/append/toolbar/append-toolbar-items.js"></script>

    <script defer src="src/components/cursor/cursor.js"></script>

    <script defer src="src/components/util/helpers.js"></script>
    <script defer src="src/components/util/resize.js"></script>
    <script defer src="src/components/util/graphics/polygon.js"></script>
    <script defer src="src/components/util/graphics/line.js"></script>
    <script defer src="src/components/util/graphics/rect.js"></script>
    <script defer src="src/components/util/graphics/point.js"></script>
    <script defer src="src/components/util/graphics/roundedRect.js"></script>
    <script defer src="src/components/util/graphics/screenshot.js"></script>
    <script defer src="src/components/converter/converter.js"></script>

    <script defer src="src/components/messages/messenger.js"></script>
    <script defer src="src/components/messages/messages_ext.js"></script>
    <script defer src="src/components/messages/messages_ext_ntf.js"></script>
    <script defer src="src/components/messages/messages_get.js"></script>

    <script defer src="src/components/template/template.js"></script>
    <script defer src="src/components/template/blots/templateEmbedBlot.js"></script>
    <script defer src="src/components/template/toolbar/create/createTemplateToolbarItem.js"></script>
    <script defer src="src/components/template/toolbar/edit/editTemplateToolbar.js"></script>
    <script defer src="src/components/template/toolbar/paste/pasteTemplateToolbarItems.js"></script>
    <script defer src="src/components/template/toolbar/paste/selector/pasteTemplateFocusSelector.js"></script>
    <script defer src="src/components/template/toolbar/paste/pastevalue/pasteTemplateValue.js"></script>

    <script defer src="src/components/template/types/contacts/contacts.js"></script>

    <script defer src="src/components/color/colorpalette.js"></script>
    <script defer src="src/components/color/colordata.js"></script>
    <script defer src="src/components/color/color.js"></script>

    <script defer src="src/components/content/content.js"></script>
    <script defer src="src/components/content/content-text/content-text.js"></script>
    <script defer src="src/components/content/content-file-list/content-file-list.js"></script>
    <script defer src="src/components/content/content-image/content-image.js"></script>
    <script defer src="src/components/annotations/annotations.js"></script>
    <script defer src="src/components/paste-toolbar/pastetoolbar.js"></script>
    <script defer src="src/components/paste-toolbar/popup/paste-button-popup.js"></script>
    <!--<script defer src="src/components/content/ext-content-source-blot/ext-content-source-blot.js"></script>-->

    <script defer src="src/components/list/list.js"></script>
    <script defer src="src/components/list/bullets/checkable/checkablelist.js"></script>
    <script defer src="src/components/list/bullets/ordered/orderedlist.js"></script>
    <script defer src="src/components/list/bullets/disc/disclist.js"></script>

    <script defer src="src/components/common/toolbar/commonToolbar.js"></script>

    <script defer src="src/components/font/fontFamilyLookup.js"></script>
    <script defer src="src/components/font/fontFamily.js"></script>
    <script defer src="src/components/font/fontSize.js"></script>
    <script defer src="src/components/font/fontcolor.js"></script>

    <script defer src="src/components/clipboard/clipboard.js"></script>

    <script defer src="src/components/shortcuts/shortcuts.js"></script>

    <script defer src="src/components/dragdrop/drag.js"></script>
    <script defer src="src/components/dragdrop/drop.js"></script>
    <script defer src="src/components/dragdrop/debouncer/dragover-debouncer.js"></script>

    <script defer src="src/components/scroll/scroll.js"></script>
    <script defer src="src/components/scroll/autoscroll/autoscroll.js"></script>

    <script defer src="src/components/datatransfer/datatransfer.js"></script>
    <script defer src="src/components/datatransfer/htmlfragment.js"></script>

    <script defer src="src/components/table/table.js"></script>
    <script defer src="src/components/table/ops/tableops.js"></script>
    <script defer src="src/components/table/toolbar/createTableToolbarButton.js"></script>

    <script defer src="src/components/link/link.js"></script>
    <script defer src="src/components/align/align.js"></script>

    <script defer src="src/components/overlay/overlay.js"></script>

    <script defer src="src/components/selection/selection.js"></script>
    <script defer src="src/components/selection/fancy-selection/fancy-selection.js"></script>

    <script defer src="src/components/window/window.js"></script>

    <script defer src="src/components/input/keyboard.js"></script>
    <script defer src="src/components/input/mouse.js"></script>
    <script defer src="src/components/input/focus.js"></script>

    <script defer src="src/components/quill-wrapper/quill-wrapper.js"></script>
    <script defer src="src/components/quill-wrapper/toolbar/quill-toolbar.js"></script>
    <script defer src="src/components/quill-wrapper/quill-tooltip/quill-tooltip-wrapper.js"></script>

    <script defer src="src/components/findreplace/findreplace.js"></script>

    <script defer src="src/components/delta/delta-wrapper.js"></script>
    <script defer src="src/components/tooltip/tooltip.js"></script>

    <script defer src="src/components/history/history.js"></script>

    <script defer src="src/components/editor/editor.js"></script>
    <script defer src="src/components/main/main.js"></script>
    <!-- INTERNAL API END -->
</head>
<body>
    <!-- EDITOR TOOLBAR -->
    <div id="editorToolbar" class="hidden">
        <!-- FONT SIZE -->
        <select class="ql-size">
            <option value="8px" />
            <option value="9px" />
            <option value="10px" />
            <option value="12px" />
            <option value="14px" />
            <option value="16px" />
            <option value="20px" />
            <option value="24px" />
            <option value="32px" />
            <option value="42px" />
            <option value="54px" />
            <option value="68px" />
            <option value="84px" />
            <option value="98px" />
        </select>
        <div class="toolbar-separator"></div>
        <!-- FONT FAMILY -->
        <select class="ql-font"></select>

        <div class="toolbar-separator"></div>

        <!-- CREATE TEMPLATE -->
        <button id="createTemplateToolbarButton"></button>
        <div class="toolbar-separator"></div>

        <!-- FG/BG COLOR -->
        <button id="fontColorToolbarButton"></button>
        <button id="fontBackgroundToolbarButton"></button>

        <div class="toolbar-separator"></div>

        <!-- BOLD -->
        <button class="ql-bold"></button>

        <!-- ITALIC-->
        <button class="ql-italic"></button>

        <div class="toolbar-separator"></div>


        <!-- INDENT -->
        <button class="ql-indent" value="-1"></button>
        <button class="ql-indent" value="+1"></button>

        <div class="toolbar-separator"></div>

        <!-- ALIGN -->
        <button id="alignEditorToolbarButton"></button>

        <div class="toolbar-separator"></div>

        <!-- CREATE TABLE -->
        <span id="createTableToolbarButton" class="ql-Table-Input ql-picker">
            <span id="createTableToolbarButtonLabel" class="ql-picker-label"></span>
            <span id="createTableToolbarButtonOptionsContainer" class="ql-picker-options hidden"></span>
        </span>

        <div class="toolbar-separator"></div>

        <!-- BLOCK QUOTE-->
        <button class="ql-blockquote hidden"></button>

        <!-- CODE BLOCK -->
        <button class="ql-code-block hidden"></button>

        <div class="toolbar-separator hidden"></div>

        <!-- LIST -->
        <button id="orderedListToolbarButton" class="ql-list" value="ordered"></button>
        <button id="discListToolbarButton" class="ql-list" value="bullet"></button>
        <button id="checkListToolbarButton" class="ql-list" value="check"></button>


        <div class="toolbar-separator"></div>

        <!-- SUB/SUPER SCRIPT -->
        <button class="ql-script hidden" value="sub"></button>
        <button class="ql-script hidden" value="super"></button>


        <div class="toolbar-separator hidden"></div>

        <!-- FLOW DIRECTION -->
        <button class="ql-direction hidden" value="rtl"></button>

        <div class="toolbar-separator"></div>

        <!-- LINK -->
        <button id="linkEditorToolbarButton"></button>
        <button class="ql-image"></button>
        <button class="ql-video"></button>
        <!--<button class="ql-formula"></button>-->



        <div class="toolbar-separator"></div>
        <!-- FIND/REPLACE -->
        <button id="findReplaceToolbarButton" class="right-align"></button>
    </div>

    <!-- FIND/REPLACE TOOLBAR -->
    <div id="findReplaceToolbar" class="top-align hidden">
        <form>
            <label for="findInput">Find:</label>
            <input type="text" id="findInput" name="findInput" spellcheck="false">

            <input type="radio" id="isFindInput" name="findOrReplace">
            <label for="isFindInput">Find</label>
            <input type="radio" id="isReplaceInput" name="findOrReplace">
            <label for="isReplaceInput">Replace</label><br>

            <label for="replaceInput" id="replaceInputLabel" class="is-replace">Replace:</label>
            <input type="text" id="replaceInput" name="replaceInput" class="is-replace"><br />

            <input type="checkbox" id="matchCaseInput" name="matchCaseInput">
            <label for="matchCaseInput"> Match Case</label><br>

            <input type="checkbox" id="wholeWordInput" name="wholeWordInput">
            <label for="wholeWordInput"> Whole Word</label><br>

            <input type="checkbox" id="useRegexInput" name="useRegexInput">
            <label for="useRegexInput"> Regular Expression</label>
        </form>
        <div id="findReplaceButtonContainer" class="right-align">
            <button id="closeFindReplaceToolbarButton">X</button>
            <button id="findReplacePreviousButton" type="button">
                <i></i>
            </button>
            <button id="findReplaceNextButton" type="button">
                <i></i>
            </button>
            <button id="replaceButton" type="button" class="is-replace">
                Replace
            </button>
            <button id="replaceAllButton" type="button" class="is-replace">
                Replace All
            </button>
        </div>
        <div class="resizer resizer-b"></div>
    </div>

    <!-- EDITOR CONTAINER -->
    <div id='editor' draggable="false" class="no-select"></div>

    <!-- EDIT TEMPLATE TOOLBAR -->
    <div id="editTemplateToolbar"
         class="common-toolbar edit-template-toolbar bottom-align hidden">
        <div class="resizer resizer-t"></div>
        <div id="templateColorBox"></div>
        <textarea id="templateNameTextArea"
                  rows="1"
                  cols="20"
                  spellcheck="false"
                  placeholder="Template Name"></textarea>
        <textarea id="templateDetailTextArea"
                  rows="1"
                  cols="20"
                  spellcheck="false"
                  placeholder="Enter Details"></textarea>
        <div class="tooltip-hint-container tooltip">
            <!--<span class="tooltiptext">Tooltip text</span>-->
            <div class="tooltip-block-container tooltiptext">
                <p>yy = short year</p>
                <p>yyyy = long year</p>
                <p>M = month (1-12)</p>
                <p>MM = month (01-12)</p>
                <p>MMM = month abbreviation (Jan, Feb ... Dec)</p>
                <p>MMMM = long month (January, February ... December)</p>
                <p>d = day (1 - 31)</p>
                <p>dd = day (01 - 31)</p>
                <p>ddd = day of the week in words (Monday, Tuesday ... Sunday)</p>
                <p>E = short day of the week in words (Mon, Tue ... Sun)</p>
                <p>D - Ordinal day (1st, 2nd, 3rd, 21st, 22nd, 23rd, 31st, 4th...)</p>
                <p>h = hour in am/pm (0-12)</p>
                <p>hh = hour in am/pm (00-12)</p>
                <p>H = hour in day (0-23)</p>
                <p>HH = hour in day (00-23)</p>
                <p>mm = minute</p>
                <p>ss = second</p>
                <p>SSS = milliseconds</p>
                <p>a = AM/PM marker</p>
                <p>p = a.m./p.m. marker</p>
            </div>
        </div>

        <button id="editTemplateDeleteButton" class="right-align" type="button">
            <span>DELETE</span>
        </button>
    </div>

    <!-- TOOLTIP TOOLBAR -->
    <div id="tooltipToolbar"
         class="common-toolbar bottom-align tooltip-overlay hidden">
        TOOLTIPZ ZONE
    </div>
    
    <!-- TABLEOPS TOOLBAR -->
    <div id="tableOpsToolbar"
         class="common-toolbar bottom-align hidden">
        <button id="tableOpsNavLeft" class="opsNav"><span>Left</span></button>
        <div id="tableOpsOuterContainer"></div>
        <button id="tableOpsNavRight" class="opsNav"><span>Right</span></button>
    </div>

    <!-- PASTE TOOLBAR -->
    <div id="pasteToolbar"
         class="common-toolbar bottom-align paste-toolbar hidden">
        <div class="resizer resizer-t"></div>
        <!-- SELECTOR -->
        <div id="pasteTemplateToolbarMenuSelectorDiv"
             class="paste-template-item">
            <div id="selectedPasteTemplateOptionDiv"></div>
            <div id="pasteTemplateToolbarMenuSelectorArrowDiv"></div>
        </div>
        <!-- PASTE VALUE TEXT AREA-->
        <textarea id="templatePasteValueTextArea"
                  class="paste-template-item"
                  rows="1"
                  cols="20"
                  tabindex="1"
                  spellcheck="false"
                  placeholder="Enter paste text..."></textarea>
        <!-- CLEAR BUTTON -->
        <button id="clearAllTemplateTextButton"
                class="paste-template-item"
                tabindex="2">
            <i></i><span>CLEAR ALL</span>
        </button>
        <!-- PREV BUTTON -->
        <button id="previousTemplateButton"
                class="paste-template-item"
                tabindex="3">
            <i></i>
        </button>
        <!-- NEXT BUTTON -->
        <button id="nextTemplateButton"
                class="paste-template-item"
                tabindex="4">
            <i></i>
        </button>
        <!-- EDIT BUTTON -->
        <button id="pasteEditFocusTemplateButton"
                class="paste-template-item"
                tabindex="5">
            <i></i><span>Edit</span>
        </button>
        <!-- PASTE BUTTON/MODE CONTAINER -->
        <div id="pasteButtonAndModeContainer"
             class="right-align">

            <!-- APPEND MANUAL LABEL -->
            <span id="pasteAppendIsManualToolbarLabel" class="hidden">MANUAL</span>
            <!-- APPEND STATE CONTAINER -->
            <div id="pasteAppendToolbarLabelContainer">
                <!-- APPEND MODE LABEL -->
                <span id="pasteAppendToolbarLabel"></span>
                <!-- APPEND PAUSED BUTTON -->
                <button id="pasteAppendPauseAppendButton" hover-tooltip="Pause clipboard accumulation $$ToggleAppendPaused$$"><i></i></button>
            </div>

            <!-- PASTE BUTTON -->
            <button id="pasteButton"
                    tabindex="6">
                <i></i><span>PASTE</span>
            </button>
            <!--<div class="toolbar-separator"></div>-->
            <!-- PASTE BUTTON POPUP -->
            <button id="pasteButtonPopupExpander"
                    tabindex="7">
                <span id="pasteButtonPopupExpanderLabel"></span>
            </button>
        </div>
    </div>


    <!-- POP UPS -->

    <div id="pasteOptionsDiv"
         class="paste-template-item"></div>
    <div id="colorPaletteContainer"
         class="ql-toolbar-template-context-menu"></div>

    <!-- OVERLAYS -->
    <canvas id="overlayCanvas" class="no-hit-test"></canvas>
    <div id="annotationRoiOverlay" class="no-hit-test"></div>
    <div id="annotationTooltip" class="no-hit-test"></div>
    <div id="dragOverlay" draggable="true"></div>
    <div id="tooltipOverlay" class="tooltip-overlay tooltiptext hidden no-hit-test"></div>
</body>
</html>