<local:MpAvUserControl xmlns="https://github.com/avaloniaui"
                       xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                       xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                       xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                       xmlns:sys="clr-namespace:System;assembly=mscorlib"
                       xmlns:local="using:MonkeyPaste.Avalonia"
                       xmlns:pcl="using:MonkeyPaste"
                       x:DataType="local:MpAvClipTileViewModel"
                       x:TypeArguments="local:MpAvClipTileViewModel"
                       x:CompileBindings="True"
                       mc:Ignorable="d"
                       d:DesignWidth="800"
                       d:DesignHeight="450"
                       HorizontalAlignment="Stretch"
                       VerticalAlignment="Stretch"
                       HorizontalContentAlignment="Stretch"
                       VerticalContentAlignment="Stretch"
                       x:Class="MonkeyPaste.Avalonia.MpAvClipTileView">
    <Interaction.Behaviors>
        <local:MpHighlightSelectorBehavior />
    </Interaction.Behaviors>
    <local:MpAvUserControl.Styles>
        <!--  BUSY CURSOR  -->

        <Style Selector="local|MpAvClipBorder#ClipTileContainerBorder.IsAnyBusy">
            <Setter Property="Cursor"
                    Value="Wait" />
        </Style>

        <!--  DETAIL COLOR  -->

        <Style Selector="Grid#DetailContainerGrid TextBlock">
            <Setter Property="Foreground"
                    Value="Black" />
        </Style>
        <Style Selector="Grid#DetailContainerGrid.subselect TextBlock">
            <Setter Property="Foreground"
                    Value="AntiqueWhite" />
        </Style>

    </local:MpAvUserControl.Styles>
    <!--  OUTER BORDER  -->
    <local:MpAvClipBorder x:Name="ClipTileContainerBorder"
                          ClipToBounds="True"
                          HorizontalAlignment="Stretch"
                          Classes.TileHover="{Binding IsHovering}"
                          Classes.CanResize="{Binding CanResize}"
                          Classes.IsResizing="{Binding IsResizing}"
                          Classes.IsAnyBusy="{Binding IsAnyBusy}"
                          local:MpAvReceivesEventsExtension.IsEnabled="{Binding !IsDesktop, Source={x:Static local:MpAvThemeViewModel.Instance}}"
                          local:MpAvReceivesEventsExtension.SenderFilter="{Binding EmbedHost}"
                          VerticalAlignment="Stretch"
                          local:MpAvPointerCommandExtension.IsEnabled="True"
                          local:MpAvPointerCommandExtension.RoutingStrategy="Tunnel"
                          local:MpAvPointerCommandExtension.DoubleLeftPressCommand="{Binding EnableSubSelectionCommand}"
                          local:MpAvPointerCommandExtension.RightPressCommand="{Binding ShowContextMenuCommand}"
                          local:MpAvPointerCommandExtension.RightPressCommandParameter="{Binding $self}"
                          local:MpAvPointerCommandExtension.IsHoldingEnabled="{Binding !IsDesktop, Source={x:Static local:MpAvThemeViewModel.Instance}}"
                          local:MpAvPointerCommandExtension.HoldingCommand="{Binding ShowContextMenuCommand}"
                          local:MpAvPointerCommandExtension.HoldingCommandParameter="{Binding $self}"
                          ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                          ScrollViewer.VerticalScrollBarVisibility="Hidden"
                          CornerRadius="{StaticResource TileCornerRadius}"
                          BorderThickness="{StaticResource TileBorderThickness}"
                          Background="{DynamicResource ClipTileContentBackgroundBrush}">

        <Grid x:Name="TileGrid"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch"
              ColumnDefinitions="*,Auto">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"
                               MaxHeight="40" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto"
                               MaxHeight="25" />
            </Grid.RowDefinitions>

            <!--  Title  -->

            <local:MpAvClipTileTitleView x:Name="TileTitleView"
                                         Grid.Row="0"
                                         Height="{Binding MaxTitleHeight, FallbackValue=40, TargetNullValue=40}"
                                         HorizontalAlignment="Stretch"
                                         VerticalAlignment="Stretch"
                                         IsVisible="{Binding IsTitleVisible}" />

            <!--  Content  -->
            <local:MpAvClipTileContentView x:Name="ClipTileContentView"
                                           Grid.Row="1"
                                           Grid.RowSpan="2"
                                           HorizontalAlignment="Stretch"
                                           VerticalAlignment="Stretch" />

            <!--
                IsBusy Overlay
            -->
            <Border x:Name="BusyOverlay"
                    Grid.Row="1"
                    IsVisible="{Binding IsAnyBusy, FallbackValue=True, TargetNullValue=True}"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch">

                <local:MpAvBusySpinnerView HorizontalAlignment="Center"
                                           VerticalAlignment="Center"
                                           Classes="square">
                    <local:MpAvBusySpinnerView.Height>
                        <MultiBinding Converter="{x:Static local:MpAvMultiDoubleMathConverter.Instance}"
                                      ConverterParameter="/">
                            <Binding Path="Bounds.Height"
                                     ElementName="ClipTileContainerBorder" />
                            <Binding>
                                <Binding.Source>
                                    <sys:Double>4</sys:Double>
                                </Binding.Source>
                            </Binding>
                        </MultiBinding>
                    </local:MpAvBusySpinnerView.Height>
                </local:MpAvBusySpinnerView>
            </Border>

            <!--  Detail  -->
            <Grid x:Name="DetailContainerGrid"
                  Grid.Row="2"
                  Height="25"
                  Classes.subselect="{Binding IsSubSelectionEnabled}"
                  IsVisible="{Binding IsCornerButtonsVisible}"
                  local:MpAvIsHoveringExtension.IsEnabled="True"
                  local:MpAvIsHoveringExtension.IsHovering="{Binding IsOverDetailGrid, Mode=TwoWay}"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Bottom">
                <!--<TransitioningContentControl x:Name="DetailTransitioningContentControl"
                                             HorizontalAlignment="Center"
                                             Content="{Binding DetailText}">
                    <TransitioningContentControl.PageTransition>
                        <CompositePageTransition>
                            <CrossFade Duration="0:00:00.500" />
                            <PageSlide Duration="0:00:00.500"
                                       Orientation="Horizontal" />
                        </CompositePageTransition>
                    </TransitioningContentControl.PageTransition>
                    <TransitioningContentControl.ContentTemplate>
                        <DataTemplate DataType="sys:String">
                            <TextBlock HorizontalAlignment="Center"
                                       VerticalAlignment="Bottom"
                                       Background="Transparent"
                                       MinHeight="10"
                                       MinWidth="50"
                                       FontSize="10"
                                       TextAlignment="Center"
                                       Text="{Binding}" />
                        </DataTemplate>
                    </TransitioningContentControl.ContentTemplate>
                </TransitioningContentControl>-->
                <TextBlock HorizontalAlignment="Center"
                           VerticalAlignment="Bottom"
                           Background="Transparent"
                           MinHeight="10"
                           MinWidth="50"
                           FontSize="10"
                           TextAlignment="Center"
                           Text="{Binding DetailText}" />
            </Grid>

            <!--  CORNER BUTTONS  -->

            <local:MpAvClipTileCornerButtonsView x:Name="CornerButtonOverlay"
                                                 Grid.Row="0"
                                                 Grid.RowSpan="3"
                                                 IsVisible="{Binding IsCornerButtonsVisible}"
                                                 HorizontalAlignment="Stretch"
                                                 VerticalAlignment="Stretch" />

            <!--  TRANSACTION COLUMN  -->


            <local:MpAvClipTileTransactionPaneView x:Name="TransactionPanelColumn"
                                                   Grid.Column="1"
                                                   Grid.Row="0"
                                                   Grid.RowSpan="3"
                                                   DataContext="{Binding TransactionCollectionViewModel}"
                                                   Background="{DynamicResource ClipTileTransactionPaneBackgroundBrush}"
                                                   IsVisible="{Binding IsTransactionPaneOpen}"
                                                   HorizontalAlignment="Stretch"
                                                   VerticalAlignment="Stretch" />
            <!--  WIDTH RESIZER  -->

            <Border x:Name="ClipTileWidthResizeBorder"
                    Grid.Row="0"
                    Grid.RowSpan="3"
                    Grid.ColumnSpan="2"
                    Cursor="SizeWestEast"
                    local:MpAvResizeExtension.IsEnabled="{Binding IsResizerEnabled}"
                    local:MpAvResizeExtension.MinHeight="{Binding MinHeight}"
                    local:MpAvResizeExtension.MaxHeight="{Binding MaxHeight}"
                    local:MpAvResizeExtension.MinWidth="{Binding MinWidth}"
                    local:MpAvResizeExtension.MaxWidth="{Binding MaxWidth}"
                    local:MpAvResizeExtension.BoundWidth="{Binding BoundWidth, Mode=TwoWay}"
                    local:MpAvResizeExtension.BoundHeight="{Binding BoundHeight, Mode=TwoWay}"
                    local:MpAvResizeExtension.DefaultWidth="{Binding MinWidth}"
                    local:MpAvResizeExtension.DefaultHeight="{Binding MinHeight}"
                    local:MpAvResizeExtension.IsResizable="{Binding IsResizable}"
                    local:MpAvResizeExtension.CanResize="{Binding CanResize, Mode=TwoWay}"
                    local:MpAvResizeExtension.IsResizing="{Binding IsResizing, Mode=TwoWay}"
                    local:MpAvResizeExtension.XFactor="-1"
                    local:MpAvResizeExtension.YFactor="0"
                    local:MpAvResizeExtension.GlobalResizeMessage="None"
                    local:MpAvPointerCommandExtension.IsEnabled="True"
                    local:MpAvPointerCommandExtension.DoubleLeftPressCommand="{Binding ResetTileSizeToDefaultCommand}"
                    local:MpAvIsHoveringExtension.IsEnabled="True"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Stretch"
                    Width="10"
                    Background="Transparent">
                <Border.RenderTransform>
                    <TranslateTransform X="5" />
                </Border.RenderTransform>
            </Border>

            <!--  HEIGHT RESIZER  -->

            <Border x:Name="ClipTileHeightResizeBorder"
                    Grid.Row="2"
                    Grid.Column="0"
                    Grid.ColumnSpan="2"
                    Cursor="SizeNorthSouth"
                    IsHitTestVisible="{Binding IsResizerEnabled}"
                    local:MpAvResizeExtension.IsEnabled="{Binding IsResizerEnabled}"
                    local:MpAvResizeExtension.MinHeight="{Binding MinHeight}"
                    local:MpAvResizeExtension.MaxHeight="{Binding MaxHeight}"
                    local:MpAvResizeExtension.MinWidth="{Binding MinWidth}"
                    local:MpAvResizeExtension.MaxWidth="{Binding MaxWidth}"
                    local:MpAvResizeExtension.BoundWidth="{Binding BoundWidth, Mode=TwoWay}"
                    local:MpAvResizeExtension.BoundHeight="{Binding BoundHeight, Mode=TwoWay}"
                    local:MpAvResizeExtension.DefaultWidth="{Binding MinWidth}"
                    local:MpAvResizeExtension.DefaultHeight="{Binding MinHeight}"
                    local:MpAvResizeExtension.IsResizable="{Binding IsResizable}"
                    local:MpAvResizeExtension.CanResize="{Binding CanResize, Mode=TwoWay}"
                    local:MpAvResizeExtension.IsResizing="{Binding IsResizing, Mode=TwoWay}"
                    local:MpAvResizeExtension.XFactor="0"
                    local:MpAvResizeExtension.YFactor="-1"
                    local:MpAvResizeExtension.GlobalResizeMessage="None"
                    local:MpAvPointerCommandExtension.IsEnabled="True"
                    local:MpAvPointerCommandExtension.DoubleLeftPressCommand="{Binding ResetTileSizeToDefaultCommand}"
                    local:MpAvPointerCommandExtension.RoutingStrategy="Tunnel"
                    local:MpAvIsHoveringExtension.IsEnabled="True"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Bottom"
                    Height="10"
                    Background="Transparent">
                <Border.RenderTransform>
                    <TranslateTransform Y="5" />
                </Border.RenderTransform>
            </Border>

            <!--  TRANSACTION SPLITTER  -->

            <GridSplitter x:Name="TransactionContentSplitter"
                          DataContext="{Binding TransactionCollectionViewModel}"
                          Grid.Column="1"
                          Grid.Row="0"
                          Grid.RowSpan="3"
                          Classes="vertical"
                          Classes.desktop="{Binding IsDesktop, Source={x:Static local:MpAvThemeViewModel.Instance}}"
                          IsVisible="{Binding IsTransactionPaneOpen, FallbackValue=False, TargetNullValue=False}"
                          HorizontalAlignment="Left"
                          VerticalAlignment="Stretch" />

            <!--  Trial Expired Overlay  -->
            <Border x:Name="TrialExpiredOverlay"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    IsVisible="{Binding IsTrialOverlayVisibile}">
                <Border.Background>
                    <SolidColorBrush Color="Black" Opacity="0.2" />
                </Border.Background>

                <Viewbox Stretch="Uniform"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Center"
                         Width="50"
                         Height="50"
                         IsVisible="{Binding IsPinned}">
                    <Path Fill="Wheat"
                          Data="{StaticResource LockSvg}" />
                </Viewbox>
            </Border>
        </Grid>
    </local:MpAvClipBorder>
</local:MpAvUserControl>
