<local:MpAvUserControl xmlns="https://github.com/avaloniaui"
                       xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                       xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                       xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                       xmlns:sys="clr-namespace:System;assembly=mscorlib"
                       mc:Ignorable="d"
                       d:DesignWidth="200"
                       d:DesignHeight="50"
                       xmlns:local="using:MonkeyPaste.Avalonia"
                       xmlns:pcl="using:MonkeyPaste"
                       x:DataType="local:MpAvSearchBoxViewModel"
                       x:TypeArguments="local:MpAvSearchBoxViewModel"
                       x:CompileBindings="True"
                       DataContext="{x:Static local:MpAvSearchBoxViewModel.Instance}"
                       x:Class="MonkeyPaste.Avalonia.MpAvSearchBoxView">
    <local:MpAvUserControl.Resources>
        <sys:Double x:Key="SearchIconSize">
            25
        </sys:Double>
        <sys:Double x:Key="AddIconSize">
            35
        </sys:Double>
        <sys:Double x:Key="SearchTextBoxBorder_width_opened">
            280
        </sys:Double>
    </local:MpAvUserControl.Resources>
    <local:MpAvUserControl.Styles>

        <!--  PLUS TRANSITION  -->

        <Style Selector="Grid#SearchContainerGrid.showPlus ToggleButton#ConvertToAdvancedSearchToggleButton">
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Width"
                                      Duration="{StaticResource FilterExpandTimeSpan}" />
                    <ThicknessTransition Property="Margin"
                                         Duration="{StaticResource FilterExpandTimeSpan}" />
                    <DoubleTransition Property="Opacity"
                                      Duration="{StaticResource FilterExpandTimeSpan}" />

                </Transitions>
            </Setter>
            <Setter Property="Width"
                    Value="{StaticResource AddIconSize}" />
            <Setter Property="Margin"
                    Value="5" />
            <Setter Property="Opacity"
                    Value="1" />
        </Style>
        <Style Selector="Grid#SearchContainerGrid.hidePlus ToggleButton#ConvertToAdvancedSearchToggleButton">
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Width"
                                      Duration="{StaticResource FilterExpandTimeSpan}" />
                    <ThicknessTransition Property="Margin"
                                         Duration="{StaticResource FilterExpandTimeSpan}" />
                    <DoubleTransition Property="Opacity"
                                      Duration="{StaticResource FilterExpandTimeSpan}" />
                </Transitions>
            </Setter>
            <Setter Property="Width"
                    Value="0" />
            <Setter Property="Margin"
                    Value="0" />
            <Setter Property="Opacity"
                    Value="0" />
        </Style>
        <Style Selector="Grid#SearchContainerGrid.hidePlus local|MpAvClipBorder#SearchTextBoxBorder">
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Width"
                                      Duration="{StaticResource FilterExpandTimeSpan}" />
                </Transitions>
            </Setter>
            <Setter Property="Width"
                    Value="{Binding Bounds.Width, ElementName=SearchContainerGrid}" />
        </Style>
        <!--  SEARCH ICON  -->

        <Style Selector="local|MpAvClipBorder#SearchTextBoxBorder.unexpanded Button#SearchDropDownButton:pointerover PathIcon">
            <Setter Property="Foreground"
                    Value="Gainsboro" />
        </Style>
        <Style Selector="local|MpAvClipBorder#SearchTextBoxBorder.expanded Button#SearchDropDownButton:pointerover PathIcon">
            <Setter Property="Foreground"
                    Value="Yellow" />
        </Style>

        <Style Selector="local|MpAvClipBorder#SearchTextBoxBorder.expanded Button#SearchDropDownButton PathIcon">
            <Setter Property="Transitions">
                <Transitions>
                    <BrushTransition Property="Foreground"
                                     Duration="{StaticResource FilterExpandTimeSpan}" />
                </Transitions>
            </Setter>
            <Setter Property="Foreground"
                    Value="Black" />
        </Style>
        <Style Selector="local|MpAvClipBorder#SearchTextBoxBorder.unexpanded Button#SearchDropDownButton PathIcon">
            <Setter Property="Transitions">
                <Transitions>
                    <BrushTransition Property="Foreground"
                                     Duration="{StaticResource FilterExpandTimeSpan}" />
                </Transitions>
            </Setter>
            <Setter Property="Foreground"
                    Value="White" />
        </Style>

        <!--  SEARCH BOX BORDER  -->

        <Style Selector="local|MpAvClipBorder.searchBorder">
            <Setter Property="Margin"
                    Value="5" />
            <Setter Property="BorderThickness"
                    Value="2" />
            <Setter Property="CornerRadius"
                    Value="10" />
        </Style>
        <Style Selector="local|MpAvClipBorder#SearchTextBoxBorder.expanded"
               x:DataType="local:MpAvSearchBoxViewModel">
            <Style.Animations>
                <Animation Duration="{StaticResource FilterExpandTimeSpan}"
                           FillMode="Forward">
                    <KeyFrame Cue="0%">
                        <Setter Property="Width"
                                Value="{StaticResource SearchIconSize}" />
                        <Setter Property="Background"
                                Value="Transparent" />
                        <Setter Property="BorderBrush"
                                Value="Transparent" />
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="Width"
                                Value="{StaticResource SearchTextBoxBorder_width_opened}" />
                        <Setter Property="Background"
                                Value="White" />
                        <Setter Property="BorderBrush"
                                Value="White" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>
        <Style Selector="local|MpAvClipBorder#SearchTextBoxBorder.unexpanded"
               x:DataType="local:MpAvSearchBoxViewModel">
            <Style.Animations>
                <Animation Duration="{StaticResource FilterExpandTimeSpan}"
                           FillMode="Forward">
                    <KeyFrame Cue="0%">
                        <Setter Property="Width"
                                Value="{StaticResource SearchTextBoxBorder_width_opened}" />
                        <Setter Property="Background"
                                Value="White" />
                        <Setter Property="BorderBrush"
                                Value="White" />
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="Width"
                                Value="{StaticResource SearchIconSize}" />
                        <Setter Property="Background"
                                Value="Transparent" />
                        <Setter Property="BorderBrush"
                                Value="Transparent" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

        <Style Selector="local|MpAvClipBorder#SearchTextBoxBorder.expanded:not(.valid)">
            <Setter Property="BorderBrush"
                    Value="Red" />
        </Style>

        <!--  AUTOCOMPLETE BOX  -->

        <Style Selector="AutoCompleteBox /template/ TextBox#PART_TextBox">
            <Setter Property="VerticalContentAlignment"
                    Value="Center" />
        </Style>
        <Style Selector="AutoCompleteBox:focus-within /template/ TextBox#PART_TextBox /template/ Border#PART_BorderElement">
            <Setter Property="BorderBrush"
                    Value="Transparent" />
        </Style>

        <!--  NAV BUTTONS  -->
        <Style Selector="Button.navButton PathIcon">
            <Setter Property="Foreground"
                    Value="Black" />
        </Style>
        <Style Selector="Button.navButton:pointerover PathIcon">
            <Setter Property="Foreground"
                    Value="DimGray" />
        </Style>

        <!--  CONVERT SIMPLE/ TOGGLE EXPAND ADV BUTTON  -->
        <!--  UNCHECKED  -->
        <Style Selector="ToggleButton#ConvertToAdvancedSearchToggleButton:unchecked:not(.saved) Image">
            <Setter Property="Source"
                    Value="{Binding Source={StaticResource PlusSolidImage}, Converter={x:Static local:MpAvStringHexToBitmapTintConverter.Instance}, ConverterParameter=white}" />
        </Style>
        <Style Selector="ToggleButton#ConvertToAdvancedSearchToggleButton:unchecked.saved Image">
            <Setter Property="Source"
                    Value="{Binding Source={StaticResource EdgeArrowDownImage}, Converter={x:Static local:MpAvStringHexToBitmapTintConverter.Instance}, ConverterParameter=white}" />
        </Style>

        <!--  CHECKED  -->
        <Style Selector="ToggleButton#ConvertToAdvancedSearchToggleButton:checked Image">
            <Setter Property="Source"
                    Value="{Binding Source={StaticResource EdgeArrowUpImage}, Converter={x:Static local:MpAvStringHexToBitmapTintConverter.Instance}, ConverterParameter=white}" />
        </Style>

    </local:MpAvUserControl.Styles>
    <Grid x:Name="SearchContainerGrid"
          VerticalAlignment="Stretch"
          Classes.showPlus="{Binding IsExpandAdvancedSearchButtonVisible}"
          Classes.hidePlus="{Binding !IsExpandAdvancedSearchButtonVisible}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <Grid Grid.Column="0">

            <!--  ROUNDED SEARCH BOX OUTER BORDER  -->

            <local:MpAvClipBorder x:Name="SearchTextBoxBorder"
                                  Classes.searchBorder="True"
                                  Classes.valid="{Binding IsSearchValid}"
                                  Classes.expanded="{Binding IsExpanded}"
                                  Classes.unexpanded="{Binding !IsExpanded}"
                                  Classes.expandAnimating="{Binding IsExpandAnimating}">
                <DockPanel LastChildFill="True">

                    <!--  Search Icon Dropdown Button  -->

                    <Button x:Name="SearchDropDownButton"
                            DockPanel.Dock="Left"
                            ClipToBounds="False"
                            VerticalAlignment="Stretch"
                            MinWidth="{StaticResource SearchIconSize}"
                            MinHeight="{StaticResource SearchIconSize}"
                            Command="{Binding HandleSearchButtonClickCommand}"
                            CommandParameter="{Binding $self}"
                            local:MpAvMenuExtension.IsOpen="{Binding SearchFilterCollectionViewModel.IsPopupMenuOpen}"
                            Classes="noBg noHoverBg shakeOver">
                        <ToolTip.Tip>
                            <local:MpAvToolTipView ToolTipText="{Binding SearchIconToolTipText}" />
                        </ToolTip.Tip>
                        <Button.RenderTransform>
                            <RotateTransform />
                        </Button.RenderTransform>
                        <PathIcon Data="{StaticResource MagnifySvg}" />
                    </Button>

                    <Grid ColumnDefinitions="Auto,Auto"
                          DockPanel.Dock="Right">
                        <Grid.IsVisible>
                            <MultiBinding Converter="{x:Static BoolConverters.Or}">
                                <Binding Path="IsExpandAnimating" />
                                <Binding Path="IsExpanded" />
                            </MultiBinding>
                        </Grid.IsVisible>
                        <!--  IsSearching Spinner  -->

                        <local:MpAvBusySpinnerView Grid.Column="0"
                                                   Margin="5"
                                                   VerticalAlignment="Stretch"
                                                   Width="{Binding $self.Bounds.Height}">
                            <local:MpAvBusySpinnerView.IsVisible>
                                <MultiBinding Converter="{StaticResource MultiBoolConverter}"
                                              ConverterParameter="AND">
                                    <Binding Path="HasText" />
                                    <Binding Path="IsSearching" />
                                </MultiBinding>
                            </local:MpAvBusySpinnerView.IsVisible>
                        </local:MpAvBusySpinnerView>

                        <!--  Clear SearchText Button  -->

                        <local:MpAvClearTextButton x:Name="ClearSearchTextButton"
                                                   Classes="TextBoxButton"
                                                   Grid.Column="0"
                                                   Margin="5"
                                                   Command="{Binding ClearTextCommand}"
                                                   Width="{Binding $self.Bounds.Height}"
                                                   VerticalAlignment="Stretch">
                            <local:MpAvClearTextButton.IsVisible>
                                <MultiBinding Converter="{StaticResource MultiBoolConverter}"
                                              ConverterParameter="AND">
                                    <Binding Path="HasText" />
                                    <Binding Path="!IsSearching" />
                                </MultiBinding>
                            </local:MpAvClearTextButton.IsVisible>
                        </local:MpAvClearTextButton>

                        <Grid Grid.Column="1"
                              ColumnDefinitions="0.5*,0.5*"
                              IsVisible="{Binding !IsSearching}">
                            <!--  Previous Result Button  -->

                            <Button x:Name="PreviousTemplateButton"
                                    Grid.Column="0"
                                    Classes="noBg noHoverBg navButton"
                                    Margin="0,5"
                                    Width="{Binding $self.Bounds.Height}"
                                    VerticalAlignment="Stretch"
                                    IsVisible="{Binding IsMultipleMatches}"
                                    Command="{Binding PrevMatchCommand}"
                                    TabIndex="2">
                                <PathIcon Data="{StaticResource MenuDownArrowSvg}">
                                    <PathIcon.RenderTransform>
                                        <RotateTransform Angle="90" />
                                    </PathIcon.RenderTransform>
                                </PathIcon>
                            </Button>

                            <!--  Next Result Button  -->
                            <Button x:Name="NextTemplateButton"
                                    Grid.Column="1"
                                    Classes="noBg noHoverBg navButton"
                                    Margin="0,5"
                                    Width="{Binding $self.Bounds.Height}"
                                    VerticalAlignment="Stretch"
                                    IsVisible="{Binding IsMultipleMatches}"
                                    Command="{Binding NextMatchCommand}"
                                    TabIndex="3">
                                <PathIcon Data="{StaticResource MenuDownArrowSvg}">
                                    <PathIcon.RenderTransform>
                                        <RotateTransform Angle="-90" />
                                    </PathIcon.RenderTransform>
                                </PathIcon>
                            </Button>
                        </Grid>
                    </Grid>

                    <!--  SEARCH AUTOCOMPLETE BOX  -->

                    <AutoCompleteBox x:Name="SearchBox"
                                     DragDrop.AllowDrop="True"
                                     VerticalAlignment="Stretch"
                                     HorizontalAlignment="Stretch"
                                     local:MpAvIsFocusedExtension.IsEnabled="True"
                                     local:MpAvIsFocusedExtension.IsFocused="{Binding IsTextBoxFocused, Mode=TwoWay}"
                                     local:MpAvIsHoveringExtension.IsEnabled="True"
                                     local:MpAvIsHoveringExtension.HoverCursor="IBeam"
                                     local:MpAvDelayedTextChangedExtension.IsEnabled="True"
                                     local:MpAvDelayedTextChangedExtension.DelayMs="500"
                                     local:MpAvDelayedTextChangedExtension.Text="{Binding SearchText, Mode=TwoWay}"
                                     Watermark="Search..."
                                     FontSize="14"
                                     Background="Transparent"
                                     IsTextCompletionEnabled="False"
                                     MinimumPrefixLength="0"
                                     MinimumPopulateDelay="0.25"
                                     Items="{Binding RecentSearchTexts}"
                                     FontStyle="{Binding TextBoxFontStyle}"
                                     BorderThickness="0"
                                     Padding="0"
                                     Margin="5,0,0,0">
                        <AutoCompleteBox.IsVisible>
                            <MultiBinding Converter="{x:Static BoolConverters.Or}">
                                <Binding Path="IsExpandAnimating" />
                                <Binding Path="IsExpanded" />
                            </MultiBinding>
                        </AutoCompleteBox.IsVisible>
                    </AutoCompleteBox>
                </DockPanel>
            </local:MpAvClipBorder>

            <!--  SEARCH BOX DISABLED OVERLAY  -->

            <local:MpAvClipBorder Classes.searchBorder="True"
                                  HorizontalAlignment="Stretch"
                                  VerticalAlignment="Stretch"
                                  Opacity="0.5"
                                  Background="DimGray"
                                  BorderBrush="DimGray"
                                  IsVisible="False" />
        </Grid>

        <!--  CONVERT SIMPLE TO ADVANCED SEARCH BUTTON  -->

        <ToggleButton x:Name="ConvertToAdvancedSearchToggleButton"
                      Grid.Column="1"
                      VerticalAlignment="Stretch"
                      HorizontalAlignment="Stretch"
                      IsChecked="{Binding IsExpanded, Mode=TwoWay, Source={x:Static local:MpAvSearchCriteriaItemCollectionViewModel.Instance}}"
                      Classes="noBg noHoverBg outlineOver"
                      Classes.saved="{Binding IsSavedQuery, Source={x:Static local:MpAvSearchCriteriaItemCollectionViewModel.Instance}}">
            <Image Classes="shakeOver">
                <Image.RenderTransform>
                    <RotateTransform />
                </Image.RenderTransform>
            </Image>
        </ToggleButton>
        <!--</StackPanel>-->
    </Grid>
</local:MpAvUserControl>
