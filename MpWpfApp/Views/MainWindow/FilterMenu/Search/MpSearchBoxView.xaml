<local:MpUserControl
    x:Class="MpWpfApp.MpSearchBoxView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:local="clr-namespace:MpWpfApp"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DataContext="{d:DesignInstance Type=local:MpSearchBoxViewModel,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    x:TypeArguments="local:MpSearchBoxViewModel"
    mc:Ignorable="d">
    <StackPanel
        x:Name="SearchViewContainerStackPanel"
        Loaded="SearchViewContainerStackPanel_Loaded"
        Orientation="Horizontal">
        <Button
            x:Name="DeleteSearchButton"
            local:MpHoverableExtension.IsEnabled="True"
            local:MpHoverableExtension.IsHovering="{Binding IsOverDeleteSearchButton}"
            Background="Transparent"
            BorderThickness="0"
            Command="{Binding DeleteSearchCommand}"
            Foreground="Transparent"
            Style="{StaticResource Transparent_Button}"
            Visibility="{Binding CanDeleteSearch, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter={StaticResource Hide}}">
            <Border
                Padding="12,5"
                Background="LightGray"
                BorderBrush="{Binding DeleteSearchButtonBorderBrush}"
                BorderThickness="3"
                CornerRadius="5">
                <TextBlock
                    Background="Transparent"
                    FontWeight="Bold"
                    Foreground="DimGray"
                    Text="DELETE" />
            </Border>
        </Button>
        <Button
            x:Name="SaveSearchButton"
            local:MpHoverableExtension.IsEnabled="True"
            local:MpHoverableExtension.IsHovering="{Binding IsOverSaveSearchButton, Mode=TwoWay}"
            Background="Transparent"
            BorderThickness="0"
            Command="{Binding SaveSearchCommand}"
            Foreground="Transparent"
            Style="{StaticResource Transparent_Button}"
            Visibility="{Binding HasCriteriaItems, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter={StaticResource Hide}}">
            <Border
                Padding="12,5"
                Background="LightGray"
                BorderBrush="{Binding SaveSearchButtonBorderBrush}"
                BorderThickness="3"
                CornerRadius="5">
                <TextBlock
                    Background="Transparent"
                    FontWeight="Bold"
                    Foreground="DimGray"
                    Text="SAVE" />
            </Border>
        </Button>

        <!--  Search Border  -->
        <!--  Grid.ColumnSpan="{Binding SearchBorderColumnSpan}"  -->
        <local:MpClipBorder
            x:Name="SearchTextBoxBorder"
            Grid.Column="0"
            Width="280"
            Margin="8"
            Background="White"
            BorderBrush="{Binding IsTextValid, Converter={StaticResource BoolToBrushConverter}, ConverterParameter='#FFFFFFFF|#FFFF0000'}"
            BorderThickness="2"
            CornerRadius="10"
            DataContextChanged="SearchTextBoxBorder_DataContextChanged">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="0.15*" />
                    <ColumnDefinition Width="*" />
                    <!--  Width is 0.1* or 0.2*  -->
                    <ColumnDefinition Width="{Binding ClearAndAddCriteriaColumnWidth}" />
                </Grid.ColumnDefinitions>
                <!--  Search Icon Dropdown Button  -->
                <Button
                    x:Name="SearchDropDownButton"
                    Grid.Column="0"
                    Width="25"
                    Height="25"
                    Margin="3,0,0,0"
                    Background="Transparent"
                    BorderThickness="0"
                    PreviewMouseLeftButtonDown="SearchDropDownButton_PreviewMouseLeftButtonDown"
                    Template="{StaticResource SearchButtonControlTemplate}">
                    <!--<Button.ContextMenu>
                        <ContextMenu ItemsSource="{Binding Filters}">
                            <ContextMenu.ItemContainerStyle>
                                <Style TargetType="MenuItem">
                                    <Setter Property="Header" Value="{Binding Label}" />
                                    <Setter Property="IsChecked" Value="{Binding IsChecked, Mode=TwoWay}" />
                                    <Setter Property="IsCheckable" Value="True"/>
                                    <Setter Property="IsEnabled" Value="{Binding IsEnabled}"/>
                                </Style>
                            </ContextMenu.ItemContainerStyle>
                        </ContextMenu>
                    </Button.ContextMenu>-->
                    <Image
                        SnapsToDevicePixels="True"
                        Source="{Binding ., Source={StaticResource SearchIcon}, Converter={StaticResource StringResourceToImageSourceConverter}}"
                        Stretch="Fill" />
                </Button>
                <!--  Search TextBox  -->
                <!--<TextBox x:Name="SearchBox"
                         GotFocus="SearchBox_GotFocus"
                         Grid.Column="1"
                         AllowDrop="False"
                         FontSize="18"
                         Background="Transparent"
                         PreviewMouseLeftButtonDown="SearchBox_PreviewMouseLeftButtonDown"
                         local:MpHoverableExtension.IsEnabled="True"
                         local:MpHoverableExtension.HoverCursor="IBeam"
                         Foreground="{Binding TextBoxTextBrush}"
                         FontStyle="{Binding TextBoxFontStyle}"
                         BorderThickness="0"
                         VerticalContentAlignment="Center"
                         KeyUp="SearchBox_KeyUp"
                         CaretBrush="{Binding CaretBrush}"
                         Text="{Binding SearchText,
                                        Mode=TwoWay,
                                        NotifyOnTargetUpdated=True,
                                        UpdateSourceTrigger=PropertyChanged}" />-->
                <ComboBox
                    x:Name="SearchBox"
                    Grid.Column="1"
                    VerticalContentAlignment="Top"
                    local:MpHoverableExtension.HoverCursor="IBeam"
                    local:MpHoverableExtension.IsEnabled="True"
                    AllowDrop="False"
                    Background="Transparent"
                    BorderThickness="0"
                    FontSize="18"
                    FontStyle="{Binding TextBoxFontStyle}"
                    Foreground="{Binding TextBoxTextBrush}"
                    GotFocus="SearchBox_GotFocus"
                    IsDropDownOpen="{Binding IsAnyDropDownOpen, Source={x:Static local:MpMainWindowViewModel.Instance}, Mode=OneWayToSource}"
                    IsEditable="True"
                    IsTextSearchCaseSensitive="True"
                    IsVisibleChanged="SearchBox_IsVisibleChanged"
                    ItemsSource="{Binding RecentSearchTexts}"
                    LostFocus="SearchBox_LostFocus"
                    PreviewKeyUp="SearchBox_KeyUp"
                    StaysOpenOnEdit="True" 
                    Margin="0,-2,0,0"
                    Text="{Binding SearchText, Mode=TwoWay, NotifyOnTargetUpdated=True, UpdateSourceTrigger=PropertyChanged}">
                    <ComboBox.ItemContainerStyle>
                        <Style TargetType="ComboBoxItem">
                            <Setter Property="HorizontalAlignment" Value="Stretch" />
                        </Style>
                    </ComboBox.ItemContainerStyle>
                </ComboBox>
                <!--  Placeholder TextBlock  -->
                <TextBlock
                    x:Name="SearchBoxPlaceholderBlock"
                    Grid.Column="1"
                    Margin="0"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Center"
                    FontSize="18"
                    FontStyle="Italic"
                    Foreground="DarkGray"
                    IsHitTestVisible="False"
                    Text="{Binding PlaceholderText}"
                    Visibility="{Binding IsPlaceholderVisible, Converter={StaticResource BoolToVisibilityConverter}}" />
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <!--  IsSearching Spinner  -->
                    <local:MpSpinnerApple
                        x:Name="IsSearchingSpinner"
                        Margin="0,0,10,0"
                        VerticalAlignment="Center"
                        Visibility="{Binding IsSearching, Converter={StaticResource BoolToVisibilityConverter}}" />
                    <!--  Clear SearchText Button  -->
                    <Button
                        x:Name="ClearTextBoxButton"
                        Width="15"
                        Height="15"
                        VerticalAlignment="Center"
                        local:MpHoverableExtension.IsEnabled="True"
                        local:MpHoverableExtension.IsHovering="{Binding IsOverClearTextButton}"
                        BorderThickness="0"
                        Click="ClearTextBoxButton_Click"
                        Style="{StaticResource SemiTransparentButton}"
                        Visibility="{Binding ClearTextButtonVisibility}">
                        <Button.Background>
                            <ImageBrush ImageSource="{Binding ClearButtonImagePath, Converter={StaticResource StringResourceToImageSourceConverter}}" />
                        </Button.Background>
                    </Button>
                    <!--  Search Navigation Border  -->
                    <Border
                        Margin="10,0,0,0"
                        HorizontalAlignment="Left"
                        CornerRadius="10"
                        Visibility="{Binding IsMultipleMatches, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <Button
                                x:Name="PreviousTemplateButton"
                                Width="10"
                                Height="10"
                                Padding="5"
                                Command="{Binding PrevMatchCommand}"
                                Style="{StaticResource SemiTransparentButton}"
                                TabIndex="2">
                                <Image Source="/Resources/Images/back_black.png" />
                            </Button>
                            <Button
                                x:Name="NextTemplateButton"
                                Width="10"
                                Height="10"
                                Margin="3,0,0,0"
                                Padding="5"
                                Command="{Binding NextMatchCommand}"
                                Style="{StaticResource SemiTransparentButton}"
                                TabIndex="3">
                                <Image Source="/Resources/Images/forward_black.png" />
                            </Button>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </local:MpClipBorder>
        <!--  Add Or Clear Search Criteria Button  -->
        <Button
            x:Name="AddSearchCriteriaButton"
            Margin="5,10"
            BorderThickness="0"
            Command="{Binding AddSearchCriteriaItemCommand}"
            Template="{StaticResource SearchButtonControlTemplate}"
            Visibility="{Binding HasCriteriaItems, Converter={StaticResource BoolToVisibilityFlipConverter}}">
            <Image
                Width="20"
                Height="20"
                Source="{Binding ., Source={StaticResource PlusIcon}}"
                Stretch="Uniform" />
        </Button>
        <Button
            x:Name="ClearSearchCriteriaButton"
            Margin="5"
            BorderThickness="0"
            Command="{Binding ClearSearchCriteriaItemsCommand}"
            Template="{StaticResource SearchButtonControlTemplate}"
            Visibility="{Binding HasCriteriaItems, Converter={StaticResource BoolToVisibilityConverter}}">
            <Image
                Width="20"
                Height="20"
                Source="{Binding ., Source={StaticResource MinusIcon}}"
                Stretch="Uniform" />
        </Button>
    </StackPanel>
</local:MpUserControl>
