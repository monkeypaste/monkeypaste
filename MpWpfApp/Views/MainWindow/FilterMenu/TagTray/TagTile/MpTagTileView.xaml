<UserControl x:Class="MpWpfApp.MpTagTileView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MpWpfApp"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <local:MpClipBorder x:Name="TagTileBorder"
                        Loaded="TagTileBorder_Loaded"
                        MouseEnter="TagTileBorder_MouseEnter"
                        MouseLeave="TagTileBorder_MouseLeave"
                        LostFocus="TagTileBorder_LostFocus"
                        PreviewMouseLeftButtonDown="TagTileBorder_PreviewMouseLeftButtonDown"
                        CornerRadius="10"
                        Margin="5,3,0,0"
                        Padding="7,5,7,5"
                        Focusable="True"
                        VerticalAlignment="Stretch"
                        Background="{Binding TagBorderBackgroundBrush}"
                        BorderBrush="{Binding TagBorderBrush}"
                        Tag="{Binding DataContext,RelativeSource={RelativeSource Mode=Self}}"
                        BorderThickness="1.5"
                        Height="{Binding TagHeight}">
        <local:MpClipBorder.Resources>
            <local:MpBindingProxy x:Key="TagTileProxy"
                                  Data="{Binding}" />
        </local:MpClipBorder.Resources>
        <i:Interaction.Triggers>
            <i:EventTrigger EventName="Loaded">
                <i:CallMethodAction TargetObject="{Binding}"
                                    MethodName="TagTile_Loaded" />
            </i:EventTrigger>
        </i:Interaction.Triggers>
        <local:MpClipBorder.ContextMenu>
            <ContextMenu Loaded="ContextMenu_Loaded"
                         Opened="ContextMenu_Opened">
                <MenuItem Header="Rename"
                          Icon="{Binding Source={StaticResource RenameIcon}, Converter={StaticResource StringToIconConverter}, Mode=OneWay}"
                          Command="{Binding PlacementTarget.Tag.RenameTagCommand, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=ContextMenu}}" />
                <MenuItem Header="Assign Hotkey"
                          Icon="{Binding Source={StaticResource HotkeyIcon}, Converter={StaticResource StringToIconConverter}, Mode=OneWay}"
                          InputGestureText="{Binding PlacementTarget.Tag.ShortcutKeyString, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=ContextMenu}}"
                          Command="{Binding PlacementTarget.Tag.AssignHotkeyCommand, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=ContextMenu}}" />
                <Separator />
                <MenuItem x:Name="ClipTileColorContextMenuItem"
                          Style="{StaticResource ColorPalleteMenuItemStyle}" />
                <Separator />
                <MenuItem Header="Delete"
                          Icon="{Binding Source={StaticResource DeleteIcon}, Converter={StaticResource StringToIconConverter}, Mode=OneWay}"
                          Command="{Binding DeleteTagCommand, Source={StaticResource TagTrayViewModel}}" />
            </ContextMenu>
        </local:MpClipBorder.ContextMenu>
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <!-- Tag Count Box-->
            <local:MpClipBorder CornerRadius="5"
                                Grid.Column="0"
                                Grid.Row="0"
                                MinWidth="20"
                                Margin="3,0,0,0"
                                Padding="5"
                                BorderThickness="0"
                                Background="{Binding TagColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, NotifyOnTargetUpdated=True, NotifyOnSourceUpdated=True}">
                <TextBlock Background="Transparent"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           Text="{Binding TagClipCount, Converter={StaticResource IntToStringConverter}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, NotifyOnTargetUpdated=True, NotifyOnSourceUpdated=True}"
                           Foreground="{Binding TagCountTextColor}" />
            </local:MpClipBorder>
            <TextBlock x:Name="TagTextBlock"
                       Grid.Column="1"
                       Grid.Row="0"
                       Margin="5,0,0,0"
                       Background="Transparent"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Visibility="{Binding TextBlockVisibility}"
                       FontSize="{Binding TagFontSize}"
                       FontWeight="SemiBold"
                       Foreground="{Binding TagTextColor}"
                       Text="{Binding TagName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, NotifyOnTargetUpdated=True, NotifyOnSourceUpdated=True}"></TextBlock>
            <TextBox x:Name="TagTextBox"
                     IsVisibleChanged="TagTextBox_IsVisibleChanged"
                     LostFocus="TagTextBox_LostFocus"
                     PreviewKeyDown="TagTextBox_PreviewKeyDown"
                     Grid.Row="0"
                     Grid.Column="1"
                     Margin="5,0,0,0"
                     Background="White"
                     Foreground="Black"
                     IsReadOnly="False"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center"
                     Visibility="{Binding TextBoxVisibility}"
                     FontSize="{Binding TagFontSize}"
                     Text="{Binding TagName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, NotifyOnTargetUpdated=True, NotifyOnSourceUpdated=True}" />
        </Grid>
    </local:MpClipBorder>
</UserControl>
