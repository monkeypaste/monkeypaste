<local:MpUserControl x:Class="MpWpfApp.MpAnalyticItemPresetDataGridView"
                     xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                     xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                     xmlns:dd="clr-namespace:GongSolutions.Wpf.DragDrop;assembly=GongSolutions.Wpf.DragDrop"
                     xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
                     xmlns:local="clr-namespace:MpWpfApp"
                     x:TypeArguments="local:MpAnalyticItemViewModel"
                     mc:Ignorable="d"
                     d:DesignHeight="450"
                     d:DesignWidth="800"
                     d:DataContext="{d:DesignInstance Type=local:MpAnalyticItemViewModel,
                                                      IsDesignTimeCreatable=False}">
    <Border CornerRadius="3"
            Margin="10,0"
            BorderThickness="1"
            BorderBrush="Black"
            Background="Transparent">
        <StackPanel Orientation="Vertical">
            <TextBlock Text="Presets"
                       FontSize="20"
                       Margin="5,0"
                       Foreground="White"
                       Background="Transparent"
                       FontWeight="SemiBold" />
            <DataGrid x:Name="AnalyticItemDatagrid"
                      dd:DragDrop.IsDragSource="True"
                      dd:DragDrop.IsDropTarget="True"
                      ItemsSource="{Binding Items}"
                      SelectionMode="Single"
                      BorderThickness="10"
                      HeadersVisibility="None"
                      RowHeaderWidth="0"
                      Margin="5"
                      HorizontalAlignment="Stretch"
                      MaxHeight="150"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      ScrollViewer.VerticalScrollBarVisibility="Auto"
                      IsReadOnly="False"
                      AutoGenerateColumns="False">
                <DataGrid.Resources>
                    <!--<SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}"
                                     Color="Transparent" />-->
                    <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightBrushKey}"
                                     Color="DarkGray" />
                </DataGrid.Resources>
                <DataGrid.RowStyle>
                    <Style TargetType="{x:Type DataGridRow}">
                        <Setter Property="IsSelected"
                                Value="{Binding IsSelected}" />
                        <Setter Property="Visibility"
                                Value="{Binding IsActionPreset,
                                                Converter={StaticResource BoolToVisibilityFlipConverter}}" />
                    </Style>
                </DataGrid.RowStyle>
                <DataGrid.Columns>
                    <DataGridTemplateColumn Width="50"
                                            Header="Icon">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border x:Name="ButtonBorder"
                                        BorderThickness="0">
                                    <Button x:Name="PresetIcon"
                                            BorderThickness="0"
                                            Height="40"
                                            Cursor="Hand"
                                            Background="Transparent"
                                            IsEnabled="{Binding IsDefault,
                                                                Converter={StaticResource BoolFlipConverter}}"
                                            DataContext="{Binding}"
                                            Template="{StaticResource SearchButtonControlTemplate}"
                                            Command="{Binding ChangeIconCommand,
                                                              Source={x:Static local:MpIconCollectionViewModel.Instance}}"
                                            CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor,
                                                                                                      AncestorType=Border}}">
                                        <Image Width="20"
                                               Height="20"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               Source="{Binding IconId,
                                                                Converter={StaticResource IconIdToImageSourceConverter}}" />
                                    </Button>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Label"
                                            Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Grid ClipToBounds="True"
                                      Margin="1,0"
                                      PreviewMouseLeftButtonDown="Grid_PreviewMouseLeftButtonDown">
                                    <TextBox FontSize="16"
                                             Background="White"
                                             BorderThickness="0"
                                             local:MpIsFocusedExtension.IsEnabled="True"
                                             local:MpIsFocusedExtension.IsFocused="{Binding IsLabelTextBoxFocused,
                                                                                            Mode=TwoWay}"
                                             Foreground="Black"
                                             local:MpMarqueeTextBoxExtension.IsEnabled="True"
                                             local:MpMarqueeTextBoxExtension.IsReadOnly="{Binding IsLabelReadOnly,
                                                                                                  Mode=TwoWay}"
                                             IsReadOnly="{Binding IsLabelReadOnly,
                                                                  Mode=OneWay}"
                                             MaxWidth="118"
                                             Text="{Binding Label,
                                                            Mode=TwoWay,
                                                            NotifyOnSourceUpdated=True,
                                                            NotifyOnTargetUpdated=True,
                                                            UpdateSourceTrigger=PropertyChanged}"
                                             VerticalAlignment="Center" />
                                </Grid>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Quick Action?"
                                            Width="Auto">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <CheckBox HorizontalAlignment="Center"
                                          VerticalAlignment="Center"
                                          ToolTip="Quick Action?"
                                          ToolTipService.InitialShowDelay="0"
                                          IsChecked="{Binding IsQuickAction,
                                                              Mode=TwoWay,
                                                              UpdateSourceTrigger=PropertyChanged,
                                                              NotifyOnTargetUpdated=True,
                                                              NotifyOnSourceUpdated=True}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Width="Auto"
                                            Header="Hot Key">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <local:MpShortcutGestureView Background="Transparent"
                                                             DataContext="{Binding}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn MinWidth="40">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid Visibility="{Binding Parent.IsBusy,
                                                               Converter={StaticResource BoolToVisibilityFlipConverter}}">
                                        <Button Background="Transparent"
                                                BorderThickness="0"
                                                ToolTip="Analyze"
                                                Visibility="{Binding Parent.CanAnalyzerExecute,
                                                                     Converter={StaticResource BoolToVisibilityConverter}}"
                                                Command="{Binding Parent.ExecuteAnalysisCommand}"
                                                CommandParameter="{Binding}">
                                            <Image Width="20"
                                                   Height="20"
                                                   Source="{Binding .,
                                                                    Converter={StaticResource StringResourceToImageSourceConverter},
                                                                    Source={StaticResource ExecuteIcon}}" />
                                        </Button>
                                        <Image Width="20"
                                               Height="20"
                                               ToolTip="{Binding Parent.CannotExecuteTooltip}"
                                               ToolTipService.InitialShowDelay="0"
                                               Visibility="{Binding Parent.CanAnalyzerExecute,
                                                                    Converter={StaticResource BoolToVisibilityFlipConverter}}"
                                               Source="{Binding .,
                                                                Converter={StaticResource StringResourceToImageSourceConverter},
                                                                Source={StaticResource QuestionMarkIcon}}" />
                                    </Grid>
                                    <local:MpSpinnerSwirl Width="20"
                                                          Height="20"
                                                          Visibility="{Binding Parent.IsBusy,
                                                                               Converter={StaticResource BoolToVisibilityConverter}}" />
                                </Grid>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn MinWidth="40">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Button Background="Transparent"
                                            BorderThickness="0"
                                            ToolTip="Duplicate"
                                            Visibility="{Binding Parent.IsBusy,
                                                                 Converter={StaticResource BoolToVisibilityFlipConverter}}"
                                            Command="{Binding Parent.DuplicatePresetCommand}"
                                            CommandParameter="{Binding}">
                                        <Image Width="20"
                                               Height="20"
                                               Source="{Binding .,
                                                                Converter={StaticResource StringResourceToImageSourceConverter},
                                                                Source={StaticResource SheepIcon}}" />
                                    </Button>
                                    <local:MpSpinnerSwirl Width="20"
                                                          Height="20"
                                                          Visibility="{Binding Parent.IsBusy,
                                                                               Converter={StaticResource BoolToVisibilityConverter}}" />
                                </Grid>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn MinWidth="40">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid Visibility="{Binding Parent.IsBusy,
                                                               Converter={StaticResource BoolToVisibilityFlipConverter}}">

                                        <Button Background="Transparent"
                                                BorderThickness="0"
                                                ToolTip="Delete"
                                                Visibility="{Binding IsDefault,
                                                                     Converter={StaticResource BoolToVisibilityFlipConverter}}"
                                                Command="{Binding Parent.DeletePresetCommand}"
                                                CommandParameter="{Binding}">
                                            <Image Width="20"
                                                   Height="20"
                                                   Source="{Binding .,
                                                                    Converter={StaticResource StringResourceToImageSourceConverter},
                                                                    Source={StaticResource TrashCanIcon}}" />
                                        </Button>
                                        <Button Background="Transparent"
                                                BorderThickness="0"
                                                ToolTip="Reset"
                                                Visibility="{Binding IsDefault,
                                                                     Converter={StaticResource BoolToVisibilityConverter}}"
                                                Command="{Binding Parent.ResetDefaultPresetCommand}"
                                                CommandParameter="{Binding}">
                                            <Image Width="20"
                                                   Height="20"
                                                   Source="{Binding .,
                                                                    Converter={StaticResource StringResourceToImageSourceConverter},
                                                                    Source={StaticResource ResetIcon}}" />
                                        </Button>
                                    </Grid>
                                    <local:MpSpinnerSwirl Width="20"
                                                          Height="20"
                                                          Visibility="{Binding Parent.IsBusy,
                                                                               Converter={StaticResource BoolToVisibilityConverter}}" />
                                </Grid>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
            <Button Width="150"
                    BorderThickness="0"
                    Background="Beige"
                    Style="{StaticResource RoundedButton}"
                    Margin="10,5,10,10"
                    HorizontalAlignment="Right"
                    Command="{Binding CreateNewPresetCommand}">
                <DockPanel>
                    <Image Source="{Binding .,
                                            Converter={StaticResource StringResourceToImageSourceConverter},
                                            Source={StaticResource AddIcon}}"
                           DockPanel.Dock="Left"
                           Width="15"
                           Height="15" />
                    <Label DockPanel.Dock="Right"
                           Content="Add Preset" />
                </DockPanel>
            </Button>
        </StackPanel>
    </Border>
</local:MpUserControl>
