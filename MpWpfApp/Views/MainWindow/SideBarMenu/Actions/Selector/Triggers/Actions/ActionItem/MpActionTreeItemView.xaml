<local:MpUserControl x:Class="MpWpfApp.MpActionTreeItemView"
                     xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                     xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                     xmlns:dd="clr-namespace:GongSolutions.Wpf.DragDrop;assembly=GongSolutions.Wpf.DragDrop"
                     xmlns:local="clr-namespace:MpWpfApp"
                     x:TypeArguments="local:MpActionViewModelBase"
                     mc:Ignorable="d"
                     d:DataContext="{d:DesignInstance Type=local:MpActionViewModelBase,
                                                      IsDesignTimeCreatable=False}"
                     d:DesignHeight="450"
                     d:DesignWidth="800">
    <local:MpUserControl.Resources>
        <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}"
                         Color="Transparent" />
        <HierarchicalDataTemplate x:Key="AnalyzeTemplate"
                                  DataType="{x:Type local:MpAnalyzeActionViewModel}"
                                  ItemsSource="{Binding Children}">
            <ComboBox x:Name="AnalyzerPresetComboBox"
                      Loaded="AnalyzerPresetComboBox_Loaded"
                      MinWidth="200"
                      IsSynchronizedWithCurrentItem="True"
                      SelectedItem="{Binding ., Mode=TwoWay}"
                      SelectedValuePath="AnalyticItemPresetId"
                      ItemsSource="{Binding AllPresets,
                                            Source={x:Static local:MpAnalyticItemCollectionViewModel.Instance}}">
                <ComboBox.GroupStyle>
                    <GroupStyle>
                        <GroupStyle.HeaderTemplate>
                            <DataTemplate>
                                <TextBlock Foreground="Black" FontSize="14" Text="{Binding Name}" />
                            </DataTemplate>
                        </GroupStyle.HeaderTemplate>
                    </GroupStyle>
                </ComboBox.GroupStyle>
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Label}"/>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
        </HierarchicalDataTemplate>
        <DataTemplate x:Key="ClassifyTemplate">
            <TextBox Text="Classify" />
        </DataTemplate>
        <DataTemplate x:Key="TransformTemplate">
            <TextBox Text="Transform" />
        </DataTemplate>
        <DataTemplate x:Key="CompareTemplate">
            <TextBox Text="Compare" />
        </DataTemplate>
        <HierarchicalDataTemplate x:Key="TriggerTemplate"
                                  DataType="{x:Type local:MpTriggerActionViewModelBase}"
                                  ItemsSource="{Binding Children}">
            <StackPanel Orientation="Horizontal">
                <Image Source="{Binding IconId,
                                        Converter={StaticResource IconIdToImageSourceConverter}}"
                       Width="15"
                       Height="15"
                       Stretch="Fill" />
                <TextBox Foreground="Black"
                         FontSize="16"
                         Text="{Binding Label,
                                        Mode=TwoWay,
                                        UpdateSourceTrigger=PropertyChanged,
                                        NotifyOnTargetUpdated=True,
                                        NotifyOnSourceUpdated=True}" />
            </StackPanel>
        </HierarchicalDataTemplate>
        <DataTemplate x:Key="NoneTemplate" />
        <local:MpActionItemTemplateSelector x:Key="ActionItemTemplateSelector" />
    </local:MpUserControl.Resources>
    <StackPanel Orientation="Horizontal">
        <ContentControl MinWidth="100"
                        MinHeight="30"
                        Content="{Binding}"
                        ContentTemplateSelector="{StaticResource ActionItemTemplateSelector}" />
        <DockPanel LastChildFill="False">
            <Button x:Name="AddChildActionButton"
                    DockPanel.Dock="Left"
                    ToolTip="Add"
                    Background="Transparent"
                    Margin="5,0,0,0"
                    BorderThickness="0"
                    PreviewMouseLeftButtonDown="AddChildActionButton_PreviewMouseLeftButtonDown"
                    Style="{StaticResource SemiTransparentButton}">
                <Border CornerRadius="2"
                        BorderThickness="2"
                        Background="LightGray">
                    <Image Source="{Binding .,
                                            Converter={StaticResource StringResourceToImageSourceConverter},
                                            Source={StaticResource AddIcon}}"
                           Stretch="Fill"
                           Margin="5"
                           Width="15"
                           Height="15" />
                </Border>
            </Button>
            <Button x:Name="RemoveChildActionButton"
                    DockPanel.Dock="Right"
                    ToolTip="Remove"
                    Margin="5,0,5,0"
                    Background="Transparent"
                    BorderThickness="2"
                    Style="{StaticResource SemiTransparentButton}"
                    Command="{Binding Parent.DeleteActionCommand}"
                    CommandParameter="{Binding}">
                <Border CornerRadius="2"
                        Background="LightGray">
                    <Image Stretch="Fill"
                           Margin="5"
                           Width="15"
                           Height="15"
                           Source="{Binding .,
                                            Source={StaticResource MinusIcon},
                                            Converter={StaticResource StringResourceToImageSourceConverter}}" />
                </Border>
            </Button>
        </DockPanel>
    </StackPanel>
</local:MpUserControl>
