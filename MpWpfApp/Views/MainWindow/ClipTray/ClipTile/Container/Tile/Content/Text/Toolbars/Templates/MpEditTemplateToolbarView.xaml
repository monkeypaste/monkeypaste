<local:MpUserControl x:Class="MpWpfApp.MpEditTemplateToolbarView"
                     xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                     xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                     xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
                     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                     mc:Ignorable="d"
                     xmlns:local="clr-namespace:MpWpfApp"
                     x:TypeArguments="local:MpTextTemplateViewModelBase"
                     d:DataContext="{d:DesignInstance Type=local:MpTextTemplateViewModelBase,
                                                      IsDesignTimeCreatable=False}"
                     d:DesignHeight="50"
                     d:DesignWidth="700">
    <Border x:Name="ClipTileEditTemplateToolbar"
            Width="{Binding HostClipTileViewModel.TileBorderWidth}"
            IsVisibleChanged="ClipTileEditTemplateToolbar_IsVisibleChanged"
            MinHeight="40"
            VerticalAlignment="Stretch"
            HorizontalAlignment="Stretch"            
            Background="LightBlue"
            BorderThickness="0">
        <DockPanel LastChildFill="True">
            <DockPanel.Resources>
                <DataTemplate x:Key="DynamicTemplate" />
                <DataTemplate x:Key="StaticTemplate"
                              DataType="{x:Type local:MpStaticTextTemplateViewModel}">
                    <StackPanel x:Name="StaticTemplateStackPanelContainer"
                                Orientation="Horizontal">
                        <TextBlock Margin="10,0,10,0"
                                   Text="Text"
                                   VerticalAlignment="Center"
                                   FontWeight="SemiBold" />
                        <Border Background="White"
                                Style="{StaticResource ActionPropertyComboBoxStyle_Border}">
                            <TextBox Width="120"
                                     BorderThickness="0"
                                     VerticalContentAlignment="Center"
                                     PreviewKeyDown="TemplateNameEditorTextBox_PreviewKeyDown"
                                     Text="{Binding TemplateData,
                                                    Mode=TwoWay,
                                                    UpdateSourceTrigger=PropertyChanged}" />
                        </Border>
                    </StackPanel>
                </DataTemplate>
                <DataTemplate x:Key="ContactTemplate"
                              DataType="{x:Type local:MpContactTextTemplateViewModel}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Field"
                                   Margin="10,0,10,0"
                                   VerticalAlignment="Center"
                                   FontWeight="SemiBold" />
                        <Border Style="{StaticResource ActionPropertyComboBoxStyle_Border}">
                            <ComboBox x:Name="ContactFieldComboBox"
                                      Style="{StaticResource ActionPropertyComboBoxStyle}"
                                      ItemContainerStyle="{StaticResource ActionPropertyComboBoxItemStyle}"
                                      IsSynchronizedWithCurrentItem="False"
                                      IsDropDownOpen="{Binding IsAnyDropDownOpen,
                                                               Source={x:Static local:MpMainWindowViewModel.Instance},
                                                               Mode=OneWayToSource}"
                                      SelectedIndex="{Binding SelectedContactFieldTypeIdx,
                                                              Mode=TwoWay}"
                                      ItemsSource="{Binding ContactFieldTypes}" />
                        </Border>
                        <StackPanel Orientation="Horizontal"
                                    Visibility="{Binding IsCustomFieldSelected,
                                                         Converter={StaticResource BoolToVisibilityConverter}}">
                            <Border Background="White"
                                    BorderThickness="0"
                                    CornerRadius="5"
                                    Margin="7"
                                    Padding="5">
                                <TextBox Width="120"
                                         BorderThickness="0"
                                         PreviewKeyDown="TemplateNameEditorTextBox_PreviewKeyDown"
                                         Text="{Binding TemplateData,
                                                        Mode=TwoWay,
                                                        UpdateSourceTrigger=LostFocus}" />
                            </Border>
                            <local:MpTooltipInfoView HorizontalAlignment="Right"
                                                     Margin="0,5"
                                                     DataContext="{Binding ContactFieldInfoViewModel,
                                                                           Source={x:Static local:MpTooltipInfoCollectionViewModel.Instance}}" />
                        </StackPanel>
                    </StackPanel>
                </DataTemplate>
                <DataTemplate x:Key="DateTimeTemplate"
                              DataType="{x:Type local:MpDateTimeTextTemplateViewModel}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Format"
                                   Margin="10"
                                   VerticalAlignment="Center"
                                   FontWeight="SemiBold" />
                        <Border Style="{StaticResource ActionPropertyComboBoxStyle_Border}">
                            <ComboBox x:Name="DateTimeFormatComboBox"
                                      Style="{StaticResource ActionPropertyComboBoxStyle}"
                                      ItemContainerStyle="{StaticResource ActionPropertyComboBoxItemStyle}"
                                      IsSynchronizedWithCurrentItem="False"
                                      IsDropDownOpen="{Binding IsAnyDropDownOpen,
                                                               Source={x:Static local:MpMainWindowViewModel.Instance},
                                                               Mode=OneWayToSource}"
                                      SelectedIndex="{Binding SelectedDateTimeFormatIdx,
                                                              Mode=TwoWay}"
                                      ItemsSource="{Binding DateTimeFormatItems}" />
                        </Border>
                        <StackPanel Orientation="Horizontal"
                                    Visibility="{Binding IsCustomFormatSelected,
                                                         Converter={StaticResource BoolToVisibilityConverter}}">
                            <Border Background="White"
                                    BorderThickness="0"
                                    CornerRadius="5"
                                    Margin="7"
                                    Padding="5">
                                <TextBox Width="120"
                                         BorderThickness="0"
                                         PreviewKeyDown="TemplateNameEditorTextBox_PreviewKeyDown"
                                         Text="{Binding TemplateData,
                                                        Mode=TwoWay,
                                                        UpdateSourceTrigger=LostFocus}" />
                            </Border>
                            <local:MpTooltipInfoView HorizontalAlignment="Right"
                                                     Margin="0,5"
                                                     DataContext="{Binding DateTimeFormatInfoViewModel,
                                                                           Source={x:Static local:MpTooltipInfoCollectionViewModel.Instance}}" />
                        </StackPanel>
                    </StackPanel>
                </DataTemplate>
                <local:MpEditTemplateDetailViewSelector x:Key="EditTemplateDetailViewSelector" />
            </DockPanel.Resources>
            <StackPanel Orientation="Horizontal"
                        Margin="10,0,0,0"
                        DockPanel.Dock="Left"
                        VerticalAlignment="Top"
                        HorizontalAlignment="Left">

                <Button x:Name="TemplateColorButton"
                        Width="20"
                        Height="20"
                        Margin="10,0,0,0"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        Background="{Binding TemplateHexColor,
                                             Mode=TwoWay,
                                             NotifyOnTargetUpdated=True,
                                             NotifyOnSourceUpdated=True,
                                             UpdateSourceTrigger=PropertyChanged,
                                             Converter={StaticResource StringHexToBrushConverter}}"
                        BorderBrush="Black"
                        BorderThickness="1"
                        Click="TemplateColorButton_Click" />
                <Border CornerRadius="5"
                        Margin="10,7,0,7"
                        Background="White"
                        BorderThickness="0"
                        VerticalAlignment="Stretch"
                        
                        BorderBrush="{Binding TemplateBorderHexColor,
                                              Converter={StaticResource StringHexToBrushConverter}}">
                    <TextBox x:Name="TemplateNameEditorTextBox"
                             MinHeight="25"
                             MinWidth="150"
                             Padding="0,0,0,0"
                             HorizontalAlignment="Left"
                             VerticalAlignment="Stretch" TextWrapping="WrapWithOverflow"
                             VerticalContentAlignment="Stretch"
                             local:MpIsFocusedExtension.IsEnabled="True"
                             local:MpIsFocusedExtension.IsFocused="{Binding IsEditTextBoxFocused,
                                                                            Mode=TwoWay}"
                             BorderBrush="{Binding TemplateNameTextBoxBorderBrush,
                                                   Converter={StaticResource StringHexToBrushConverter}}"
                             BorderThickness="2"
                             FontSize="14"
                             Foreground="Black"
                             IsReadOnly="False"
                             PreviewKeyDown="TemplateNameEditorTextBox_PreviewKeyDown"
                             Text="{Binding TemplateName,
                                            Mode=TwoWay,
                                            NotifyOnTargetUpdated=True,
                                            NotifyOnSourceUpdated=True,
                                            UpdateSourceTrigger=PropertyChanged}" />
                </Border>
                <Border Grid.Column="2"
                        Background="LightYellow"
                        BorderBrush="Yellow"
                        BorderThickness="1"
                        CornerRadius="5"
                        Margin="10,5,0,5"
                        Padding="5"
                        Visibility="{Binding IsValid,
                                             Converter={StaticResource BoolToVisibilityFlipConverter}}">
                    <DockPanel>
                        <Image Source="/Resources/Images/warning.png"
                               Stretch="Fill"
                               DockPanel.Dock="Left" />
                        <TextBlock x:Name="TemplateNameValidationTextBlock"
                                   DockPanel.Dock="Right"
                                   Margin="0"
                                   Padding="5,0"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   FontSize="14"
                                   FontStyle="Oblique"
                                   Foreground="Red"
                                   Text="{Binding ValidationText}" />
                    </DockPanel>
                </Border>
            </StackPanel>
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        DockPanel.Dock="Right">
                <Button x:Name="DeleteAllButton"
                        Margin="5,7,15,7"
                        Background="Crimson"
                        Foreground="Wheat"
                        Padding="3"
                        Width="80"
                        Command="{Binding DeleteAllTemplateInstancesCommand}"
                        Content="DELETE ALL"
                        FontSize="14"
                        IsCancel="True" />

                <Button x:Name="CancelButton"
                        Margin="5,7"
                        Padding="3"
                        Width="80"
                        Command="{Binding CancelEditTemplateCommand}"
                        Content="CANCEL"
                        FontSize="14"
                        IsCancel="True" />
                <Button x:Name="OkButton"
                        Margin="5,7,20,7"
                        Width="80"
                        Padding="3"
                        Command="{Binding FinishEditTemplateCommand}"
                        Content="DONE"
                        FontSize="14"
                        IsDefault="True" />
            </StackPanel>

            <ContentControl x:Name="TemplateDetailContentControl"
                            Margin="0,7,0,0"
                            VerticalAlignment="Top"
                            Background="Orange"
                            Content="{Binding}"
                            ContentTemplateSelector="{StaticResource EditTemplateDetailViewSelector}" />
        </DockPanel>
    </Border>
</local:MpUserControl>
