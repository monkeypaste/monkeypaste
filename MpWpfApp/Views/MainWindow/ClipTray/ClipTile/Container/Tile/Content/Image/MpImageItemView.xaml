<local:MpUserControl x:Class="MpWpfApp.MpImageItemView"
                     xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                     xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
                     xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                     xmlns:local="clr-namespace:MpWpfApp"
                     x:TypeArguments="local:MpContentItemViewModel"
                     mc:Ignorable="d"
                     d:DataContext="{d:DesignInstance Type=local:MpContentItemViewModel,
                                                      IsDesignTimeCreatable=False}"
                     d:DesignHeight="450"
                     d:DesignWidth="800">
    <Viewbox Width="{Binding Parent.TileContentWidth}"
             Height="{Binding EditorHeight}"
             DataContext="{Binding}"
             Loaded="Viewbox_Loaded">
        <Viewbox.Resources>
            <!--  MoveThumb Template  -->
            <ControlTemplate x:Key="MoveThumbTemplate"
                             TargetType="{x:Type local:MpMoveThumb}">
                <Rectangle Fill="Transparent" />
            </ControlTemplate>

            <!--  ResizeDecorator Template  -->
            <ControlTemplate x:Key="ResizeDecoratorTemplate"
                             TargetType="{x:Type Control}">
                <Grid>
                    <local:MpResizeThumb Height="3"
                                         Cursor="SizeNS"
                                         Margin="0,-4,0,0"
                                         VerticalAlignment="Top"
                                         HorizontalAlignment="Stretch" />
                    <local:MpResizeThumb Width="3"
                                         Cursor="SizeWE"
                                         Margin="-4,0,0,0"
                                         VerticalAlignment="Stretch"
                                         HorizontalAlignment="Left" />
                    <local:MpResizeThumb Width="3"
                                         Cursor="SizeWE"
                                         Margin="0,0,-4,0"
                                         VerticalAlignment="Stretch"
                                         HorizontalAlignment="Right" />
                    <local:MpResizeThumb Height="3"
                                         Cursor="SizeNS"
                                         Margin="0,0,0,-4"
                                         VerticalAlignment="Bottom"
                                         HorizontalAlignment="Stretch" />
                    <local:MpResizeThumb Width="7"
                                         Height="7"
                                         Cursor="SizeNWSE"
                                         Margin="-6,-6,0,0"
                                         VerticalAlignment="Top"
                                         HorizontalAlignment="Left" />
                    <local:MpResizeThumb Width="7"
                                         Height="7"
                                         Cursor="SizeNESW"
                                         Margin="0,-6,-6,0"
                                         VerticalAlignment="Top"
                                         HorizontalAlignment="Right" />
                    <local:MpResizeThumb Width="7"
                                         Height="7"
                                         Cursor="SizeNESW"
                                         Margin="-6,0,0,-6"
                                         VerticalAlignment="Bottom"
                                         HorizontalAlignment="Left" />
                    <local:MpResizeThumb Width="7"
                                         Height="7"
                                         Cursor="SizeNWSE"
                                         Margin="0,0,-6,-6"
                                         VerticalAlignment="Bottom"
                                         HorizontalAlignment="Right" />
                </Grid>
            </ControlTemplate>


            <!--  Designer Item Template  -->
            <ControlTemplate x:Key="DesignerItemTemplate"
                             TargetType="ContentControl">
                <Grid DataContext="{Binding RelativeSource={RelativeSource TemplatedParent}}">
                    <local:MpMoveThumb Template="{StaticResource MoveThumbTemplate}"
                                       Cursor="SizeAll" />
                    <Control Template="{StaticResource ResizeDecoratorTemplate}" />
                    <ContentPresenter Content="{TemplateBinding ContentControl.Content}" />
                </Grid>
            </ControlTemplate>

            <local:MpBindingProxy x:Key="ClipTileProxy"
                                  Data="{Binding}" />
        </Viewbox.Resources>
        <Grid>

            <Image x:Name="ClipTileAppIconImage"
               Source="{Binding CopyItemData,
                                Converter={StaticResource Base64StringToBitmapSourceConverter}}"
               Stretch="None"
               HorizontalAlignment="Center"
               VerticalAlignment="Center"
               Visibility="Visible" />
            <ItemsControl x:Name="ClipTileImageDetectedObjectItemscontrol"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Background="Transparent"
                      DataContext="{Binding DetectedImageObjectCollectionViewModel}"
                      ItemsSource="{Binding Items}">
                <ItemsControl.Resources>
                    <DataTemplate DataType="{x:Type local:MpDetectedImageObjectViewModel}">
                        <ContentControl Width="{Binding Width}"
                                    MinWidth="20"
                                    Height="{Binding Height}"
                                    MinHeight="20"
                                    Canvas.Top="{Binding X}"
                                    Canvas.Left="{Binding Y}"
                                    Visibility="{Binding Parent.Parent.Parent.IsSelected,
                                                         Converter={StaticResource BoolToVisibilityConverter}}"
                                    Template="{StaticResource DesignerItemTemplate}">

                            <ContentControl.RenderTransform>
                                <TranslateTransform X="{Binding X}"
                                                Y="{Binding Y}" />
                            </ContentControl.RenderTransform>
                            <!--<Path Fill="Blue"
                            Data="M 0,5 5,0 10,5 5,10 Z"
                            Stretch="Fill"
                            IsHitTestVisible="False"/>-->

                            <Border HorizontalAlignment="Stretch"
                                VerticalAlignment="Stretch"
                                BorderThickness="3"
                                BorderBrush="{Binding BorderBrush}"
                                Background="Transparent">
                                <Border.Resources>
                                    <local:MpBindingProxy x:Key="DetectedImageObjectProxy"
                                                      Data="{Binding}" />
                                </Border.Resources>
                                <TextBox HorizontalAlignment="Center"
                                     VerticalAlignment="Center"
                                     HorizontalContentAlignment="Center"
                                     VerticalContentAlignment="Center"
                                     Text="{Binding ObjectTypeName,
                                                    Mode=TwoWay,
                                                    NotifyOnTargetUpdated=True,
                                                    NotifyOnSourceUpdated=True,
                                                    UpdateSourceTrigger=PropertyChanged}"
                                     FontSize="{Binding FontSize}"
                                     IsReadOnly="{Binding IsNameReadOnly}"
                                     Background="{StaticResource ClipTileDetectedObjectTextBoxBackgroundBrush}"
                                     Foreground="White" />
                            </Border>
                        </ContentControl>
                    </DataTemplate>
                </ItemsControl.Resources>
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas x:Name="ClipTileImageDetectedObjectsCanvas"
                            Width="{Binding Data.DetectedImageObjectCollectionViewModel.CopyItemBmpWidth,
                                            Source={StaticResource ClipTileProxy}}"
                            Height="{Binding Data.DetectedImageObjectCollectionViewModel.CopyItemBmpHeight,
                                             Source={StaticResource ClipTileProxy}}"
                            HorizontalAlignment="Center"
                            IsItemsHost="True"
                            VerticalAlignment="Center" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
            </ItemsControl>
        </Grid>
    </Viewbox>
</local:MpUserControl>
