<local:MpUserControl x:Class="MpWpfApp.MpDetectedObjectsCollectionView"
                     xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                     xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
                     xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                     xmlns:local="clr-namespace:MpWpfApp"
                     x:TypeArguments="local:MpDetectedImageObjectCollectionViewModel"
                     mc:Ignorable="d"
                     d:DataContext="{d:DesignInstance Type=local:MpDetectedImageObjectCollectionViewModel,
                                                      IsDesignTimeCreatable=False}"
                     d:DesignHeight="450"
                     d:DesignWidth="800">
    <ItemsControl x:Name="ClipTileImageDetectedObjectItemscontrol"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Center"
                  Background="Transparent"
                  ItemsSource="{Binding Items}">
        <ItemsControl.Resources>
            <local:MpBindingProxy x:Key="DetectedImageObjectCollectionViewModelProxy"
                                  Data="{Binding}" />
            <!--  MoveThumb Template  -->
            <ControlTemplate x:Key="MoveThumbTemplate"
                             TargetType="{x:Type local:MpMoveThumb}">
                <Rectangle Fill="Transparent" />
            </ControlTemplate>
            <!--  ResizeDecorator Template  -->
            <ControlTemplate x:Key="ResizeDecoratorTemplate"
                             TargetType="{x:Type Control}">
                <Grid>
                    <local:MpResizeThumb Height="3"
                                         Cursor="SizeNS"
                                         Margin="0,-4,0,0"
                                         VerticalAlignment="Top"
                                         HorizontalAlignment="Stretch" />
                    <local:MpResizeThumb Width="3"
                                         Cursor="SizeWE"
                                         Margin="-4,0,0,0"
                                         VerticalAlignment="Stretch"
                                         HorizontalAlignment="Left" />
                    <local:MpResizeThumb Width="3"
                                         Cursor="SizeWE"
                                         Margin="0,0,-4,0"
                                         VerticalAlignment="Stretch"
                                         HorizontalAlignment="Right" />
                    <local:MpResizeThumb Height="3"
                                         Cursor="SizeNS"
                                         Margin="0,0,0,-4"
                                         VerticalAlignment="Bottom"
                                         HorizontalAlignment="Stretch" />
                    <local:MpResizeThumb Width="7"
                                         Height="7"
                                         Cursor="SizeNWSE"
                                         Margin="-6,-6,0,0"
                                         VerticalAlignment="Top"
                                         HorizontalAlignment="Left" />
                    <local:MpResizeThumb Width="7"
                                         Height="7"
                                         Cursor="SizeNESW"
                                         Margin="0,-6,-6,0"
                                         VerticalAlignment="Top"
                                         HorizontalAlignment="Right" />
                    <local:MpResizeThumb Width="7"
                                         Height="7"
                                         Cursor="SizeNESW"
                                         Margin="-6,0,0,-6"
                                         VerticalAlignment="Bottom"
                                         HorizontalAlignment="Left" />
                    <local:MpResizeThumb Width="7"
                                         Height="7"
                                         Cursor="SizeNWSE"
                                         Margin="0,0,-6,-6"
                                         VerticalAlignment="Bottom"
                                         HorizontalAlignment="Right" />
                </Grid>
            </ControlTemplate>
            <!--  Designer Item Template  -->
            <ControlTemplate x:Key="DesignerItemTemplate"
                             TargetType="ContentControl">
                <Grid DataContext="{Binding RelativeSource={RelativeSource TemplatedParent}}">
                    <local:MpMoveThumb Template="{StaticResource MoveThumbTemplate}"
                                       Cursor="SizeAll" />
                    <Control Template="{StaticResource ResizeDecoratorTemplate}" />
                    <ContentPresenter Content="{TemplateBinding ContentControl.Content}" />
                </Grid>
            </ControlTemplate>
            <DataTemplate DataType="{x:Type local:MpDetectedImageObjectViewModel}">
                <ContentControl Width="{Binding Width}"
                                MinWidth="20"
                                Height="{Binding Height}"
                                MinHeight="20"
                                Canvas.Top="{Binding X}"
                                Canvas.Left="{Binding Y}"
                                Background="Transparent"
                                Visibility="{Binding Parent.Parent.Parent.IsSelected,
                                                     Converter={StaticResource BoolToVisibilityConverter}}"
                                Template="{StaticResource DesignerItemTemplate}">
                    <ContentControl.Resources>

                        <SolidColorBrush Color="Transparent" x:Key="{x:Static SystemColors.HighlightBrushKey}"/>
                    </ContentControl.Resources>
                    <ContentControl.RenderTransform>
                        <TranslateTransform X="{Binding X}"
                                            Y="{Binding Y}" />
                    </ContentControl.RenderTransform>
                    <!--<Path Fill="Blue"
                            Data="M 0,5 5,0 10,5 5,10 Z"
                            Stretch="Fill"
                            IsHitTestVisible="False"/>-->

                    <Button HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            Background="Transparent"
                            BorderThickness="3"
                            local:MpHoverableExtension.IsEnabled="True"
                            local:MpHoverableExtension.IsHovering="{Binding IsHovering,Mode=TwoWay}"
                            Command="{Binding }">
                        <TextBox HorizontalAlignment="Center"
                                 VerticalAlignment="Center"
                                 HorizontalContentAlignment="Center"
                                 VerticalContentAlignment="Center"
                                 Text="{Binding ObjectTypeName,
                                                Mode=TwoWay,
                                                NotifyOnTargetUpdated=True,
                                                NotifyOnSourceUpdated=True,
                                                UpdateSourceTrigger=PropertyChanged}"
                                 FontSize="{Binding FontSize}"
                                 IsReadOnly="{Binding IsNameReadOnly}"
                                 local:MpHoverableExtension.IsEnabled="True"
                                 local:MpHoverableExtension.BackgroundBrush="{StaticResource ClipTileDetectedObjectTextBoxBackgroundBrush}"
                                 
                            local:MpHoverableExtension.HoverBackgroundBrush="Transparent"
                            local:MpHoverableExtension.HoverSelectedBackgroundBrush="Transparent"
                                 local:MpHoverableExtension.ForegroundBrush="White"
                                 local:MpHoverableExtension.HoverForegroundBrush="Red"/>
                    </Button>
                </ContentControl>
            </DataTemplate>
        </ItemsControl.Resources>
        <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
                <Canvas x:Name="ClipTileImageDetectedObjectsCanvas"
                        Width="{Binding Data.CopyItemBmpWidth,
                                        Source={StaticResource DetectedImageObjectCollectionViewModelProxy}}"
                        Height="{Binding Data.CopyItemBmpHeight,
                                         Source={StaticResource DetectedImageObjectCollectionViewModelProxy}}"
                        HorizontalAlignment="Center"
                        IsItemsHost="True"
                        VerticalAlignment="Center" />
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
    </ItemsControl>
</local:MpUserControl>
