<local:MpUserControl x:Class="MpWpfApp.MpClipTileTitleView"
                     xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                     xmlns:PresentationOptions="https://schemas.microsoft.com/winfx/2006/xaml/presentation/options"
                     xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
                     xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                     xmlns:local="clr-namespace:MpWpfApp"
                     x:TypeArguments="local:MpClipTileViewModel"
                     mc:Ignorable="d PresentationOptions"
                     d:DesignHeight="450"
                     d:DesignWidth="800"
                     d:DataContext="{d:DesignInstance Type=local:MpClipTileViewModel,
                                                      IsDesignTimeCreatable=False}">
    <i:Interaction.Behaviors>
        <local:MpClipTileTitleHighlightBehavior x:Name="ClipTileTitleHighlightBehavior" />
        <local:MpSourceHighlightBehavior x:Name="SourceHighlightBehavior" />
    </i:Interaction.Behaviors>
    <Grid x:Name="ClipTileTitleContainerGrid"
          Loaded="ClipTileTitleContainerGrid_Loaded"
          Unloaded="ClipTileTitleContainerGrid_Unloaded">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="0.3*" />
        </Grid.ColumnDefinitions>
        <Viewbox VerticalAlignment="Top"
                 HorizontalAlignment="Left"
                 Stretch="Fill"
                 Width="{Binding TileBorderWidth}"
                 Height="{Binding ClipTileTitleHeight,
                                  Source={x:Static local:MpMeasurements.Instance}}"
                 Grid.ColumnSpan="2">
            <Canvas x:Name="TitleSwirlCanvas"
                    Width="{Binding ClipTileDefaultMinSize,
                                    Source={x:Static local:MpMeasurements.Instance}}"
                    Height="{Binding ClipTileTitleHeight,
                                     Source={x:Static local:MpMeasurements.Instance}}"
                    DataContext="{Binding TitleSwirlViewModel}">
                <Path x:Name="Layer0"
                      StrokeThickness="0"
                      DataContext="{Binding SwirlLayer0}"
                      Fill="{Binding LayerBrush}"
                      Opacity="{Binding LayerOpacity}">
                    <Path.Data>
                        <PathGeometry PresentationOptions:Freeze="True">
                            <PathGeometry.Figures>
                                <PathFigure StartPoint="0,22"
                                            IsClosed="True">
                                    <BezierSegment Point1="150,-10"
                                                   Point2="160,85"
                                                   Point3="270,40" />
                                    <LineSegment Point="270,0" />
                                    <LineSegment Point="0,0" />
                                </PathFigure>
                            </PathGeometry.Figures>
                        </PathGeometry>
                    </Path.Data>
                </Path>
                <Path x:Name="Layer1"
                      StrokeThickness="0"
                      DataContext="{Binding SwirlLayer1}"
                      Fill="{Binding LayerBrush}"
                      Opacity="{Binding LayerOpacity}">
                    <Path.Data>
                        <PathGeometry PresentationOptions:Freeze="True">
                            <PathGeometry.Figures>
                                <PathFigure StartPoint="0,35"
                                            IsClosed="True">
                                    <BezierSegment Point1="40,45"
                                                   Point2="75,20"
                                                   Point3="100,20" />
                                    <BezierSegment Point1="185,20"
                                                   Point2="130,65"
                                                   Point3="270,40" />
                                    <LineSegment Point="270,0" />
                                    <LineSegment Point="0,0" />
                                </PathFigure>
                            </PathGeometry.Figures>
                        </PathGeometry>
                    </Path.Data>
                </Path>
                <Ellipse x:Name="Layer2"
                         StrokeThickness="0"
                         DataContext="{Binding SwirlLayer2}"
                         Fill="{Binding LayerBrush}"
                         Opacity="0.2"
                         Width="87"
                         Height="28"
                         Canvas.Left="165"
                         Canvas.Top="24" />
                <Path x:Name="Layer3"
                      StrokeThickness="0"
                      DataContext="{Binding SwirlLayer3}"
                      Fill="{Binding LayerBrush}"
                      Opacity="{Binding LayerOpacity}">
                    <Path.Data>
                        <PathGeometry PresentationOptions:Freeze="True">
                            <PathGeometry.Figures>
                                <PathFigure StartPoint="0,55"
                                            IsClosed="True">
                                    <QuadraticBezierSegment Point1="30,10"
                                                            Point2="270,0" />
                                    <LineSegment Point="0,0" />
                                </PathFigure>
                            </PathGeometry.Figures>
                        </PathGeometry>
                    </Path.Data>
                </Path>
            </Canvas>
        </Viewbox>
        <Canvas x:Name="ClipTileTitleTextCanvas"
                DataContext="{Binding}"
                ClipToBounds="True"
                Grid.Column="0"
                IsHitTestVisible="{Binding HasScrollVelocity,
                                           Source={x:Static local:MpClipTrayViewModel.Instance},
                                           Converter={StaticResource BoolFlipConverter}}"
                local:MpHoverableExtension.IsEnabled="True"
                local:MpHoverableExtension.IsHovering="{Binding IsHoveringOnTitleTextGrid,
                                                                Mode=TwoWay}"
                local:MpHoverableExtension.HoverCursor="IBeam"
                Margin="10,3,0,0"
                HorizontalAlignment="Stretch">
            <TextBox x:Name="ClipTileTitleTextBox"
                     PreviewKeyDown="ClipTileTitleTextBox_PreviewKeyDown"
                     local:MpIsFocusedExtension.IsEnabled="True"
                     local:MpIsFocusedExtension.IsFocused="{Binding IsTitleFocused,
                                                                    Mode=TwoWay}"
                     local:MpIsFocusedExtension.SelectAllOnFocus="True"
                     local:MpMarqueeTextBoxExtension.IsEnabled="True"
                     local:MpMarqueeTextBoxExtension.IsReadOnly="{Binding IsTitleReadOnly,
                                                                          Mode=TwoWay}"
                     MaxWidth="{Binding ActualWidth,
                                        ElementName=ClipTileTitleTextCanvas}"
                     Background="{StaticResource ClipTileTitleTextBoxBackgroundBrush}"
                     Foreground="Black"
                     FontSize="{Binding ClipTileTitleFontSize,
                                        Source={x:Static local:MpMeasurements.Instance},
                                        Mode=OneWay}"
                     IsReadOnly="{Binding IsTitleReadOnly,
                                          Mode=OneWay}"
                     Text="{Binding CopyItemTitle,
                                    Mode=TwoWay,
                                    NotifyOnTargetUpdated=True,
                                    NotifyOnSourceUpdated=True,
                                    UpdateSourceTrigger=PropertyChanged}" />
        </Canvas>
        <!--  Clip Title Icon Image  -->
        <Grid Grid.Column="1"
              Margin="0,0,0,0"
              HorizontalAlignment="Right"
              ClipToBounds="False">
            <Ellipse x:Name="SourceMatchEllipse"
                     Visibility="Hidden"
                     StrokeThickness="1"
                     RenderTransformOrigin="0.5,0.5"
                     HorizontalAlignment="Right"
                     VerticalAlignment="Center"
                     Margin="0,3,13,0"
                     Width="{Binding ClipTileTitleIconBorderSize,
                                     Source={x:Static local:MpMeasurements.Instance}}"
                     Height="{Binding ClipTileTitleIconBorderSize,
                                      Source={x:Static local:MpMeasurements.Instance}}" />
            <Button x:Name="ClipTileAppIconImageButton"
                    IsHitTestVisible="{Binding HasScrollVelocity,
                                               Source={x:Static local:MpClipTrayViewModel.Instance},
                                               Converter={StaticResource BoolFlipConverter}}"
                    MouseEnter="ClipTileAppIconImageButton_MouseEnter"
                    MouseLeave="ClipTileAppIconImageButton_MouseLeave"
                    PreviewMouseLeftButtonDown="ClipTileAppIconImageButton_PreviewMouseLeftButtonDown"
                    Style="{StaticResource Transparent_Button}"
                    Visibility="Visible"
                    HorizontalAlignment="Right"
                    Margin="0,0,20,0"
                    VerticalAlignment="Center"
                    RenderTransformOrigin="0.5,0.5"
                    Background="Transparent"
                    BorderThickness="0">
                <Button.RenderTransform>
                    <RotateTransform x:Name="ClipTileAppIconImageButtonRotateTransform" />
                </Button.RenderTransform>
                <Button.ContextMenu>
                    <local:MpClipTileSourceIconContextMenu DataContext="{Binding PlacementTarget.DataContext,
                                                                                 RelativeSource={RelativeSource Self}}" />
                </Button.ContextMenu>
                <Grid>
                    <Image x:Name="ClipTileAppIconBorderImage"
                           Source="{Binding IconId,
                                            Converter={StaticResource IconIdToImageSourceConverter},
                                            ConverterParameter='border'}"
                           Stretch="Fill"
                           RenderTransformOrigin="0.5, 0.5"
                           Visibility="Hidden"
                           MaxWidth="{Binding ClipTileTitleIconSize,
                                              Source={x:Static local:MpMeasurements.Instance},
                                              Mode=OneWay}"
                           MaxHeight="{Binding ClipTileTitleIconSize,
                                               Source={x:Static local:MpMeasurements.Instance},
                                               Mode=OneWay}">
                        <Image.RenderTransform>
                            <ScaleTransform x:Name="ClipTileAppIconBorderImageScaleTransform" />
                        </Image.RenderTransform>
                    </Image>
                    <Image x:Name="ClipTileAppIconImage"
                           Source="{Binding IconId,
                                            Converter={StaticResource IconIdToImageSourceConverter}}"
                           Stretch="UniformToFill"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Visibility="Visible"
                           Width="{Binding ClipTileTitleIconSize,
                                           Source={x:Static local:MpMeasurements.Instance},
                                           Mode=OneWay}"
                           Height="{Binding ClipTileTitleIconSize,
                                            Source={x:Static local:MpMeasurements.Instance},
                                            Mode=OneWay}" />
                </Grid>
            </Button>
        </Grid>
    </Grid>
</local:MpUserControl>
