<Window x:Class="MpWpfApp.MpAssignHotkeyModalWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:MpWpfApp"
        mc:Ignorable="d"
        Title="Assign Hotkey"
        Height="300"
        MinWidth="400"
        Topmost="True"
        ShowInTaskbar="False"
        ResizeMode="NoResize"
        SizeToContent="WidthAndHeight"
        WindowStartupLocation="CenterScreen"
        Loaded="Window_Loaded"        
        Closed="Window_Closed"
        d:DataContext="{d:DesignInstance Type=local:MpAssignShortcutModalWindowViewModel,
                                         IsDesignTimeCreatable=False}">
    <Window.DataContext>
        <local:MpAssignShortcutModalWindowViewModel />
    </Window.DataContext>
    <Window.Resources>
        <CollectionViewSource x:Key="ListBoxItems"
                              Source="{Binding KeyItems}">
            <CollectionViewSource.GroupDescriptions>
                <PropertyGroupDescription PropertyName="SeqIdx" />
            </CollectionViewSource.GroupDescriptions>
        </CollectionViewSource>
    </Window.Resources>
    <i:Interaction.Behaviors>
        <local:MpKeyGestureBehavior x:Name="KeyGestureBehavior" />
    </i:Interaction.Behaviors>
    <StackPanel>
        <TextBlock Grid.Row="0"
                   FontSize="16"
                   HorizontalAlignment="Center">
            <Run Text="Press Keys for '" />
            <Run Text="{Binding ShortcutDisplayName}" />
            <Run Text="'" />
        </TextBlock>
        <Border CornerRadius="10"
                BorderThickness="0"
                HorizontalAlignment="Center"
                Padding="10"
                Visibility="{Binding IsEmpty,
                                     Converter={StaticResource BoolToVisibilityFlipConverter},
                                     ConverterParameter={StaticResource Hide}}"
                Margin="20,10"
                MinHeight="65">
            <ListBox x:Name="ShortcutListBox"
                     Grid.Row="2"
                     MinHeight="65"
                     IsEnabled="False"
                     Background="Transparent"
                     BorderThickness="0"
                     HorizontalAlignment="Center"
                     ScrollViewer.VerticalScrollBarVisibility="Hidden"
                     ScrollViewer.HorizontalScrollBarVisibility="Auto"
                     ItemsSource="{Binding Source={StaticResource ListBoxItems}}">
                <ListBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel Orientation="Horizontal"
                                                IsItemsHost="True"
                                                Background="Transparent"
                                                VerticalAlignment="Center"
                                                HorizontalAlignment="Center" />
                    </ItemsPanelTemplate>
                </ListBox.ItemsPanel>
                <ListBox.ItemContainerStyle>
                    <Style TargetType="{x:Type ListBoxItem}">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                    <ContentPresenter />
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ListBox.ItemContainerStyle>
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="Black"
                                BorderThickness="0"
                                Background="Transparent">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="auto" />
                                </Grid.ColumnDefinitions>
                                <Border Grid.Column="0"
                                        HorizontalAlignment="Left"
                                        Background="LightGray"
                                        BorderBrush="DarkGray"
                                        Margin="0"
                                        BorderThickness="2"
                                        CornerRadius="5">
                                    <TextBlock HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               Padding="10,5,10,5"
                                               FontSize="14"
                                               Foreground="Black"
                                               Text="{Binding KeyStr,
                                                              Converter={StaticResource EnumStringToKeyLiteralStringConverter}}"
                                               FontWeight="Bold" />
                                </Border>
                                <Label x:Name="ComboLabel"
                                       Visibility="{Binding PlusVisibility}"
                                       Content="+"
                                       Grid.Column="1"
                                       FontSize="14"
                                       FontWeight="Bold"
                                       HorizontalAlignment="Left"
                                       VerticalAlignment="Center" />
                                <!--<Label x:Name="SequenceLabel"
                                       Visibility="{Binding CommaVisibility}"
                                       Content=","
                                       Grid.Column="1"
                                       FontSize="20"
                                       FontWeight="Bold"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Bottom" />-->
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
                <ListBox.GroupStyle>
                    <GroupStyle>
                        <GroupStyle.Panel>
                            <ItemsPanelTemplate>
                                <VirtualizingStackPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </GroupStyle.Panel>
                        <GroupStyle.ContainerStyle>
                            <Style TargetType="{x:Type GroupItem}">
                                <Setter Property="Margin"
                                        Value="0,0,5,0" />
                                <Setter Property="Background"
                                        Value="Transparent" />
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate>
                                            <Border CornerRadius="5"
                                                    Padding="3"
                                                    BorderBrush="LimeGreen"
                                                    BorderThickness="1"
                                                    Background="Aquamarine">
                                                <ItemsPresenter />
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </GroupStyle.ContainerStyle>
                    </GroupStyle>
                </ListBox.GroupStyle>
            </ListBox>
        </Border>
        <TextBlock Grid.Row="3"
                   FontSize="10"
                   MinHeight="30"
                   Visibility="Collapsed"
                   FontStyle="Oblique"
                   TextWrapping="Wrap"
                   HorizontalAlignment="Center"
                   Foreground="Red"
                   Text="{Binding KeyString}" />
        <Border Background="{Binding WarningBorderBrush}"
                Visibility="{Binding HasWarning,
                                     Converter={StaticResource BoolToVisibilityConverter}}"
                Margin="10"
                CornerRadius="10"
                MaxWidth="350"
                Grid.Row="3"
                BorderThickness="1"
                BorderBrush="AntiqueWhite">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="0.1*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Image Source="{Binding WarningBmp}"
                       Margin="10,7,0,7"
                       Width="25"
                       Height="25"
                       Grid.Column="0"
                       HorizontalAlignment="Left"
                       VerticalAlignment="Center" />
                <TextBlock Grid.Column="1"
                           FontSize="14"
                           FontStyle="Oblique"
                           TextWrapping="WrapWithOverflow"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Center"
                           Padding="10,5"
                           Foreground="{Binding WarningTextBrush}"
                           Text="{Binding WarningString}" />
            </Grid>
        </Border>
        <Grid Grid.Row="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <Button Margin="10"
                    Grid.Column="0"
                    MinHeight="30"
                    Background="Transparent"
                    BorderThickness="0"
                    IsCancel="True"
                    Click="Cancel_Click"
                    Content="Cancel"
                    Style="{StaticResource RoundedButton}"
                    HorizontalAlignment="Stretch" />
            <Button Margin="10"
                    Grid.Column="1"
                    Content="Clear"
                    Style="{StaticResource RoundedButton}"
                    HorizontalAlignment="Stretch"
                    Command="{Binding ClearCommand}" />
            <Button Margin="10"
                    Grid.Column="2"
                    Content="Ok"
                    Style="{StaticResource RoundedButton}"
                    HorizontalAlignment="Stretch"
                    IsDefault="True"
                    Click="Ok_Click" />
        </Grid>
    </StackPanel>
</Window>
